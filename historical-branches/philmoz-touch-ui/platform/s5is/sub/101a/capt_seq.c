/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

#define USE_STUBS_NRFLAG 1          // see stubs_entry.S

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFF866D48 - 0xFF867010, length=179
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R3-R9,LR} \n"
"    LDR     R6, =0x1AC98 \n"
"    LDR     R5, =0x5A14 \n"
"    MOV     R9, #1 \n"
"    MOV     R7, #0 \n"

"loc_FF866D5C:\n"
"    LDR     R0, [R5, #0x14] \n"
"    MOV     R2, #0 \n"
"    MOV     R1, SP \n"
"    BL      sub_FF82A5C0 /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF866D88 \n"
"    LDR     R1, =0x415 \n"
"    LDR     R0, =0xFF8667C8 /*'SsShootTask.c'*/ \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    LDMFD   SP!, {R3-R9,PC} \n"

"loc_FF866D88:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x1B \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF866FD8 \n"
"    B       loc_FF866E0C \n"
"    B       loc_FF866E7C \n"
"    B       loc_FF866E84 \n"
"    B       loc_FF866E9C \n"
"    B       loc_FF866E90 \n"
"    B       loc_FF866EA4 \n"
"    B       loc_FF866EAC \n"
"    B       loc_FF866EB4 \n"
"    B       loc_FF866F0C \n"
"    B       loc_FF866F18 \n"
"    B       loc_FF866F20 \n"
"    B       loc_FF866F28 \n"
"    B       loc_FF866F30 \n"
"    B       loc_FF866F38 \n"
"    B       loc_FF866F40 \n"
"    B       loc_FF866F48 \n"
"    B       loc_FF866F50 \n"
"    B       loc_FF866F58 \n"
"    B       loc_FF866F60 \n"
"    B       loc_FF866F68 \n"
"    B       loc_FF866F70 \n"
"    B       loc_FF866F7C \n"
"    B       loc_FF866F88 \n"
"    B       loc_FF866F90 \n"
"    B       loc_FF866FC0 \n"
"    B       loc_FF866FC8 \n"
"    B       loc_FF866FD0 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866E0C:\n"
"    BL      sub_FF95F190 \n"
"    BL      shooting_expo_param_override\n"      // added
"    BL      sub_FF864C5C \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BEQ     loc_FF866FE4 \n"
"    BL      sub_FF8664A0 \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BEQ     loc_FF866E54 \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FF869C60 \n"
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x40000000 \n"
"    STRNE   R0, [R4, #8] \n"
"    BNE     loc_FF866FE4 \n"

"loc_FF866E54:\n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960B34 \n"
"    BL      sub_FF973490 \n"
"    BL      sub_FF8749E4 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF961054 \n"
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    B       loc_FF866FE4 \n"

"loc_FF866E7C:\n"
"    BL      sub_FF866844_my \n"  // --> Patched. Old value = 0xFF866844.
"    B       loc_FF866E94 \n"

"loc_FF866E84:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FF95F3D8 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866E90:\n"
"    BL      sub_FF95EF2C \n"

"loc_FF866E94:\n"
"    STR     R7, [R6, #0x24] \n"
"    B       loc_FF866FE4 \n"

"loc_FF866E9C:\n"
"    BL      sub_FF95F15C \n"
"    B       loc_FF866E94 \n"

"loc_FF866EA4:\n"
"    BL      sub_FF95F164 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866EAC:\n"
"    BL      sub_FF95F2C4 \n"
"    B       loc_FF866F10 \n"

"loc_FF866EB4:\n"
"    LDR     R4, [R0, #0xC] \n"
"    BL      sub_FF95F16C \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF95FC9C \n"
"    TST     R0, #1 \n"
"    MOV     R8, R0 \n"
"    BNE     loc_FF866EF4 \n"
"    BL      sub_FF8749E4 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960F84 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF96143C \n"
"    MOV     R8, R0 \n"
"    LDR     R0, [R4, #0x14] \n"
"    BL      sub_FF874BD8 \n"

"loc_FF866EF4:\n"
"    BL      sub_FF95F15C \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #7 \n"
"    MOV     R0, R8 \n"
"    BL      sub_FF865098 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F0C:\n"
"    BL      sub_FF95F354 \n"

"loc_FF866F10:\n"
"    BL      sub_FF864C5C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F18:\n"
"    BL      sub_FF95F15C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F20:\n"
"    BL      sub_FF95FEE8 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F28:\n"
"    BL      sub_FF9600E4 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F30:\n"
"    BL      sub_FF9601C8 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F38:\n"
"    BL      sub_FF96027C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F40:\n"
"    BL      sub_FF9606E0 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F48:\n"
"    BL      sub_FF960724 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F50:\n"
"    MOV     R0, #0 \n"
"    B       loc_FF866F74 \n"

"loc_FF866F58:\n"
"    BL      sub_FF960898 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F60:\n"
"    BL      sub_FF96092C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F68:\n"
"    BL      sub_FF9609E0 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F70:\n"
"    MOV     R0, #1 \n"

"loc_FF866F74:\n"
"    BL      sub_FF960778 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F7C:\n"
"    BL      sub_FF95F574 \n"
"    BL      sub_FF8670FC \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F88:\n"
"    BL      sub_FF9604F4 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866F90:\n"
"    MOV     R2, #2 \n"
"    ADD     R1, R6, #0x58 \n"
"    MOV     R0, #0x6F \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    LDRNE   R0, =0xFF8667C8 /*'SsShootTask.c'*/ \n"
"    MOVNE   R1, #0x4D0 \n"
"    BLNE    _DebugAssert \n"
"    LDRH    R0, [R6, #0x58] \n"
"    CMP     R0, #1 \n"
"    BLEQ    sub_FF9604E8 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866FC0:\n"
"    BL      sub_FF96062C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866FC8:\n"
"    BL      sub_FF86672C \n"
"    B       loc_FF866FE4 \n"

"loc_FF866FD0:\n"
"    BL      sub_FF8269C4 \n"
"    B       loc_FF866FE4 \n"

"loc_FF866FD8:\n"
"    LDR     R1, =0x4F1 \n"
"    LDR     R0, =0xFF8667C8 /*'SsShootTask.c'*/ \n"
"    BL      _DebugAssert \n"

"loc_FF866FE4:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0, #4] \n"
"    LDR     R0, [R5, #0x10] \n"
"    BL      sub_FF82A33C /*_SetEventFlag*/ \n"
"    LDR     R4, [SP] \n"
"    LDR     R0, [R4, #8] \n"
"    CMP     R0, #0 \n"
"    LDREQ   R0, =0xFF8667C8 /*'SsShootTask.c'*/ \n"
"    MOVEQ   R1, #0xF7 \n"
"    BLEQ    _DebugAssert \n"
"    STR     R7, [R4, #8] \n"
"    B       loc_FF866D5C \n"
);
}

/*************************************************************/
//** sub_FF866844_my @ 0xFF866844 - 0xFF866A1C, length=119
void __attribute__((naked,noinline)) sub_FF866844_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R4, [R0, #0xC] \n"
"    LDR     R5, =0x1AC98 \n"
"    LDR     R0, [R4, #8] \n"
"    LDR     R6, =0x820A \n"
"    ORR     R0, R0, #1 \n"
"    STR     R0, [R4, #8] \n"
"    LDRH    R0, [R5] \n"
"    LDR     R8, =0x5A14 \n"
"    MOV     R7, #0 \n"
"    CMP     R0, R6 \n"
"    BEQ     loc_FF8668E8 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF86693C \n"
"    LDR     R0, [R4, #0xC] \n"
"    CMP     R0, #1 \n"
"    BLS     loc_FF8668F4 \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF86693C \n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #2 \n"
"    BNE     loc_FF866900 \n"
"    BL      sub_FF95F628 \n"
"    LDRH    R0, [R5] \n"
"    CMP     R0, R6 \n"
"    BEQ     loc_FF8668E8 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF86693C \n"
"    LDR     R0, [R4, #0xC] \n"
"    CMP     R0, #1 \n"
"    BLS     loc_FF8668F4 \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF86693C \n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #2 \n"
"    BEQ     loc_FF86692C \n"
"    B       loc_FF866900 \n"

"loc_FF8668E8:\n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF86693C \n"

"loc_FF8668F4:\n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF86693C \n"

"loc_FF866900:\n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF86693C \n"
"    LDRH    R0, [R5] \n"
"    CMP     R0, R6 \n"
"    LDRNE   R0, [R4, #0xC] \n"
"    CMPNE   R0, #1 \n"
"    BLS     loc_FF86693C \n"
"    LDR     R0, [R4, #0x10] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF86693C \n"

"loc_FF86692C:\n"
"    LDR     R2, =0xEA60 \n"
"    LDR     R0, [R8, #0x10] \n"
"    MOV     R1, #0x40000000 \n"
"    BL      sub_FF869FC0 \n"

"loc_FF86693C:\n"
"    BL      sub_FF86672C \n"
"    LDR     R0, [R5, #0x24] \n"
"    CMP     R0, #0 \n"
"    MOVEQ   R0, #2 \n"
"    BLEQ    sub_FF85FD44 \n"
"    BL      sub_FF95F16C \n"
"    LDR     R0, [R4, #0x18] \n"
"    CMP     R0, #0 \n"
"    BLNE    sub_FF861FF0 \n"
"    LDR     R0, [R5, #0x24] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF8669B8 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960B34 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF95F8B8 \n"
"    TST     R0, #1 \n"
"    MOVNE   R2, R4 \n"
"    LDMNEFD SP!, {R4-R8,LR} \n"
"    MOVNE   R1, #1 \n"
"    BNE     sub_FF865098 \n"
"    BL      sub_FF973490 \n"
"    BL      sub_FF8749E4 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960F84 \n"
"    BL      sub_FF961874 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF961054_my \n"  // --> Patched. Old value = 0xFF961054. This is where shooting AND darkframe sub is done so hook it
"    MOV     R7, R0 \n"
"    BL      capt_seq_hook_raw_here \n"         // added
"    B       loc_FF8669C4 \n"

"loc_FF8669B8:\n"
"    LDR     R0, [R8, #4] \n"
"    CMP     R0, #0 \n"
"    MOVNE   R7, #0x1D \n"

"loc_FF8669C4:\n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, R7 \n"
"    BL      sub_FF865098 \n"
"    BL      sub_FF9613DC \n"
"    CMP     R0, #0 \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x2000 \n"
"    STRNE   R0, [R4, #8] \n"
"    LDR     R0, [R4, #0x18] \n"
"    CMP     R0, #0 \n"
"    BLNE    sub_FF862008 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    LDMEQFD SP!, {R4-R8,PC} \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    LDREQH  R0, [R5, #0x82] \n"
"    CMPEQ   R0, #2 \n"
"    MOVEQ   R0, R4 \n"
"    LDMEQFD SP!, {R4-R8,LR} \n"
"    BEQ     sub_FF95F670 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"
);
}

/*************************************************************/
//** sub_FF961054_my @ 0xFF961054 - 0xFF9610C0, length=28
void __attribute__((naked,noinline)) sub_FF961054_my() {
asm volatile (
"    STMFD   SP!, {R0-R8,LR} \n"
"    MOV     R4, R0 \n"
"    BL      sub_FF9619B0 \n"
"    MVN     R1, #0 \n"
"    BL      sub_FF82A370 /*_ClearEventFlag*/ \n"
"    MOV     R2, #4 \n"
"    ADD     R1, SP, #8 \n"
"    MOV     R0, #0x8A \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x1D2 \n"
"    LDRNE   R0, =0xFF96126C /*'SsCaptureSeq.c'*/ \n"
"    BLNE    _DebugAssert \n"
"    LDR     R6, =0x1AD48 \n"
"    LDR     R7, =0x1AC98 \n"
"    LDRSH   R1, [R6, #0xE] \n"
"    LDR     R0, [R7, #0x7C] \n"
//"  BL      _sub_FF91C100 \n"  // --> Nullsub call removed.
"    BL      _GetCCDTemperature \n"
"    LDR     R2, =0xB708 \n"
"    ADD     R3, R4, #0x78 \n"
"    STRH    R0, [R4, #0x74] \n"
"    STRD    R2, [SP] \n"
"    MOV     R1, R0 \n"
"    LDRH    R0, [R7, #0x54] \n"
"    LDRSH   R2, [R6, #0xC] \n"
"    LDR     R3, =0xB704 \n"
"    BL      sub_FFA40388 \n"  // 2 (NR) is set into 0xB704 in this sub! Still before shooting
"    BL      wait_until_remote_button_is_released\n" // added
"    BL      capt_seq_hook_set_nr\n"                 // added
"    LDR     PC, =0xFF9610C4 \n"  // Continue in firmware
);
}

/*************************************************************/
//** exp_drv_task @ 0xFF8D3888 - 0xFF8D3E50, length=371
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R8, =0xBB8 \n"
"    LDR     R6, =0x3F21C \n"
"    LDR     R5, =0x7B5C \n"
"    SUB     SP, SP, #0x20 \n"
"    ADD     R7, SP, #0x10 \n"

"loc_FF8D38A0:\n"
"    LDR     R0, [R5, #0x20] \n"
"    MOV     R2, #0 \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_FF82A5C0 /*_ReceiveMessageQueue*/ \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x23 \n"
"    BNE     loc_FF8D38E0 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4900 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF82A33C /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x20 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"

"loc_FF8D38E0:\n"
"    CMP     R1, #0x22 \n"
"    BNE     loc_FF8D38FC \n"
"    LDR     R2, [R0, #0x88]! \n"
"    LDR     R1, [R0, #4] \n"
"    MOV     R0, R1 \n"
"    BLX     R2 \n"
"    B       loc_FF8D3E48 \n"

"loc_FF8D38FC:\n"
"    CMP     R1, #0x1D \n"
"    BNE     loc_FF8D394C \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF82A370 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8D03F0 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF9527A4 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF82A274 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0xCAE \n"
"    BNE     loc_FF8D39E4 \n"

"loc_FF8D3938:\n"
"    LDR     R1, [SP, #0x1C] \n"
"    LDR     R0, [R1, #0x8C] \n"
"    LDR     R1, [R1, #0x88] \n"
"    BLX     R1 \n"
"    B       loc_FF8D3E48 \n"

"loc_FF8D394C:\n"
"    CMP     R1, #0x1E \n"
"    BNE     loc_FF8D398C \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF82A370 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8D0400 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF952F4C \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF82A274 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8D3938 \n"
"    LDR     R1, =0xCB8 \n"
"    B       loc_FF8D39E4 \n"

"loc_FF8D398C:\n"
"    CMP     R1, #0x1F \n"
"    CMPNE   R1, #0x20 \n"
"    BNE     loc_FF8D3A34 \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF82A370 /*_ClearEventFlag*/ \n"
"    LDR     R0, [R4] \n"
"    MOV     R1, #0x40 \n"
"    CMP     R0, #0x1F \n"
"    LDR     R0, =0xFF8D0440 \n"
"    BNE     loc_FF8D39C4 \n"
"    BL      sub_FF9534B0 \n"
"    B       loc_FF8D39C8 \n"

"loc_FF8D39C4:\n"
"    BL      sub_FF953550 \n"

"loc_FF8D39C8:\n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF82A274 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8D3938 \n"
"    LDR     R1, =0xCC6 \n"

"loc_FF8D39E4:\n"
"    LDR     R0, =0xFF8D0B14 /*'ExpDrv.c'*/ \n"
"    BL      _DebugAssert \n"
"    B       loc_FF8D3938 \n"
"    ANDEQ   R0, R0, R4, LSR R10 \n"

"loc_FF8D3A34:\n"
"    CMP     R1, #0x21 \n"
"    BNE     loc_FF8D3A4C \n"
"    BL      sub_FF8B4BB4 \n"
"    BL      sub_FF8B5868 \n"
"    BL      sub_FF8B53A4 \n"
"    B       loc_FF8D3938 \n"

"loc_FF8D3A4C:\n"
"    CMP     R1, #0xD \n"
"    MOV     R4, #1 \n"
"    BNE     loc_FF8D3AB0 \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2,R3,R12} \n"
"    STMIA   R7, {R2,R3,R12} \n"
"    BL      sub_FF8D23E0 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4CC8 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x90] \n"
"    LDR     R2, [R0, #0x94] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3AB0:\n"
"    CMP     R1, #0xE \n"
"    CMPNE   R1, #0xF \n"
"    BNE     loc_FF8D3B58 \n"
"    ADD     R2, SP, #4 \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8D2618 \n"
"    CMP     R0, #1 \n"
"    MOV     R4, R0 \n"
"    CMPNE   R4, #5 \n"
"    BNE     loc_FF8D3AF8 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, R4 \n"
"    LDR     R1, [R0, #0x7C]! \n"
"    LDR     R12, [R0, #0xC]! \n"
"    LDR     R3, [R0, #4] \n"
"    ADD     R0, SP, #4 \n"
"    BLX     R12 \n"
"    B       loc_FF8D3B30 \n"

"loc_FF8D3AF8:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    CMP     R4, #2 \n"
"    LDR     R3, [R0, #0x8C] \n"
"    CMPNE   R4, #6 \n"
"    BNE     loc_FF8D3B40 \n"
"    LDR     R12, [R0, #0x88] \n"
"    ADD     R0, SP, #4 \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    BLX     R12 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    ADD     R2, SP, #4 \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8D35E8 \n"

"loc_FF8D3B30:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R1, R4 \n"
"    BL      sub_FF8D3834 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3B40:\n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R12, [R0, #0x88] \n"
"    ADD     R0, R0, #4 \n"
"    MOV     R2, R4 \n"
"    BLX     R12 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3B58:\n"
"    CMP     R1, #0x19 \n"
"    CMPNE   R1, #0x1A \n"
"    BNE     loc_FF8D3BA4 \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2-R4} \n"
"    STMIA   R7, {R2-R4} \n"
"    BL      sub_FF8D19BC \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D1CA0 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3BA4:\n"
"    ADD     R1, R0, #4 \n"
"    LDMIA   R1, {R2,R3,R12} \n"
"    STMIA   R7, {R2,R3,R12} \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x1C \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3C34 \n"
"    B       loc_FF8D3C3C \n"
"    B       loc_FF8D3C44 \n"
"    B       loc_FF8D3C44 \n"
"    B       loc_FF8D3C34 \n"
"    B       loc_FF8D3C3C \n"
"    B       loc_FF8D3C44 \n"
"    B       loc_FF8D3C44 \n"
"    B       loc_FF8D3C5C \n"
"    B       loc_FF8D3C5C \n"
"    B       loc_FF8D3D48 \n"
"    B       loc_FF8D3D50 \n"
"    B       loc_FF8D3D58 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3C4C \n"
"    B       loc_FF8D3C54 \n"
"    B       loc_FF8D3C68 \n"
"    B       loc_FF8D3C70 \n"
"    B       loc_FF8D3CA0 \n"
"    B       loc_FF8D3CD0 \n"
"    B       loc_FF8D3D00 \n"
"    B       loc_FF8D3D30 \n"
"    B       loc_FF8D3D30 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3D60 \n"
"    B       loc_FF8D3D38 \n"
"    B       loc_FF8D3D40 \n"

"loc_FF8D3C34:\n"
"    BL      sub_FF8D08F8 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C3C:\n"
"    BL      sub_FF8D0B74 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C44:\n"
"    BL      sub_FF8D0D74 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C4C:\n"
"    BL      sub_FF8D0FC4 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C54:\n"
"    BL      sub_FF8D11B4 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C5C:\n"
"    BL      sub_FF8D1408_my \n"  // --> Patched. Old value = 0xFF8D1408.
"    MOV     R4, #0 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C68:\n"
"    BL      sub_FF8D1540 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3C70:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4974 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3CA0:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R6, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4AE8 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3CD0:\n"
"    LDRH    R1, [R6] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R0, #6] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R6, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4B90 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D00:\n"
"    LDRH    R1, [R6] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4C30 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D30:\n"
"    BL      sub_FF8D1794 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D38:\n"
"    BL      sub_FF8D1DA4 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D40:\n"
"    BL      sub_FF8D1FD4 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D48:\n"
"    BL      sub_FF8D2148 \n"
"    B       loc_FF8D3D60 \n"

"loc_FF8D3D50:\n"
"    MOV     R1, #0 \n"
"    B       loc_FF8D3D5C \n"

"loc_FF8D3D58:\n"
"    MOV     R1, #1 \n"

"loc_FF8D3D5C:\n"
"    BL      sub_FF8D22DC \n"

"loc_FF8D3D60:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    CMP     R4, #1 \n"
"    BNE     loc_FF8D3DC8 \n"

"loc_FF8D3D80:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, #0xC \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R0, R0, R1, LSL#2 \n"
"    SUB     R4, R0, #8 \n"
"    LDR     R0, =0x3F21C \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA92AA8 \n"
"    LDR     R0, =0x3F228 \n"
"    MOV     R2, #0xC \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA92AA8 \n"
"    LDR     R0, =0x3F234 \n"
"    MOV     R2, #0xC \n"
"    MOV     R1, R4 \n"
"    BL      sub_FFA92AA8 \n"
"    B       loc_FF8D3E40 \n"

"loc_FF8D3DC8:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #9 \n"
"    BNE     loc_FF8D3E10 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF8D06F4 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    B       loc_FF8D3E3C \n"

"loc_FF8D3E10:\n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"
"    BL      sub_FF8D06F4 \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"

"loc_FF8D3E3C:\n"
"    BL      sub_FF8D0840 \n"

"loc_FF8D3E40:\n"
"    MOV     R0, #0 \n"
"    STR     R0, [R5, #0x34] \n"

"loc_FF8D3E48:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4900 \n"
"    B       loc_FF8D38A0 \n"
);
}

/*************************************************************/
//** sub_FF8D1408_my @ 0xFF8D1408 - 0xFF8D14C0, length=47
void __attribute__((naked,noinline)) sub_FF8D1408_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R7, =0x7B5C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x3E \n"
"    BL      sub_FF82A370 /*_ClearEventFlag*/ \n"
"    LDRSH   R0, [R4, #4] \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF8D0460 \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF8D0594 \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FF8D05EC \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FF8D0644 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    BL      sub_FF8D069C \n"
"    MOV     R5, R0 \n"
"    LDR     R0, [R4] \n"
"    LDR     R8, =0x3F234 \n"
"    CMP     R0, #9 \n"
"    MOVEQ   R6, #0 \n"
"    MOVEQ   R5, #0 \n"
"    BEQ     loc_FF8D1494 \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF8D1494 \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFF8D03E0 \n"
"    MOV     R2, #2 \n"
"    BL      sub_FF9528B0 \n"
"    STRH    R0, [R4, #4] \n"
"    MOV     R0, #0 \n"
"    STR     R0, [R7, #0x28] \n"
"    B       loc_FF8D149C \n"

"loc_FF8D1494:\n"
"    LDRH    R0, [R8] \n"
"    STRH    R0, [R4, #4] \n"

"loc_FF8D149C:\n"
"    CMP     R5, #1 \n"
"    LDRNEH  R0, [R8, #8] \n"
"    BNE     loc_FF8D14B8 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFF8D0450 \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FF8D4930 \n"

"loc_FF8D14B8:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF8B4958_my \n"  // --> Patched. Old value = 0xFF8B4958.
"    LDR     PC, =0xFF8D14C4 \n"  // Continue in firmware
);
}

/*************************************************************/
//** sub_FF8B4958_my @ 0xFF8B4958 - 0xFF8B49C0, length=27
void __attribute__((naked,noinline)) sub_FF8B4958_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R5, =0x74CC \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #4] \n"
"    CMP     R0, #1 \n"
"    LDRNE   R1, =0x16B \n"
"    LDRNE   R0, =0xFF8B473C /*'Shutter.c'*/ \n"
"    BLNE    _DebugAssert \n"
"    CMN     R4, #0xC00 \n"
"    LDREQSH R4, [R5, #2] \n"
"    CMN     R4, #0xC00 \n"
"    LDREQ   R1, =0x171 \n"
"    LDREQ   R0, =0xFF8B473C /*'Shutter.c'*/ \n"
"    STRH    R4, [R5, #2] \n"
"    BLEQ    _DebugAssert \n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    MOV     R4, R0 \n"
//"  BL      _sub_FF8E34B0 \n"  // --> Nullsub call removed.
"    MOV     R0, R4 \n"
"    BL      sub_FF8E7CE0 \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x176 \n"
"    LDMNEFD SP!, {R4-R6,LR} \n"
"    LDRNE   R0, =0xFF8B473C /*'Shutter.c'*/ \n"
"    BNE     _DebugAssert \n"
"    LDMFD   SP!, {R4-R6,PC} \n"
);
}
