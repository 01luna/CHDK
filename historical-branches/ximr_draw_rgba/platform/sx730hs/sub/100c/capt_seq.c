#include "lolevel.h"
#include "platform.h"
#include "core.h"

// debug
#define CAPTSEQ_DEBUG_LOG 1
extern void _LogCameraEvent(int id,const char *fmt,...);

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (-1) // default value if NRTBL.SetDarkSubType not used is -1 (0 probalby works the same), set to enable auto

#ifdef CAPTSEQ_DEBUG_LOG

extern char *hook_raw_image_addr(void);

void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d rb:0x%08x i:%04d",
                    m,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d rb:0x%08x i:%04d",
                    m,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override rb:0x%08x i:%04d",
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
#endif

#include "../../../generic/capt_seq.c"

// first paramter matches active_raw_buffer
// second is pointer to structure
extern int _captseq_raw_addr_init(int raw_index, char **ptr);
char *current_raw_addr;

void captseq_raw_addr_init_my(int raw_index,char **ptr) {
    _captseq_raw_addr_init(raw_index,ptr);
    current_raw_addr=*(ptr + 0x60/4); // @0xfc0f5fe8 [r4,#0x60]
#ifdef CAPTSEQ_DEBUG_LOG
    _LogCameraEvent(0x60,"rawinit i:0x%x p:0x%x v:0x%x",raw_index,ptr,current_raw_addr);
#endif
}

void clear_current_raw_addr(void) {
    current_raw_addr=NULL;
}

// -f=chdk -s=task_CaptSeq -c=183
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
// task_CaptSeq 0xfc0f2b07
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x0003e6f8\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000bfc8\n"
"loc_fc0f2b0e:\n"
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #8]\n"
"    bl      sub_fc344686\n" // ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0f2b30\n"
"    movw    r2, #0x453\n"
"    ldr     r1, =0xfc0f2750\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"    bl      _ExitTask\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc0f2b30:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc0f2b4c\n"
"    cmp     r0, #0x2d\n"
"    beq     loc_fc0f2b4c\n"
"    cmp     r0, #0x2e\n"
"    beq     loc_fc0f2b4c\n"
"    cmp     r0, #0x21\n"
"    beq     loc_fc0f2b4c\n"
"    cmp     r0, #0x25\n"
"    beq     loc_fc0f2b4c\n"
"    bl      sub_fc18ef40\n"
"loc_fc0f2b4c:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x37\n"
"    bhs     loc_fc0f2c36\n"
"    tbb     [pc, r1]\n" // (jumptable r1 55 elements)
"branchtable_fc0f2b58:\n"
"    .byte((loc_fc0f2b90 - branchtable_fc0f2b58) / 2)\n" // (case 0)
"    .byte((loc_fc0f2ba6 - branchtable_fc0f2b58) / 2)\n" // (case 1)
"    .byte((loc_fc0f2bae - branchtable_fc0f2b58) / 2)\n" // (case 2)
"    .byte((loc_fc0f2bbc - branchtable_fc0f2b58) / 2)\n" // (case 3)
"    .byte((loc_fc0f2bb6 - branchtable_fc0f2b58) / 2)\n" // (case 4)
"    .byte((loc_fc0f2bd4 - branchtable_fc0f2b58) / 2)\n" // (case 5)
"    .byte((loc_fc0f2bda - branchtable_fc0f2b58) / 2)\n" // (case 6)
"    .byte((loc_fc0f2be4 - branchtable_fc0f2b58) / 2)\n" // (case 7)
"    .byte((loc_fc0f2bec - branchtable_fc0f2b58) / 2)\n" // (case 8)
"    .byte((loc_fc0f2bfc - branchtable_fc0f2b58) / 2)\n" // (case 9)
"    .byte((loc_fc0f2c04 - branchtable_fc0f2b58) / 2)\n" // (case 10)
"    .byte((loc_fc0f2c0a - branchtable_fc0f2b58) / 2)\n" // (case 11)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 12)
"    .byte((loc_fc0f2c12 - branchtable_fc0f2b58) / 2)\n" // (case 13)
"    .byte((loc_fc0f2c18 - branchtable_fc0f2b58) / 2)\n" // (case 14)
"    .byte((loc_fc0f2c1e - branchtable_fc0f2b58) / 2)\n" // (case 15)
"    .byte((loc_fc0f2c24 - branchtable_fc0f2b58) / 2)\n" // (case 16)
"    .byte((loc_fc0f2c2a - branchtable_fc0f2b58) / 2)\n" // (case 17)
"    .byte((loc_fc0f2c30 - branchtable_fc0f2b58) / 2)\n" // (case 18)
"    .byte((loc_fc0f2c38 - branchtable_fc0f2b58) / 2)\n" // (case 19)
"    .byte((loc_fc0f2c3e - branchtable_fc0f2b58) / 2)\n" // (case 20)
"    .byte((loc_fc0f2c44 - branchtable_fc0f2b58) / 2)\n" // (case 21)
"    .byte((loc_fc0f2c48 - branchtable_fc0f2b58) / 2)\n" // (case 22)
"    .byte((loc_fc0f2c4e - branchtable_fc0f2b58) / 2)\n" // (case 23)
"    .byte((loc_fc0f2c54 - branchtable_fc0f2b58) / 2)\n" // (case 24)
"    .byte((loc_fc0f2c5a - branchtable_fc0f2b58) / 2)\n" // (case 25)
"    .byte((loc_fc0f2c5e - branchtable_fc0f2b58) / 2)\n" // (case 26)
"    .byte((loc_fc0f2c62 - branchtable_fc0f2b58) / 2)\n" // (case 27)
"    .byte((loc_fc0f2c6a - branchtable_fc0f2b58) / 2)\n" // (case 28)
"    .byte((loc_fc0f2c72 - branchtable_fc0f2b58) / 2)\n" // (case 29)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 30)
"    .byte((loc_fc0f2c7a - branchtable_fc0f2b58) / 2)\n" // (case 31)
"    .byte((loc_fc0f2c80 - branchtable_fc0f2b58) / 2)\n" // (case 32)
"    .byte((loc_fc0f2c84 - branchtable_fc0f2b58) / 2)\n" // (case 33)
"    .byte((loc_fc0f2c8c - branchtable_fc0f2b58) / 2)\n" // (case 34)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 35)
"    .byte((loc_fc0f2c92 - branchtable_fc0f2b58) / 2)\n" // (case 36)
"    .byte((loc_fc0f2c98 - branchtable_fc0f2b58) / 2)\n" // (case 37)
"    .byte((loc_fc0f2c9e - branchtable_fc0f2b58) / 2)\n" // (case 38)
"    .byte((loc_fc0f2ca4 - branchtable_fc0f2b58) / 2)\n" // (case 39)
"    .byte((loc_fc0f2caa - branchtable_fc0f2b58) / 2)\n" // (case 40)
"    .byte((loc_fc0f2cb2 - branchtable_fc0f2b58) / 2)\n" // (case 41)
"    .byte((loc_fc0f2cb8 - branchtable_fc0f2b58) / 2)\n" // (case 42)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 43)
"    .byte((loc_fc0f2cdc - branchtable_fc0f2b58) / 2)\n" // (case 44)
"    .byte((loc_fc0f2ce2 - branchtable_fc0f2b58) / 2)\n" // (case 45)
"    .byte((loc_fc0f2cee - branchtable_fc0f2b58) / 2)\n" // (case 46)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 47)
"    .byte((loc_fc0f2d08 - branchtable_fc0f2b58) / 2)\n" // (case 48)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 49)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 50)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 51)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 52)
"    .byte((loc_fc0f2cfa - branchtable_fc0f2b58) / 2)\n" // (case 53)
"    .byte((loc_fc0f2cf4 - branchtable_fc0f2b58) / 2)\n" // (case 54)
".align 1\n"
"loc_fc0f2b90:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0f31c0\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq_override\n"
#endif
"    BL      clear_current_raw_addr\n" // +
"    BL      shooting_expo_param_override\n" // +
"    bl      sub_fc0f0526\n"
"    ldr     r0, [r4, #0x24]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc0f2ba4\n"
//"    bl      sub_fc18e188\n"
"    bl      sub_fc18e188_my\n" // ->
"loc_fc0f2ba4:\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2ba6:\n" // case 1: normal shoot
"    ldr     r0, [r0, #0x10]\n"
//"    bl      sub_fc18e0fe\n"
"    bl      sub_fc18e0fe_my\n" // ->
"    b       loc_fc0f2d08\n"
"loc_fc0f2bae:\n"
"    movs    r0, #1\n"
"    bl      sub_fc0f358a\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2bb6:\n"
"    bl      sub_fc0f2e0a\n"
"    b       loc_fc0f2bc2\n"
"loc_fc0f2bbc:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0f316e\n"
"loc_fc0f2bc2:\n"
"    str     r6, [r4, #0x24]\n"
"    b       loc_fc0f2d08\n"
".ltorg\n"
// firmware had literal pool here
// 00 00 
// 14 e9 03 00
// f8 e6 03 00
// c8 bf 00 00
"loc_fc0f2bd4:\n"
"    bl      sub_fc0f3176\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2bda:\n"
"    bl      sub_fc0f34aa\n"
"    bl      sub_fc0f0526\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2be4:\n"
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc18e21c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2bec:\n"
"    bl      sub_fc0f350c\n"
"    bl      sub_fc0f0526\n"
"    movs    r0, #0\n"
"    bl      sub_fc27eab2\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2bfc:\n"
"    ldr     r0, [r4, #0x50]\n"
"    bl      sub_fc0f499c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c04:\n"
"    bl      sub_fc0f4c48\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c0a:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0f4c94\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c12:\n"
"    bl      sub_fc0f4de8\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c18:\n"
"    bl      sub_fc0f51b0\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c1e:\n"
"    bl      sub_fc0f5246\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c24:\n"
"    bl      sub_fc18cb4c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c2a:\n"
"    bl      sub_fc18ccb2\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c30:\n"
"    bl      sub_fc18cd28\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c36:\n"
"    b       loc_fc0f2cfa\n"
"loc_fc0f2c38:\n"
"    bl      sub_fc18cdb0\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c3e:\n"
"    bl      sub_fc18ce56\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c44:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f2c64\n"
"loc_fc0f2c48:\n"
"    bl      sub_fc18d154\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c4e:\n"
"    bl      sub_fc18d1a6\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c54:\n"
"    bl      sub_fc18d1aa\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c5a:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f2c6c\n"
"loc_fc0f2c5e:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f2c74\n"
"loc_fc0f2c62:\n"
"    movs    r0, #1\n"
"loc_fc0f2c64:\n"
"    bl      sub_fc18d040\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c6a:\n"
"    movs    r0, #1\n"
"loc_fc0f2c6c:\n"
"    bl      sub_fc18d1bc\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c72:\n"
"    movs    r0, #1\n"
"loc_fc0f2c74:\n"
"    bl      sub_fc18d25a\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c7a:\n"
"    bl      sub_fc0f365c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c80:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f2c86\n"
"loc_fc0f2c84:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc0f2c86:\n"
"    bl      sub_fc0f36d8\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c8c:\n"
"    bl      sub_fc18cf70\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c92:\n"
"    bl      sub_fc18cfd0\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c98:\n"
"    bl      sub_fc18e91a\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2c9e:\n"
"    bl      sub_fc0f8196\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2ca4:\n"
"    bl      sub_fc0f8250\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2caa:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc18d334\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2cb2:\n"
"    bl      sub_fc18d39c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2cb8:\n"
"    bl      sub_fc0fa154\n"
"    ldrh.w  r0, [r4, #0x1b8]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc0f2cce\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x4200\n"
"    subs    r1, #0x38\n"
"    bne     loc_fc0f2d08\n"
"loc_fc0f2cce:\n"
"    bl      sub_fc0f8250\n"
"    bl      sub_fc0f8796\n"
"    bl      sub_fc0f85f4\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2cdc:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x12\n"
"    b       loc_fc0f2ce6\n"
"loc_fc0f2ce2:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"loc_fc0f2ce6:\n"
"    movs    r0, #0\n"
"    bl      sub_fc0f110c\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2cee:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x11\n"
"    b       loc_fc0f2ce6\n"
"loc_fc0f2cf4:\n"
"    bl      sub_fc0f48e8\n"
"    b       loc_fc0f2d08\n"
"loc_fc0f2cfa:\n"
"    movw    r2, #0x58f\n"
"    ldr     r1, =0xfc0f2750\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"loc_fc0f2d08:\n"
// debug after message handled
#ifdef CAPTSEQ_DEBUG_LOG
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5, #4]\n"
"    bl      _SetEventFlag\n"
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc0f2d26\n"
"    movw    r2, #0x102\n"
"    ldr     r1, =0xfc0f2750\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"loc_fc0f2d26:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc0f2b0e\n"
".ltorg\n"
    );
}
// -f=chdk -s=0xfc18e189 -eret=2
void __attribute__((naked,noinline)) sub_fc18e188_my() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    bl      sub_fc0f221a\n"
"    mov     r4, r0\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc309ad0\n"
"    ldr     r6, =0x00014c10\n"
"    lsls    r0, r0, #0x1f\n"
"    mov.w   r5, #1\n"
"    bne     loc_fc18e218\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    movw    r0, #0x115\n"
"    bl      _GetPropertyCase\n" //  PROPCASE_TV (277)
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18e1bc\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1be\n"
"    ldr     r1, =0xfc18e2dc\n" //  *"SsCaptureCtrl.c"
"    bl      _DebugAssert\n"
"loc_fc18e1bc:\n"
"    ldrsh.w r0, [sp]\n"
"    bl      sub_fc0dbe02\n"
"    cbz     r0, loc_fc18e1ce\n"
"    str     r5, [r6]\n"
"    bl      sub_fc309b08\n"
"loc_fc18e1cc:\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc18e1ce:\n"
"    bl      sub_fc114d58\n"
"    bl      sub_fc0f317e\n"
"    mov     r0, r4\n"
"    bl      sub_fc0f5f4e\n"
"    mov     r1, r4\n"
//"    bl      _captseq_raw_addr_init\n"
"bl captseq_raw_addr_init_my\n" // +
"    movs    r2, #4\n"
"    movw    r0, #0x11b\n"
"    add.w   r1, r4, #0x5c\n"
"    bl      _SetPropertyCase\n" //  (283)
"    movs    r2, #4\n"
"    movs    r0, #0x33\n"
"    add.w   r1, r4, #0x60\n"
"    bl      _SetPropertyCase\n" //  (51)
"    movs    r2, #4\n"
"    movs    r0, #0x47\n"
"    add.w   r1, r4, #8\n"
"    bl      _SetPropertyCase\n" //  (71)
"    mov     r0, r4\n"
"    bl      sub_fc18dcf6\n"
"    mov     r0, r4\n"
//"    bl      sub_fc244522\n"
"    bl      sub_fc244522_my\n" // ->
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18e1cc\n" //  return
"loc_fc18e218:\n"
"    str     r5, [r6]\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}

// -f=chdk -s=0xfc18e0ff -eret
void __attribute__((naked,noinline)) sub_fc18e0fe_my() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r6, =0x0003e6f8\n"
"    movs    r4, #0\n"
"    mov     r5, r0\n"
"    movw    r0, #0x120\n"
"    ldr     r1, [r6, #0x24]\n"
"    cbz     r1, loc_fc18e15e\n"
"    ldr.w   r2, [r5, #0x128]\n"
"    ldr     r1, =0xfc18e2f4\n" //  *"  CaptCtrl: Quick(%d)"
"    bl      _LogCameraEvent\n"
"    ldr     r0, =0x00014c10\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc18e120\n"
"    movs    r4, #0x1d\n"
"loc_fc18e120:\n"
"    movw    r7, #0x15d\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    mov     r0, r7\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18e13e\n"
"    movs    r0, #0\n"
"    movw    r2, #0x175\n"
"    ldr     r1, =0xfc18e2dc\n" //  *"SsCaptureCtrl.c"
"    bl      _DebugAssert\n"
"loc_fc18e13e:\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r3, #2\n"
"    mov     r2, sp\n"
"    mov     r1, r7\n"
"    bl      sub_fc35b984\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc0f110c\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18ed9e\n"
"    b       loc_fc18e182\n"
"loc_fc18e15e:\n"
"    ldr     r1, =0xfc18e310\n" //  *"  CaptCtrl: ExecCapt"
"    bl      _LogCameraEvent\n"
"    mov     r0, r5\n"
//"    bl      sub_fc18df56\n"
"    bl      sub_fc18df56_my\n" // -> to hooks
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18e182\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc0f110c\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18ef00\n"
"loc_fc18e182:\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x24]\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}

// -f=chdk -s=0xfc18df57 -c=155
void __attribute__((naked,noinline)) sub_fc18df56_my() {
    asm volatile (
"    push.w  {r2, r3, r4, r5, r6, r7, r8, lr}\n"
"    mov     r4, r0\n"
"    bl      sub_fc0f5f4e\n"
"    mov     r1, r4\n"
//"    bl      _captseq_raw_addr_init\n"
"    bl      captseq_raw_addr_init_my\n"
"    movs    r2, #4\n"
"    movw    r0, #0x11b\n"
"    add.w   r1, r4, #0x5c\n"
"    bl      _SetPropertyCase\n" //  (283)
"    movs    r2, #4\n"
"    movs    r0, #0x33\n"
"    add.w   r1, r4, #0x60\n"
"    bl      _SetPropertyCase\n" //  (51)
"    ldr     r5, =0x0003e6f8\n"
"    ldr.w   r0, [r5, #0x108]\n"
"    cbnz    r0, loc_fc18df98\n"
"    ldrh.w  r0, [r5, #0x1b6]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc18df9e\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc18dfae\n"
"    b       loc_fc18df9e\n"
"loc_fc18df98:\n"
"    ldr     r0, [r4, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc18dfae\n"
"loc_fc18df9e:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc309ad0\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18dfae\n"
"    bl      sub_fc0f0e26\n"
"    b       loc_fc18dffa\n" //  return 0x1
"loc_fc18dfae:\n"
"    ldr.w   r0, [r5, #0xec]\n"
"    cbz     r0, loc_fc18dfce\n"
"    ldrh.w  r0, [r5, #0x1b6]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc18dfc2\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc18e000\n"
"loc_fc18dfc2:\n"
"    ldr.w   r0, [r5, #0x108]\n"
"    cbz     r0, loc_fc18dfce\n"
"    ldr     r0, [r4, #0xc]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc18e000\n"
"loc_fc18dfce:\n"
"    movs    r2, #2\n"
"    movw    r0, #0x115\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n" //  PROPCASE_TV (277)
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18dfe8\n"
"    movs    r2, #0xcd\n"
"    movs    r0, #0\n"
"    ldr     r1, =0xfc18e2dc\n" //  *"SsCaptureCtrl.c"
"    bl      _DebugAssert\n"
"loc_fc18dfe8:\n"
"    ldrsh.w r0, [sp, #4]\n"
"    bl      sub_fc0dbe02\n"
"    cbz     r0, loc_fc18e000\n"
"    bl      sub_fc0f0e26\n"
"    bl      sub_fc309b08\n"
"loc_fc18dffa:\n"
"    movs    r0, #1\n"
"loc_fc18dffc:\n"
"    pop.w   {r2, r3, r4, r5, r6, r7, r8, pc}\n"
"loc_fc18e000:\n"
"    mov     r0, r4\n"
"    bl      sub_fc0f36a2\n"
"    lsls    r1, r0, #0x1f\n"
"    bne     loc_fc18dffc\n" //  return
"    ldr     r7, =0x0003e914\n"
"    ldr     r0, [r7]\n"
"    cbz     r0, loc_fc18e022\n"
"    ldr.w   r0, [r5, #0x19c]\n"
"    cbz     r0, loc_fc18e022\n"
"    mov     r0, r4\n"
"    bl      sub_fc18ea84\n" //  return
"    mov     r0, r4\n"
"    bl      sub_fc18ea86\n" //  return
"loc_fc18e022:\n"
"    mov     r0, r4\n"
"    bl      sub_fc18c8a8\n"
"    mov     r6, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc18e0fa\n"
"    ldr     r0, [r7]\n"
"    cbnz    r0, loc_fc18e03e\n"
"    ldr.w   r0, [r5, #0x19c]\n"
"    cbz     r0, loc_fc18e03e\n"
"    mov     r0, r4\n"
"    bl      sub_fc18ea84\n" //  return
"loc_fc18e03e:\n"
"    bl      sub_fc114d58\n"
"    bl      sub_fc0f317e\n"
"    mov     r0, r4\n"
"    bl      sub_fc18dcf6\n"
"    ldr.w   r0, [r5, #0x12c]\n"
"    cbnz    r0, loc_fc18e060\n"
"    ldrh.w  r0, [r5, #0x1b6]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc18e060\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc18e066\n"
"loc_fc18e060:\n"
"    movs    r0, #2\n"
"    bl      sub_fc0fb3ea\n"
"loc_fc18e066:\n"
"    ldr.w   r0, [r5, #0xa0]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc18e0d8\n"
"    ldrh.w  r0, [r5, #0x1b6]\n"
"    movw    r7, #0x800\n"
"    cmp     r0, #3\n"
"    beq     loc_fc18e096\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc18e096\n"
"    bl      sub_fc18e896\n"
"    movw    r3, #0x12a\n"
"    movw    r2, #0x3a98\n"
"    mov     r1, r7\n"
"    str     r3, [sp]\n"
"    ldr     r3, =0xfc18e2dc\n" //  *"SsCaptureCtrl.c"
"    bl      sub_fc309ea8\n"
"loc_fc18e096:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x18c\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n" //  (396)
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc18e0b2\n"
"    movs    r0, #0\n"
"    movw    r2, #0x12e\n"
"    ldr     r1, =0xfc18e2dc\n" //  *"SsCaptureCtrl.c"
"    bl      _DebugAssert\n"
"loc_fc18e0b2:\n"
"    ldr     r0, [sp, #4]\n"
"    cbnz    r0, loc_fc18e0c2\n"
"    bl      sub_fc18e896\n"
"    mov     r1, r7\n"
"    bl      _SetEventFlag\n"
"    b       loc_fc18e0d8\n"
"loc_fc18e0c2:\n"
"    bl      sub_fc18e896\n"
"    mov     r1, r7\n"
"    bl      sub_fc369bc2\n" // ClearEventFlag
"    ldr     r2, =0xfc18df45\n"
"    mov     r3, r7\n"
"    ldr     r0, [sp, #4]\n"
"    mov     r1, r2\n"
"    bl      sub_fc3415c4\n"
"loc_fc18e0d8:\n"
"    ldr.w   r0, [r5, #0xac]\n"
"    cbz     r0, loc_fc18e0e6\n"
"    mov     r0, r4\n"
"    bl      sub_fc244a44\n"
"    b       loc_fc18e0fa\n"
"loc_fc18e0e6:\n"
"    ldr.w   r0, [r5, #0xb0]\n"
"    cmp     r0, #0\n"
"    mov     r0, r4\n"
"    beq     loc_fc18e0f6\n"
"    bl      sub_fc244de6\n"
"    b       loc_fc18e0fa\n"
"loc_fc18e0f6:\n"
//"    bl      sub_fc244522\n"
"    bl      sub_fc244522_my\n" // ->
"loc_fc18e0fa:\n"
"    mov     r0, r6\n"
"    b       loc_fc18dffc\n" //  return
".ltorg\n"
    );
}
#ifdef CAPTSEQ_DEBUG_LOG
void log_nr_call(void) {
    _LogCameraEvent(0x60,"nr hook %d",_nrflag);
}
void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook");
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook rb:0x%08x rbc:0x%08x",hook_raw_image_addr(),current_raw_addr);
}
#endif

// -f=chdk -s=0xfc244523 -eret
void __attribute__((naked,noinline)) sub_fc244522_my() {
    asm volatile (
"    push.w  {r0, r1, r2, r3, r4, r5, r6, r7, r8, sb, sl, lr}\n"
"    mov     r4, r0\n"
"    bl      sub_fc0f5ffa\n"
"    ldr     r7, =0x0003e6f8\n"
"    ldr.w   r0, [r7, #0x168]\n"
"    cbz     r0, loc_fc244542\n"
"    ldrh.w  r0, [r7, #0x1b6]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc244542\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc24454c\n"
"loc_fc244542:\n"
"    mov     r0, r4\n"
"    bl      sub_fc18dc48\n"
"    bl      sub_fc18e760\n"
"loc_fc24454c:\n"
"    ldr.w   r0, [r7, #0x9c]\n"
"    cbnz    r0, loc_fc24455c\n"
"    movs    r0, #1\n"
"    bl      sub_fc0f367e\n"
"    bl      sub_fc18e342\n"
"loc_fc24455c:\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r3, #4\n"
"    add     r2, sp, #0xc\n"
"    movw    r1, #0x13c\n"
"    bl      sub_fc35ba00\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc24457a\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1c4\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc24457a:\n"
"    ldr     r0, [sp, #0xc]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc24458a\n"
"    ldr     r0, =0xfc244521\n"
"    movs    r1, #0\n"
"    b       loc_fc24458e\n"
"loc_fc24458a:\n"
"    ldr     r0, =0xfc18d879\n"
"    mov     r1, r4\n"
"loc_fc24458e:\n"
"    bl      sub_fc1137b0\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r3, #2\n"
"    add     r2, sp, #8\n"
"    movw    r1, #0x117\n"
"    bl      sub_fc35ba00\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2445b0\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1cd\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc2445b0:\n"
"    ldr.w   r0, [r7, #0x104]\n"
"    cbz     r0, loc_fc2445e2\n"
"    ldrh.w  r0, [r7, #0x1b6]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc2445c4\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc2445e2\n"
"loc_fc2445c4:\n"
"    movs    r0, #1\n"
"    movw    r5, #0x16b\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    str     r0, [sp]\n"
"    mov     r0, r5\n"
"    bl      _SetPropertyCase\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r3, #2\n"
"    mov     r2, sp\n"
"    mov     r1, r5\n"
"    bl      sub_fc35b984\n"
"loc_fc2445e2:\n"
// nr hook
"bl capt_seq_hook_set_nr\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_nr_call\n"
#endif
"    mov     r0, r4\n"
"    bl      sub_fc18ddc2\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r3, #4\n"
"    movs    r1, #0x93\n"
"    add     r2, sp, #4\n"
"    bl      sub_fc35ba00\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc244604\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1dd\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc244604:\n"
// later than this point crashes with a HardwareDefect 14
"    BL      wait_until_remote_button_is_released\n" // + remote hook, might be able to go later
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_remote_hook\n"
#endif
"    ldrh    r0, [r4, #0x18]\n"
"    cbnz    r0, loc_fc244612\n"
"    ldr     r1, [r4, #0x60]\n"
"    mov     r0, r4\n"
"    ldr     r2, [sp, #4]\n"
"    bl      sub_fc18d68c\n"
"loc_fc244612:\n"
"    ldr.w   r0, [r7, #0x188]\n"
"    cbz     r0, loc_fc24461c\n"
"    bl      sub_fc18db4e\n"
"loc_fc24461c:\n"
"    bl      sub_fc309f48\n"
"    cbz     r0, loc_fc244626\n"
"    bl      sub_fc112730\n"
"loc_fc244626:\n"
"    ldr     r0, =0x0003e914\n"
"    ldr     r0, [r0]\n"
"    cbnz    r0, loc_fc244638\n"
"    ldr.w   r0, [r7, #0x19c]\n"
"    cbz     r0, loc_fc244638\n"
"    mov     r0, r4\n"
"    bl      sub_fc18ea86\n" //  return
"loc_fc244638:\n"
"    ldr     r1, =0x00021c64\n"
"    ldr     r0, [sp, #4]\n"
"    str     r0, [r1]\n"
"    bl      sub_fc0f75b2\n"
"    bl      sub_fc18de66\n"
"    movs    r1, #0\n"
"    mov     r0, r4\n"
"    bl      sub_fc2449e2\n"
"    mov     r6, r0\n"
"    ldr     r0, [sp, #0xc]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc24465e\n"
"    ldr     r5, =0xfc18db19\n"
"    b       loc_fc244660\n"
"loc_fc24465e:\n"
"    ldr     r5, =0xfc18db2f\n"
"loc_fc244660:\n"
"    ldrh    r0, [r4, #0x18]\n"
"    cbz     r0, loc_fc244682\n"
"    cmp     r0, #1\n"
"    beq     loc_fc244692\n"
"    cmp     r0, #4\n"
"    bne     loc_fc244706\n"
"    str     r6, [sp]\n"
"    mov     r3, r5\n"
"    ldr     r1, [r4, #0x60]\n"
"    mov     r0, r4\n"
"    ldr     r2, [sp, #4]\n"
"    bl      sub_fc18d6ea\n"
"loc_fc24467a:\n"
"    mov     r5, r0\n"
"    bl      sub_fc3c9dba\n"
"    b       loc_fc244714\n"
"loc_fc244682:\n"
"    str     r6, [sp]\n"
"    mov     r3, r5\n"
"    ldr     r1, [r4, #0x60]\n"
"    mov     r0, r4\n"
"    ldr     r2, [sp, #4]\n"
"    bl      sub_fc18d5a2\n"
"    b       loc_fc24467a\n"
"loc_fc244692:\n"
"    ldr.w   r0, [r7, #0xc4]\n"
"    cbz     r0, loc_fc2446a4\n"
"    movs    r0, #0\n"
"    movw    r2, #0x221\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc2446a4:\n"
"    str     r6, [sp]\n"
"    mov     r3, r5\n"
"    ldr     r1, [r4, #0x60]\n"
"    mov     r0, r4\n"
"    ldr     r2, [sp, #4]\n"
"    bl      sub_fc18d716\n"
"    movs    r2, #1\n"
"    mov     r5, r0\n"
"    movs    r1, #0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc28061e\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc244714\n"
"    ldr.w   r0, [r7, #0xfc]\n"
"    cbz     r0, loc_fc2446d8\n"
"    ldr     r1, [r4, #8]\n"
"    ldr     r2, =0x001dbfb8\n"
"    ldr     r0, [r4, #0x60]\n"
"    add.w   r1, r2, r1, lsl #2\n"
"    str     r0, [r1, #-0x4]\n"
"    b       loc_fc2446fe\n"
"loc_fc2446d8:\n"
"    ldr     r0, =0xfc244521\n"
"    movs    r1, #0\n"
"    bl      sub_fc1137b0\n"
"    movs    r1, #1\n"
"    mov     r0, r4\n"
"    bl      sub_fc2449e2\n"
"    mov     r6, r0\n"
"    ldr     r0, [sp, #4]\n"
"    bl      sub_fc18dbaa\n"
"    ldr     r1, [r4, #0x60]\n"
"    mov     r3, r6\n"
"    ldr     r2, [sp, #4]\n"
"    mov     r0, r4\n"
"    bl      sub_fc18d78a\n"
"    mov     r5, r0\n"
"loc_fc2446fe:\n"
"    movs    r0, #0\n"
"    bl      sub_fc18d580\n"
"    b       loc_fc244714\n"
"loc_fc244706:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x24b\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"    movs    r5, #0x1d\n"
"loc_fc244714:\n"
"    bl      sub_fc18de6a\n"
"    ldr.w   r8, =0xfc244521\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc244770\n"
"    ldr.w   r0, [r7, #0x104]\n"
"    cbnz    r0, loc_fc24473c\n"
"    mov     r0, r4\n"
"    bl      sub_fc18f2f8\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc24473c\n"
"    movs    r0, #0\n"
"    movw    r2, #0x268\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc24473c:\n"
// raw hook
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_rh\n"
#endif
"    BL      capt_seq_hook_raw_here\n"
"    BL      clear_current_raw_addr\n"
"    mov     r0, r4\n"
"    bl      sub_fc18de56\n"
"    mov     r0, r4\n"
"    bl      sub_fc18de2a\n"
"    cmp     r6, r8\n"
"    beq     loc_fc244770\n"
"    bl      sub_fc18e896\n"
"    movs    r1, #4\n"
"    movw    sb, #0x275\n"
"    ldr     r3, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sb, [sp]\n"
"    bl      sub_fc309ea8\n"
"    cbz     r0, loc_fc244770\n"
"    movs    r0, #0\n"
"    mov     r2, sb\n"
"    ldr     r1, =0xfc244924\n" //  *"SsStandardCaptureSeq.c"
"    bl      _DebugAssert\n"
"loc_fc244770:\n"
"    ldr.w   r0, [r7, #0x188]\n"
"    cbz     r0, loc_fc244780\n"
"    movs    r2, #1\n"
"    movs    r1, #0\n"
"    movs    r0, #0x46\n"
"    bl      sub_fc28061e\n"
"loc_fc244780:\n"
"    movs    r1, #2\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc0f110c\n"
"    ldr     r0, [r7, #0x24]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc2447a6\n"
"    cmp     r6, r0\n"
"    beq     loc_fc24479a\n"
"    movs    r1, #1\n"
"    b       loc_fc24479c\n"
"loc_fc24479a:\n"
"    movs    r1, #0\n"
"loc_fc24479c:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc18ed5c\n"
"    b       loc_fc2447b8\n"
"loc_fc2447a6:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc2447ae\n"
"    movs    r1, #1\n"
"    b       loc_fc2447b0\n"
"loc_fc2447ae:\n"
"    movs    r1, #0\n"
"loc_fc2447b0:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc18ed16\n"
"loc_fc2447b8:\n"
"    add     sp, #0x10\n"
"    mov     r0, r5\n"
"    pop.w   {r4, r5, r6, r7, r8, sb, sl, pc}\n"
".ltorg\n"
    );
}

// exp_drv not needed for extended exposure, probably works up to 1024s but required for shorter than 1/3200
// literal pool fc2af418-fc2af434
// -f=chdk -s=task_ExpDrvTask -c=494
void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
// task_ExpDrv 0xfc2af0a3
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   fp, =0x0000e1d0\n"
"    ldr.w   sl, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr.w   r8, =0x00065508\n"
"    movs    r4, #0x47\n"
"    add.w   sb, sp, #0x1c\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc2af0be:\n"
"    ldr.w   r0, [fp, #0x20]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r5, fp\n"
"    bl      sub_fc344686\n" // ReceiveMessageQueue
"    ldr     r0, [sp, #0x28]\n"
"    movs    r1, #0\n"
"    cmp     r4, #0x19\n"
"    ldr     r0, [r0]\n"
"    beq     loc_fc2af0ea\n"
"    cmp     r4, #0x1a\n"
"    beq     loc_fc2af0ea\n"
"    cmp     r4, #0x1b\n"
"    beq     loc_fc2af0ea\n"
"    cmp     r4, #0x1c\n"
"    beq     loc_fc2af0ea\n"
"    cmp     r4, #0x1d\n"
"    beq     loc_fc2af0ea\n"
"    cmp     r4, #0x1e\n"
"    bne     loc_fc2af10c\n"
"loc_fc2af0ea:\n"
"    cmp     r0, #0x19\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x1a\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x1b\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x1c\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x1d\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x1e\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x44\n"
"    beq     loc_fc2af10c\n"
"    cmp     r0, #0x3f\n"
"    beq     loc_fc2af10c\n"
"    movs    r1, #1\n"
"loc_fc2af10c:\n"
"    cmp     r1, #1\n"
"    bne     loc_fc2af118\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2af05e\n"
"loc_fc2af118:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x44\n"
"    beq     loc_fc2af1ca\n"
"    cmp     r1, #0x47\n"
"    mov     r4, r1\n"
"    bne     loc_fc2af13c\n"
"    bl      sub_fc2b0374\n"
"    ldr.w   r0, [fp, #0x1c]\n"
"    movs    r1, #1\n"
"    bl      _SetEventFlag\n"
"    bl      _ExitTask\n"
// below should not be reached
//"    add     sp, #0x2c\n"
//"    b       loc_fc2aede6\n" //  return
"loc_fc2af13c:\n"
"    cmp     r1, #0x46\n"
"    bne     loc_fc2af14e\n"
"    add.w   r0, r0, #0xac\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc2af614\n"
"loc_fc2af14e:\n"
"    cmp     r1, #0x3d\n"
"    bne     loc_fc2af186\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc369bc2\n" // ClearEventFlag
"    ldr     r0, =0xfc2aa815\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc0ecd5a\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r1, #0x80\n"
"    movw    r2, #0xbb8\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2af178\n"
"    movw    r2, #0x1aa6\n"
"    b       loc_fc2af216\n"
"loc_fc2af178:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc2af614\n"
"loc_fc2af186:\n"
"    cmp     r1, #0x3e\n"
"    bne     loc_fc2af1ba\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2af05e\n"
"    movw    r6, #0x100\n"
"    ldr     r0, [r5, #0x1c]\n"
"    mov     r1, r6\n"
"    bl      sub_fc369bc2\n" // ClearEventFlag
"    ldr     r0, =0xfc2aa81f\n"
"    mov     r1, r6\n"
"    bl      sub_fc0ed72c\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movw    r2, #0xbb8\n"
"    mov     r1, r6\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2af178\n"
"    movw    r2, #0x1ab0\n"
"    b       loc_fc2af216\n"
"loc_fc2af1ba:\n"
"    cmp     r1, #0x3f\n"
"    bne     loc_fc2af1c6\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2af05e\n"
"    b       loc_fc2af178\n"
"loc_fc2af1c6:\n"
"    cmp     r1, #0x44\n"
"    bne     loc_fc2af1d8\n"
"loc_fc2af1ca:\n"
"    bl      sub_fc3c6f88\n"
"    bl      sub_fc13cd64\n"
"    bl      sub_fc13ca44\n"
"    b       loc_fc2af178\n"
"loc_fc2af1d8:\n"
"    cmp     r1, #0x45\n"
"    bne     loc_fc2af220\n"
"    ldr     r0, [r5, #0x44]\n"
"    bl      sub_fc30eca6\n"
"    movs    r1, #4\n"
"    mov     r6, r0\n"
"    ldr     r0, [r5, #0x1c]\n"
"    bl      sub_fc369bc2\n" // ClearEventFlag
"    movs    r3, #1\n"
"    ldr     r2, =0xfc2aa833\n"
"    mov     r1, r6\n"
"    mov     r0, sl\n"
"    str     r3, [sp]\n"
"    str     r3, [sp, #4]\n"
"    movs    r3, #4\n"
"    bl      sub_fc2aae72\n"
"    bl      sub_fc3c6c90\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r1, #4\n"
"    movw    r2, #0xbb8\n"
"    bl      sub_fc369998\n" // WaitForAnyEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2af178\n"
"    movw    r2, #0x1bba\n"
"loc_fc2af216:\n"
"    ldr     r1, =0xfc2ab038\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"    b       loc_fc2af178\n"
"loc_fc2af220:\n"
"    movs    r6, #1\n"
"    cmp     r1, #0x17\n"
"    beq     loc_fc2af22a\n"
"    cmp     r1, #0x18\n"
"    bne     loc_fc2af268\n"
"loc_fc2af22a:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r5, sb\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r5!, {r2, r3, r7}\n"
"    bl      sub_fc2ad82a\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2b04ee\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x20]\n"
"    b       loc_fc2af510\n"
"loc_fc2af268:\n"
"    cmp     r1, #0x19\n"
"    beq     loc_fc2af280\n"
"    cmp     r1, #0x1a\n"
"    beq     loc_fc2af280\n"
"    cmp     r1, #0x1b\n"
"    beq     loc_fc2af280\n"
"    cmp     r1, #0x1c\n"
"    beq     loc_fc2af280\n"
"    cmp     r1, #0x1d\n"
"    beq     loc_fc2af280\n"
"    cmp     r1, #0x1e\n"
"    bne     loc_fc2af2f2\n"
"loc_fc2af280:\n"
"    add     r3, sp, #0xc\n"
"    mov     r2, sp\n"
"    add     r1, sp, #0x1c\n"
"    bl      sub_fc2ada14\n"
"    cmp     r0, #1\n"
"    mov     r5, r0\n"
"    beq     loc_fc2af294\n"
"    cmp     r5, #5\n"
"    bne     loc_fc2af2aa\n"
"loc_fc2af294:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r5\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc2af2d0\n"
"loc_fc2af2aa:\n"
"    cmp     r5, #2\n"
"    beq     loc_fc2af2b2\n"
"    cmp     r5, #6\n"
"    bne     loc_fc2af2dc\n"
"loc_fc2af2b2:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r5\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc2aedea\n"
"loc_fc2af2d0:\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r5\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2af00e\n"
"loc_fc2af2da:\n"
"    b       loc_fc2af516\n"
"loc_fc2af2dc:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r5\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc2af516\n"
"loc_fc2af2f2:\n"
"    cmp     r1, #0x36\n"
"    beq     loc_fc2af2fa\n"
"    cmp     r1, #0x37\n"
"    bne     loc_fc2af36a\n"
"loc_fc2af2fa:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r7, sb\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1, {r1, r2, r3}\n"
"    stm     r7!, {r1, r2, r3}\n"
"    bl      sub_fc2ac9c2\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    bl      sub_fc3c6f88\n"
"    bl      sub_fc13cd64\n"
"    bl      sub_fc13ca44\n"
"    movw    r7, #0xbb8\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r1, #2\n"
"    mov     r2, r7\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2af34e\n"
"    ldr     r1, =0xfc2ab038\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xf05\n"
"    bl      _DebugAssert\n"
"loc_fc2af34e:\n"
"    ldr     r0, [r5, #0x1c]\n"
"    movs    r1, #0x20\n"
"    mov     r2, r7\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2af2da\n"
"    ldr     r1, =0xfc2ab038\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xf09\n"
"    bl      _DebugAssert\n"
"    b       loc_fc2af516\n"
"loc_fc2af36a:\n"
"    adds    r2, r0, #4\n"
"    mov     r1, sb\n"
"    ldm     r2!, {r3, r5, r7}\n"
"    stm     r1!, {r3, r5, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x3d\n"
"    bhs     loc_fc2af3be\n"
"    tbb     [pc, r1]\n" // (jumptable r1 61 elements)
"branchtable_fc2af37c:\n"
"    .byte((loc_fc2af3ba - branchtable_fc2af37c) / 2)\n" // (case 0)
"    .byte((loc_fc2af3ba - branchtable_fc2af37c) / 2)\n" // (case 1)
"    .byte((loc_fc2af3ba - branchtable_fc2af37c) / 2)\n" // (case 2)
"    .byte((loc_fc2af3c0 - branchtable_fc2af37c) / 2)\n" // (case 3)
"    .byte((loc_fc2af3c6 - branchtable_fc2af37c) / 2)\n" // (case 4)
"    .byte((loc_fc2af3c6 - branchtable_fc2af37c) / 2)\n" // (case 5)
"    .byte((loc_fc2af3c6 - branchtable_fc2af37c) / 2)\n" // (case 6)
"    .byte((loc_fc2af3ba - branchtable_fc2af37c) / 2)\n" // (case 7)
"    .byte((loc_fc2af3c0 - branchtable_fc2af37c) / 2)\n" // (case 8)
"    .byte((loc_fc2af3c6 - branchtable_fc2af37c) / 2)\n" // (case 9)
"    .byte((loc_fc2af3c6 - branchtable_fc2af37c) / 2)\n" // (case 10)
"    .byte((loc_fc2af3d8 - branchtable_fc2af37c) / 2)\n" // (case 11)
"    .byte((loc_fc2af3d8 - branchtable_fc2af37c) / 2)\n" // (case 12)
"    .byte((loc_fc2af3de - branchtable_fc2af37c) / 2)\n" // (case 13)
"    .byte((loc_fc2af3de - branchtable_fc2af37c) / 2)\n" // (case 14)
"    .byte((loc_fc2af3de - branchtable_fc2af37c) / 2)\n" // (case 15)
"    .byte((loc_fc2af3de - branchtable_fc2af37c) / 2)\n" // (case 16)
"    .byte((loc_fc2af4f4 - branchtable_fc2af37c) / 2)\n" // (case 17)
"    .byte((loc_fc2af4fa - branchtable_fc2af37c) / 2)\n" // (case 18)
"    .byte((loc_fc2af4fa - branchtable_fc2af37c) / 2)\n" // (case 19)
"    .byte((loc_fc2af4fa - branchtable_fc2af37c) / 2)\n" // (case 20)
"    .byte((loc_fc2af4fa - branchtable_fc2af37c) / 2)\n" // (case 21)
"    .byte((loc_fc2af500 - branchtable_fc2af37c) / 2)\n" // (case 22)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 23)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 24)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 25)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 26)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 27)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 28)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 29)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 30)
"    .byte((loc_fc2af3cc - branchtable_fc2af37c) / 2)\n" // (case 31)
"    .byte((loc_fc2af3d2 - branchtable_fc2af37c) / 2)\n" // (case 32)
"    .byte((loc_fc2af3d2 - branchtable_fc2af37c) / 2)\n" // (case 33)
"    .byte((loc_fc2af3d2 - branchtable_fc2af37c) / 2)\n" // (case 34)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 35)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 36)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 37)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 38)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 39)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 40)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 41)
"    .byte((loc_fc2af3e4 - branchtable_fc2af37c) / 2)\n" // (case 42)
"    .byte((loc_fc2af3ea - branchtable_fc2af37c) / 2)\n" // (case 43)
"    .byte((loc_fc2af43e - branchtable_fc2af37c) / 2)\n" // (case 44)
"    .byte((loc_fc2af472 - branchtable_fc2af37c) / 2)\n" // (case 45)
"    .byte((loc_fc2af472 - branchtable_fc2af37c) / 2)\n" // (case 46)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 47)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 48)
"    .byte((loc_fc2af47a - branchtable_fc2af37c) / 2)\n" // (case 49)
"    .byte((loc_fc2af47a - branchtable_fc2af37c) / 2)\n" // (case 50)
"    .byte((loc_fc2af4ae - branchtable_fc2af37c) / 2)\n" // (case 51)
"    .byte((loc_fc2af4e2 - branchtable_fc2af37c) / 2)\n" // (case 52)
"    .byte((loc_fc2af4e2 - branchtable_fc2af37c) / 2)\n" // (case 53)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 54)
"    .byte((loc_fc2af504 - branchtable_fc2af37c) / 2)\n" // (case 55)
"    .byte((loc_fc2af4e8 - branchtable_fc2af37c) / 2)\n" // (case 56)
"    .byte((loc_fc2af4e8 - branchtable_fc2af37c) / 2)\n" // (case 57)
"    .byte((loc_fc2af4e8 - branchtable_fc2af37c) / 2)\n" // (case 58)
"    .byte((loc_fc2af4ee - branchtable_fc2af37c) / 2)\n" // (case 59)
"    .byte((loc_fc2af4ee - branchtable_fc2af37c) / 2)\n" // (case 60)
".align 1\n"
"loc_fc2af3ba:\n"
"    bl      sub_fc2ab0e0\n"
"loc_fc2af3be:\n"
"    b       loc_fc2af504\n"
"loc_fc2af3c0:\n"
"    bl      sub_fc2ab36e\n"
"    b       loc_fc2af504\n"
"loc_fc2af3c6:\n"
"    bl      sub_fc2ab5a2\n"
"    b       loc_fc2af504\n"
"loc_fc2af3cc:\n"
"    bl      sub_fc2ab868\n"
"    b       loc_fc2af504\n"
"loc_fc2af3d2:\n"
"    bl      sub_fc2aba2e\n"
"    b       loc_fc2af504\n"
"loc_fc2af3d8:\n"
"    bl      sub_fc2abe8c\n"
"    b       loc_fc2af504\n"
"loc_fc2af3de:\n"
//"    bl      sub_fc2abf7e\n"
"    bl      sub_fc2abf7e_my\n" // ->
"    b       loc_fc2af476\n"
"loc_fc2af3e4:\n"
"    bl      sub_fc2ac078\n"
"    b       loc_fc2af504\n"
"loc_fc2af3ea:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh.w  r2, [r8, #2]\n"
"    strh.w  r2, [sp, #0x1e]\n"
"    ldrh.w  r2, [r8, #4]\n"
"    strh.w  r2, [sp, #0x20]\n"
"    ldrh.w  r2, [r8, #6]\n"
"    strh.w  r2, [sp, #0x22]\n"
"    ldrh    r2, [r0, #0xc]\n"
"    strh.w  r2, [sp, #0x24]\n"
"    ldrh.w  r1, [r8, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    b       loc_fc2af438\n"
".ltorg\n"
// firmware had literal pool here
// d0 e1 00 00
// 38 b0 2a fc
// 29 a8 2a fc
// 08 55 06 00
// 00 f4 ff ff
// 15 a8 2a fc
// 15 a8 2a fc
// 33 a8 2a fc
"loc_fc2af438:\n"
"    bl      sub_fc2ac652\n"
"    b       loc_fc2af504\n"
"loc_fc2af43e:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh.w  r2, [r8, #2]\n"
"    strh.w  r2, [sp, #0x1e]\n"
"    ldrh.w  r2, [r8, #4]\n"
"    strh.w  r2, [sp, #0x20]\n"
"    ldrh.w  r2, [r8, #6]\n"
"    strh.w  r2, [sp, #0x22]\n"
"    ldrh.w  r2, [r8, #8]\n"
"    strh.w  r2, [sp, #0x24]\n"
"    ldrh.w  r1, [r8, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2ac70c\n"
"    b       loc_fc2af504\n"
"loc_fc2af472:\n"
"    bl      sub_fc2ac70c\n"
"loc_fc2af476:\n"
"    movs    r6, #0\n"
"    b       loc_fc2af504\n"
"loc_fc2af47a:\n"
"    ldrh.w  r2, [r8]\n"
"    strh.w  r2, [sp, #0x1c]\n"
"    ldrh    r2, [r0, #6]\n"
"    strh.w  r2, [sp, #0x1e]\n"
"    ldrh.w  r2, [r8, #4]\n"
"    strh.w  r2, [sp, #0x20]\n"
"    ldrh.w  r2, [r8, #6]\n"
"    strh.w  r2, [sp, #0x22]\n"
"    ldrh.w  r2, [r8, #8]\n"
"    strh.w  r2, [sp, #0x24]\n"
"    ldrh.w  r1, [r8, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2b03f0\n"
"    b       loc_fc2af504\n"
"loc_fc2af4ae:\n"
"    ldrh.w  r2, [r8]\n"
"    strh.w  r2, [sp, #0x1c]\n"
"    ldrh.w  r2, [r8, #2]\n"
"    strh.w  r2, [sp, #0x1e]\n"
"    ldrh.w  r2, [r8, #4]\n"
"    strh.w  r2, [sp, #0x20]\n"
"    ldrh.w  r2, [r8, #6]\n"
"    strh.w  r2, [sp, #0x22]\n"
"    ldrh    r2, [r0, #0xc]\n"
"    strh.w  r2, [sp, #0x24]\n"
"    ldrh.w  r1, [r8, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2b047c\n"
"    b       loc_fc2af504\n"
"loc_fc2af4e2:\n"
"    bl      sub_fc2ac7a6\n"
"    b       loc_fc2af504\n"
"loc_fc2af4e8:\n"
"    bl      sub_fc2acdcc\n"
"    b       loc_fc2af504\n"
"loc_fc2af4ee:\n"
"    bl      sub_fc2ad1a4\n"
"    b       loc_fc2af504\n"
"loc_fc2af4f4:\n"
"    bl      sub_fc2ad3ee\n"
"    b       loc_fc2af504\n"
"loc_fc2af4fa:\n"
"    bl      sub_fc2ad554\n"
"    b       loc_fc2af504\n"
"loc_fc2af500:\n"
"    bl      sub_fc2ad682\n"
"loc_fc2af504:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"loc_fc2af510:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc2af516:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x14\n"
"    beq     loc_fc2af570\n"
"    bgt     loc_fc2af532\n"
"    cmp     r0, #1\n"
"    beq     loc_fc2af542\n"
"    cmp     r0, #5\n"
"    beq     loc_fc2af542\n"
"    cmp     r0, #0x12\n"
"    beq     loc_fc2af570\n"
"    cmp     r0, #0x13\n"
"    bne     loc_fc2af586\n"
"    b       loc_fc2af542\n"
"loc_fc2af532:\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc2af542\n"
"    cmp     r0, #0x18\n"
"    beq     loc_fc2af542\n"
"    cmp     r0, #0x1e\n"
"    beq     loc_fc2af542\n"
"    cmp     r0, #0x21\n"
"    bne     loc_fc2af586\n"
"loc_fc2af542:\n"
"    ldrsh.w r0, [r8]\n"
"    mov     r1, r8\n"
"    mov     r2, sl\n"
"    cmp     r0, sl\n"
"    beq     loc_fc2af556\n"
"    ldrsh.w r1, [r1, #8]\n"
"    cmp     r1, r2\n"
"    bne     loc_fc2af566\n"
"loc_fc2af556:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc2f8d68\n" // get_current_exp
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    b       loc_fc2af57e\n"
"loc_fc2af566:\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    b       loc_fc2af586\n"
"loc_fc2af570:\n"
"    ldrsh.w r0, [r8, #8]\n"
"    cmp     r0, sl\n"
"    bne     loc_fc2af582\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc2f8d68\n" // get_current_exp
"loc_fc2af57e:\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"loc_fc2af582:\n"
"    strh.w  r0, [sp, #0x24]\n"
"loc_fc2af586:\n"
"    cmp     r6, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc2af5be\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r5, r0, r1, lsl #2\n"
"    ldr     r0, =0x00065508\n"
"    subs    r5, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc301dbc\n"
"    ldr     r0, =0x00065508\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc301dbc\n"
"    ldr     r0, =0x00065508\n"
"    movs    r2, #0xc\n"
"    mov     r1, r5\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc301dbc\n"
"    b       loc_fc2af614\n"
"loc_fc2af5be:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xf\n"
"    bne     loc_fc2af5e8\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc2aaeac\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc2af610\n"
"loc_fc2af5e8:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc2aaeac\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x2f\n"
"    beq     loc_fc2af614\n"
"    cmp     r0, #0x30\n"
"    beq     loc_fc2af614\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc2af610:\n"
"    bl      sub_fc2ab05c\n"
"loc_fc2af614:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2b0374\n"
"    b       loc_fc2af0be\n"
".ltorg\n"
    );
}

// -f=chdk -s=0xfc2abf7f -eret
void __attribute__((naked,noinline)) sub_fc2abf7e_my() {
    asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000e1d0\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x1c]\n"
"    bl      sub_fc369bc2\n" // ClearEventFlag
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc2aa874\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc2aaa0e\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc2aaa54\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc2aaa9a\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc2aaae0\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x00065520\n"
"    cmp     r0, #0xf\n"
"    beq     loc_fc2abfd0\n"
"    cmp     r0, #0x10\n"
"    bne     loc_fc2abfd6\n"
"loc_fc2abfd0:\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc2abfee\n"
"loc_fc2abfd6:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc2abfee\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc2aa80b\n"
"    bl      sub_fc0ecf9e\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x28]\n"
"    b       loc_fc2abff4\n"
"loc_fc2abfee:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc2abff4:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc2ac006\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc2aa85f\n"
"    bl      sub_fc2b03c6\n"
"    b       loc_fc2ac00a\n"
"loc_fc2ac006:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc2ac00a:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
//"    bl      sub_fc3c6d08\n"
"    bl      sub_fc3c6d08_my\n" // ->
"    ldr     pc, =0xfc2ac015\n" // continue in firmware
".ltorg\n"
/*
"    ldrsh.w r0, [r4, #8]\n"
"    movs    r1, #1\n"
"    bl      sub_fc13c774\n"
"    movs    r1, #0\n"
"    add.w   r0, r4, #8\n"
"    bl      sub_fc13c7dc\n"
"    ldrsh.w r0, [r4, #0xe]\n"
"    bl      sub_fc120df8\n"
"    cmp     r6, #1\n"
"    movw    r4, #0xbb8\n"
"    bne     loc_fc2ac052\n"
"    ldr     r0, [r7, #0x1c]\n"
"    movs    r1, #2\n"
"    mov     r2, r4\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2ac052\n"
"    ldr     r1, =0xfc2ab038\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xa27\n"
"    bl      _DebugAssert\n"
"loc_fc2ac052:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc2ac074\n" //  return
"    ldr     r0, [r7, #0x1c]\n"
"    movs    r1, #0x20\n"
"    mov     r2, r4\n"
"    bl      sub_fc369a18\n" // WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2ac074\n" //  return
"    pop.w   {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r1, =0xfc2ab038\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xa2d\n"
"    b.w     _DebugAssert\n"
"loc_fc2ac074:\n"
"    pop.w   {r4, r5, r6, r7, r8, pc}\n"
*/
    );
}

// -f=chdk -s=0xfc3c6d09 -eret
void __attribute__((naked,noinline)) sub_fc3c6d08_my() {
asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000f0f4\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc3c6d22\n"
"    movw    r2, #0x174\n"
"    ldr     r1, =0xfc3c6cf0\n" //  *"Shutter.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"loc_fc3c6d22:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc3c6d2c\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc3c6d2c:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc3c6d40\n"
"    movw    r2, #0x17a\n"
"    ldr     r1, =0xfc3c6cf0\n" //  *"Shutter.c"
"    movs    r0, #0\n"
"    bl      _DebugAssert\n"
"loc_fc3c6d40:\n"
"    mov     r0, r4\n"
//"    bl      _apex2us\n"
"    bl      apex2us\n" // +
"    ldr     pc, =0xfc3c6d47\n" // jump back to firmware
/*
"    mov     r4, r0\n"
"    bl      sub_fc3c64d6\n" //  return
"    mov     r0, r4\n"
"    bl      sub_fc1419f4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc3c6d68\n" //  return
"    movw    r2, #0x17f\n"
"    ldr     r1, =0xfc3c6cf0\n" //  *"Shutter.c"
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    b.w     _DebugAssert\n"
"loc_fc3c6d68:\n"
"    pop     {r4, r5, r6, pc}\n"
*/
".ltorg\n"
    );
}
