#include "lolevel.h"
#include "platform.h"
#include "core.h"

//#define CAPTSEQ_DEBUG 1
#undef CAPTSEQ_DEBUG

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (0)                 // have to explictly reset value back to 0 to enable auto

extern int active_raw_buffer;
// debug
extern void _LogCameraEvent(int id,const char *fmt,...);

extern char *hook_raw_image_addr(void);

#ifdef CAPTSEQ_DEBUG
void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook1 %d", *(unsigned*)0xc0242014);
}
void log_remote_hook2(void) {
    _LogCameraEvent(0x60,"remote hook2 %d", *(unsigned*)0xc0242014);
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook");
}
#endif

#include "../../../generic/capt_seq.c"

void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile ( //  capdis -stubs -f=chdk -s=task_CaptSeqTask -c=179 PRIMARY.BIN 0xfc000000
// task_CaptSeqTask 0xfc0bce67
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x0005dd60\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000b1f8\n"
"loc_fc0bce6e:\n"
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #8]\n"
"    blx     sub_fc314ce0\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0bce90\n"
"    movw    r2, #0x455\n"
"    ldr     r1, =0xfc0bca88\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"    blx     sub_fc314d08\n" // -> ExitTask
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc0bce90:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc0bcea8\n"
"    cmp     r0, #0x27\n"
"    beq     loc_fc0bcea8\n"
"    cmp     r0, #0x1c\n"
"    beq     loc_fc0bcea8\n"
"    cmp     r0, #0x1f\n"
"    beq     loc_fc0bcea8\n"
"    bl      sub_fc18c16c\n"
"loc_fc0bcea8:\n"
#ifdef CAPTSEQ_DEBUG
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2e\n"
"    bhs     loc_fc0bcf6a\n"
"    tbb     [pc, r1]\n" // (jumptable r1 46 elements)
"branchtable_fc0bceb4:\n"
"    .byte((loc_fc0bcee2 - branchtable_fc0bceb4) / 2)\n" // (case 0)
"    .byte((loc_fc0bcef8 - branchtable_fc0bceb4) / 2)\n" // (case 1)
"    .byte((loc_fc0bcf00 - branchtable_fc0bceb4) / 2)\n" // (case 2)
"    .byte((loc_fc0bcf0e - branchtable_fc0bceb4) / 2)\n" // (case 3)
"    .byte((loc_fc0bcf08 - branchtable_fc0bceb4) / 2)\n" // (case 4)
"    .byte((loc_fc0bcf18 - branchtable_fc0bceb4) / 2)\n" // (case 5)
"    .byte((loc_fc0bcf1e - branchtable_fc0bceb4) / 2)\n" // (case 6)
"    .byte((loc_fc0bcf5c - branchtable_fc0bceb4) / 2)\n" // (case 7)
"    .byte((loc_fc0bcf2e - branchtable_fc0bceb4) / 2)\n" // (case 8)
"    .byte((loc_fc0bcf36 - branchtable_fc0bceb4) / 2)\n" // (case 9)
"    .byte((loc_fc0bcf3c - branchtable_fc0bceb4) / 2)\n" // (case 10)
"    .byte((loc_fc0bcf44 - branchtable_fc0bceb4) / 2)\n" // (case 11)
"    .byte((loc_fc0bcf4a - branchtable_fc0bceb4) / 2)\n" // (case 12)
"    .byte((loc_fc0bcf50 - branchtable_fc0bceb4) / 2)\n" // (case 13)
"    .byte((loc_fc0bcf56 - branchtable_fc0bceb4) / 2)\n" // (case 14)
"    .byte((loc_fc0bcf64 - branchtable_fc0bceb4) / 2)\n" // (case 15)
"    .byte((loc_fc0bcf78 - branchtable_fc0bceb4) / 2)\n" // (case 16)
"    .byte((loc_fc0bcf7e - branchtable_fc0bceb4) / 2)\n" // (case 17)
"    .byte((loc_fc0bcf84 - branchtable_fc0bceb4) / 2)\n" // (case 18)
"    .byte((loc_fc0bcf8a - branchtable_fc0bceb4) / 2)\n" // (case 19)
"    .byte((loc_fc0bcf8e - branchtable_fc0bceb4) / 2)\n" // (case 20)
"    .byte((loc_fc0bcf94 - branchtable_fc0bceb4) / 2)\n" // (case 21)
"    .byte((loc_fc0bcf9a - branchtable_fc0bceb4) / 2)\n" // (case 22)
"    .byte((loc_fc0bcfa0 - branchtable_fc0bceb4) / 2)\n" // (case 23)
"    .byte((loc_fc0bcfa6 - branchtable_fc0bceb4) / 2)\n" // (case 24)
"    .byte((loc_fc0bcfac - branchtable_fc0bceb4) / 2)\n" // (case 25)
"    .byte((loc_fc0bcfb4 - branchtable_fc0bceb4) / 2)\n" // (case 26)
"    .byte((loc_fc0bcfba - branchtable_fc0bceb4) / 2)\n" // (case 27)
"    .byte((loc_fc0bcfbe - branchtable_fc0bceb4) / 2)\n" // (case 28)
"    .byte((loc_fc0bcfc6 - branchtable_fc0bceb4) / 2)\n" // (case 29)
"    .byte((loc_fc0bcfcc - branchtable_fc0bceb4) / 2)\n" // (case 30)
"    .byte((loc_fc0bcfd2 - branchtable_fc0bceb4) / 2)\n" // (case 31)
"    .byte((loc_fc0bcfd8 - branchtable_fc0bceb4) / 2)\n" // (case 32)
"    .byte((loc_fc0bcfde - branchtable_fc0bceb4) / 2)\n" // (case 33)
"    .byte((loc_fc0bcfe4 - branchtable_fc0bceb4) / 2)\n" // (case 34)
"    .byte((loc_fc0bcfea - branchtable_fc0bceb4) / 2)\n" // (case 35)
"    .byte((loc_fc0bcff2 - branchtable_fc0bceb4) / 2)\n" // (case 36)
"    .byte((loc_fc0bcff8 - branchtable_fc0bceb4) / 2)\n" // (case 37)
"    .byte((loc_fc0bd01c - branchtable_fc0bceb4) / 2)\n" // (case 38)
"    .byte((loc_fc0bd022 - branchtable_fc0bceb4) / 2)\n" // (case 39)
"    .byte((loc_fc0bd05a - branchtable_fc0bceb4) / 2)\n" // (case 40)
"    .byte((loc_fc0bd02e - branchtable_fc0bceb4) / 2)\n" // (case 41)
"    .byte((loc_fc0bd034 - branchtable_fc0bceb4) / 2)\n" // (case 42)
"    .byte((loc_fc0bd03a - branchtable_fc0bceb4) / 2)\n" // (case 43)
"    .byte((loc_fc0bd040 - branchtable_fc0bceb4) / 2)\n" // (case 44)
"    .byte((loc_fc0bd046 - branchtable_fc0bceb4) / 2)\n" // (case 45)
".align 1\n"
"loc_fc0bcee2:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d4f20\n"
#ifdef CAPTSEQ_DEBUG
"bl log_capt_seq_override\n" // debug
#endif
"    bl      shooting_expo_param_override\n" // +
"    bl      sub_fc101d70\n"
"    ldr     r0, [r4, #0x28]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc0bcef6\n"
"    bl      sub_fc0dd248_my\n"             // ->
"loc_fc0bcef6:\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcef8:\n"
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc0dd0dc_my\n"             // ->
"    b       loc_fc0bd05a\n"
"loc_fc0bcf00:\n"
"    movs    r0, #1\n"
"    bl      sub_fc0d51b0\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf08:\n"
"    bl      sub_fc0d4c64\n"
"    b       loc_fc0bcf14\n"
"loc_fc0bcf0e:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d4f08\n"
"loc_fc0bcf14:\n"
"    str     r6, [r4, #0x28]\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf18:\n"
"    bl      sub_fc0d4f0e\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf1e:\n"
"    bl      sub_fc0d5152\n"
"    bl      sub_fc101d70\n"
"    movs    r0, #0\n"
"    bl      sub_fc2a50aa\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf2e:\n"
"    ldr     r0, [r4, #0x54]\n"
"    bl      sub_fc0d5756\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf36:\n"
"    bl      sub_fc0d59e2\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf3c:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d5a2e\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf44:\n"
"    bl      sub_fc0d5bf4\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf4a:\n"
"    bl      sub_fc0d5c52\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf50:\n"
"    bl      sub_fc0d6008\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf56:\n"
"    bl      sub_fc0d609e\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf5c:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d4f08\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf64:\n"
"    bl      sub_fc0dc83c\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf6a:\n"
"    b       loc_fc0bd04c\n"
// - literal pool removed
".ltorg\n"
"loc_fc0bcf78:\n"
"    bl      sub_fc0dc9f4\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf7e:\n"
"    bl      sub_fc0dca98\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf84:\n"
"    bl      sub_fc0dcb2a\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf8a:\n"
"    movs    r0, #0\n"
"    b       loc_fc0bcfae\n"
"loc_fc0bcf8e:\n"
"    bl      sub_fc0dce20\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf94:\n"
"    bl      sub_fc0dce80\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcf9a:\n"
"    bl      sub_fc0dce84\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfa0:\n"
"    bl      sub_fc0dce94\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfa6:\n"
"    bl      sub_fc0dcf28\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfac:\n"
"    movs    r0, #1\n"
"loc_fc0bcfae:\n"
"    bl      sub_fc0dcd00\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfb4:\n"
"    bl      sub_fc0d5276\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfba:\n"
"    movs    r0, #0\n"
"    b       loc_fc0bcfc0\n"
"loc_fc0bcfbe:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc0bcfc0:\n"
"    bl      sub_fc0d52a8\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfc6:\n"
"    bl      sub_fc0dcc46\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfcc:\n"
"    bl      sub_fc0dccb2\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfd2:\n"
"    bl      sub_fc10fd1c\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfd8:\n"
"    bl      sub_fc10256c\n" //  return
"    b       loc_fc0bd05a\n"
"loc_fc0bcfde:\n"
"    bl      sub_fc0d67ca\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfe4:\n"
"    bl      sub_fc0d6884\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcfea:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0dd008\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcff2:\n"
"    bl      sub_fc0dd05a\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bcff8:\n"
"    bl      sub_fc0d71b8\n"
"    bl      sub_fc0d7ffe\n"
"    ldrh.w  r0, [r4, #0x1a4]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc0bd012\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x8200\n"
"    subs    r1, #0x36\n"
"    bne     loc_fc0bd05a\n"
"loc_fc0bd012:\n"
"    bl      sub_fc0d6884\n"
"    bl      sub_fc0d6c06\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd01c:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x11\n"
"    b       loc_fc0bd026\n"
"loc_fc0bd022:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"loc_fc0bd026:\n"
"    movs    r0, #0\n"
"    bl      sub_fc1026fa\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd02e:\n"
"    bl      sub_fc110468\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd034:\n"
"    bl      sub_fc1104e4\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd03a:\n"
"    bl      sub_fc110524\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd040:\n"
"    bl      sub_fc1103ac\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd046:\n"
"    bl      sub_fc1103ae\n"
"    b       loc_fc0bd05a\n"
"loc_fc0bd04c:\n"
"    movw    r2, #0x588\n"
"    ldr     r1, =0xfc0bca88\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc0bd05a:\n"
#ifdef CAPTSEQ_DEBUG
// debug after message handled
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5, #4]\n"
"    blx     sub_fc314cf8\n" // j_SetEventFlag
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc0bd078\n"
"    movw    r2, #0x12b\n"
"    ldr     r1, =0xfc0bca88\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc0bd078:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc0bce6e\n"
".ltorg\n"
    );
}

void __attribute__((naked,noinline)) sub_fc0dd248_my() {
    asm volatile ( // capdis -stubs -f=chdk -s=0xfc0dd249 -c=34 PRIMARY.BIN 0xfc000000
"    push    {r4, lr}\n"
"    bl      sub_fc102c38\n"
"    mov     r4, r0\n"
"    bl      sub_fc0d4f14\n"
"    bl      sub_fc137bd8\n"
"    mov     r1, r4\n"
"    bl      sub_fc137c26\n"
"    movs    r2, #4\n"
"    movw    r0, #0x118\n"
"    add.w   r1, r4, #0x34\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x32\n"
"    add.w   r1, r4, #0x38\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x46\n"
"    add.w   r1, r4, #8\n"
"    bl      _SetPropertyCase\n"
"    bl      sub_fc18bc9a\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc18b980\n"
"    bl      sub_fc249504\n"
"    bl      sub_fc2a6a82\n"
"    mov     r0, r4\n"
"    bl      sub_fc116fa2_my\n" // ->
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0dd2ae\n" //  return
"    ldr     r1, =0x00012db4\n"
"    movs    r0, #1\n"
"    str     r0, [r1]\n"
"loc_fc0dd2ae:\n"
"    pop     {r4, pc}\n"
".ltorg\n"
    );
}

void __attribute__((naked,noinline)) sub_fc0dd0dc_my() {
    asm volatile ( // capdis -stubs -f=chdk -s=0xfc0dd0dd -c=136 PRIMARY.BIN 0xfc000000
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r6, =0x0005dd60\n"
"    mov     r5, r0\n"
"    movs    r4, #0\n"
"    ldr     r0, [r6, #0x28]\n"
"    cbz     r0, loc_fc0dd104\n"
"    ldr     r0, =0x00012db4\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc0dd0f0\n"
"    movs    r4, #0x1d\n"
"loc_fc0dd0f0:\n"
"    mov     r2, r5\n"
"    movs    r1, #2\n"
"    mov     r0, r4\n"
"    bl      sub_fc1026fa\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18bff8\n"
"    b       loc_fc0dd23e\n"
"loc_fc0dd104:\n"
"    bl      sub_fc137bd8\n"
"    mov     r1, r5\n"
"    bl      sub_fc137c26\n"
"    movs    r2, #4\n"
"    movw    r0, #0x118\n"
"    add.w   r1, r5, #0x34\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x32\n"
"    add.w   r1, r5, #0x38\n"
"    bl      _SetPropertyCase\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbnz    r0, loc_fc0dd13e\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc0dd144\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0dd154\n"
"    b       loc_fc0dd144\n"
"loc_fc0dd13e:\n"
"    ldr     r0, [r5, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc0dd154\n"
"loc_fc0dd144:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc33e12c\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0dd154\n"
"    bl      sub_fc102562\n"
"    movs    r4, #1\n"
"loc_fc0dd154:\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc0dd22c\n"
"    ldr.w   r0, [r6, #0xec]\n"
"    cbz     r0, loc_fc0dd178\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc0dd16c\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0dd1be\n"
"loc_fc0dd16c:\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbz     r0, loc_fc0dd178\n"
"    ldr     r0, [r5, #0xc]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0dd1be\n"
"loc_fc0dd178:\n"
"    bl      sub_fc1105c8\n"
"    cbnz    r0, loc_fc0dd1be\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    movw    r0, #0x112\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0dd198\n"
"    movs    r2, #0xcb\n"
"    movs    r0, #0\n"
"    ldr     r1, =0xfc0dd2bc\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc0dd198:\n"
"    ldrsh.w r0, [sp]\n"
"    bl      sub_fc1271a6\n"
"    bl      sub_fc127068\n"
"    cmp     r0, #1\n"
"    bls     loc_fc0dd1b0\n"
"    movs    r0, #0\n"
"    bl      sub_fc127130\n"
"    b       loc_fc0dd1be\n"
"loc_fc0dd1b0:\n"
"    bl      sub_fc102562\n"
"    bl      sub_fc33e16c\n"
"    movs    r4, #1\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc0dd22c\n"
"loc_fc0dd1be:\n"
"    mov     r0, r5\n"
"    bl      sub_fc10fd82\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc0dd22c\n"
"    bl      sub_fc18bc9a\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    bl      sub_fc249504\n"
"    bl      sub_fc2a6a82\n"
"    mov     r0, r5\n"
"    bl      sub_fc116cec\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc0dd22c\n"
"    bl      sub_fc0d4f14\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b980\n"
"    movs    r0, #2\n"
"    bl      sub_fc0d7a2e\n"
"    ldr.w   r0, [r6, #0xb0]\n"
"    cbz     r0, loc_fc0dd208\n"
"    mov     r0, r5\n"
"    bl      sub_fc1175a8\n"
"    b       loc_fc0dd23e\n"
"loc_fc0dd208:\n"
"    ldr.w   r0, [r6, #0xb4]\n"
"    cbz     r0, loc_fc0dd216\n"
"    mov     r0, r5\n"
"    bl      sub_fc11721e\n"
"    b       loc_fc0dd23e\n"
"loc_fc0dd216:\n"
"    ldr.w   r0, [r6, #0xb8]\n"
"    cmp     r0, #0\n"
"    mov     r0, r5\n"
"    beq     loc_fc0dd226\n"
"    bl      sub_fc1178a4\n"
"    b       loc_fc0dd23e\n"
"loc_fc0dd226:\n"
"    bl      sub_fc116fa2_my\n" // ->
"    b       loc_fc0dd23e\n"
"loc_fc0dd22c:\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1026fa\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18c12e\n"
"loc_fc0dd23e:\n"
"    bl      sub_fc0d5c44\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x28]\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}


void __attribute__((naked,noinline)) sub_fc116fa2_my() {
    asm volatile ( // capdis -stubs -f=chdk -s=0xfc116fa3 -c=207 PRIMARY.BIN 0xfc000000
"    push.w  {r1, r2, r3, r4, r5, r6, r7, r8, sb, lr}\n"
"    ldr     r6, =0xfc116f7d\n"
"    mov     r5, r0\n"
"    bl      sub_fc18b916\n"
"    bl      sub_fc0dd712\n"
"    ldr     r7, =0x0005dd60\n"
"    ldr.w   r0, [r7, #0xa4]\n"
"    cbnz    r0, loc_fc116fd0\n"
"    ldrh.w  r0, [r7, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc116fc8\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc116fd0\n"
"loc_fc116fc8:\n"
"    bl      sub_fc0d5298\n"
"    bl      sub_fc0dd2de\n"
"loc_fc116fd0:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x139\n"
"    add     r1, sp, #8\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc116fec\n"
"    movs    r0, #0\n"
"    movw    r2, #0x150\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc116fec:\n"
#ifdef CAPTSEQ_DEBUG
// Ant's remote hook location
"bl log_remote_hook\n"
#endif
"    ldr     r0, [sp, #8]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc116ffc\n"
"    ldr     r0, =0xfc116f7d\n"
"    movs    r1, #0\n"
"    b       loc_fc117000\n"
"loc_fc116ffc:\n"
"    ldr     r0, =0xfc18b68f\n"
"    mov     r1, r5\n"
"loc_fc117000:\n"
"    bl      sub_fc144f10\n"
"    movs    r2, #2\n"
"    movw    r0, #0x114\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc117020\n"
"    movs    r0, #0\n"
"    movw    r2, #0x159\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc117020:\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc11702a\n"
"    bl      sub_fc18b7ea\n"
"loc_fc11702a:\n"
"    movs    r0, #0\n"
"    bl      sub_fc0bd154\n"
"    bl      sub_fc110676\n"
"    ldr.w   r8, =0xfc116f7d\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc11713c\n"

#ifdef CAPTSEQ_DEBUG
"bl log_remote_hook2\n"
#endif
"    BL      wait_until_remote_button_is_released\n" // + remote hook
"    BL      capt_seq_hook_set_nr\n" // +

"    mov     r0, r5\n"
"    bl      sub_fc18ba7e\n"
"    mov     r0, r5\n"
"    bl      sub_fc110580\n"
"    ldr     r1, =0x0002f888\n"
"    movs    r2, #4\n"
"    movs    r0, #0x92\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc117064\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16e\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc117064:\n"
"    bl      sub_fc0bd288\n"
"    bl      sub_fc18bb10\n"
"    movs    r1, #0\n"
"    mov     r0, r5\n"
"    bl      sub_fc116f7e\n"
"    mov     r6, r0\n"
"    ldr     r0, [sp, #8]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc117084\n"
"    ldr     r2, =0xfc18b7b5\n"
"    b       loc_fc117086\n"
"loc_fc117084:\n"
"    ldr     r2, =0xfc18b7cb\n"
"loc_fc117086:\n"
"    ldrh    r0, [r5, #0x18]\n"
"    ldr     r4, =0x0002f888\n"
"    cbz     r0, loc_fc117094\n"
"    cmp     r0, #1\n"
"    beq     loc_fc1170aa\n"
"    cmp     r0, #4\n"
"    bne     loc_fc1170fa\n"
"loc_fc117094:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     r0, r5\n"
"    ldr     r2, [r4]\n"
"    bl      sub_fc18b4ba\n"
"    mov     r4, r0\n"
"    bl      sub_fc2cd196\n"
"    b       loc_fc117108\n"
"loc_fc1170aa:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     sb, r4\n"
"    ldr     r2, [r4]\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b524\n"
"    movs    r2, #1\n"
"    mov     r4, r0\n"
"    movs    r1, #0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc2a6c1c\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc117108\n"
"    ldr     r0, =0xfc116f7d\n"
"    movs    r1, #0\n"
"    bl      sub_fc144f10\n"
"    movs    r1, #1\n"
"    mov     r0, r5\n"
"    bl      sub_fc116f7e\n"
"    mov     r6, r0\n"
"    ldr.w   r0, [sb]\n"
"    mov     r4, sb\n"
"    bl      sub_fc18b8b8\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     r3, r6\n"
"    ldr     r2, [r4]\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b59c\n"
"    mov     r4, r0\n"
"    bl      sub_fc18b462\n"
"    b       loc_fc117108\n"
"loc_fc1170fa:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1a7\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"    movs    r4, #0x1d\n"
"loc_fc117108:\n"
"    bl      sub_fc18bb14\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc117172\n"
"    mov     r0, r5\n"
"    bl      sub_fc18bb2a\n"
"    ldr.w   r0, [r7, #0x108]\n"
"    cbnz    r0, loc_fc11713a\n"
"    mov     r0, r5\n"
"    bl      sub_fc1105c2\n"
"    cbnz    r0, loc_fc11713a\n"
"    mov     r0, r5\n"
"    bl      sub_fc18c26a\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc11713a\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1c8\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc11713a:\n"
"    b       loc_fc11713e\n"
"loc_fc11713c:\n"
"    b       loc_fc117172\n"
"loc_fc11713e:\n"
#ifdef CAPTSEQ_DEBUG
"bl log_rh\n"
#endif
"    bl      capt_seq_hook_raw_here\n" //----------------------------------- ???? ----------
"    mov     r0, r5\n"
"    bl      sub_fc18bb00\n"
"    mov     r0, r5\n"
"    bl      sub_fc18bad4\n"
"    cmp     r6, r8\n"
"    beq     loc_fc117172\n"
"    bl      sub_fc18bc9a\n"
"    movs    r1, #4\n"
"    movw    sb, #0x1d5\n"
"    ldr     r3, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sb, [sp]\n"
"    bl      sub_fc33e2e4\n"
"    cbz     r0, loc_fc117172\n"
"    movs    r0, #0\n"
"    mov     r2, sb\n"
"    ldr     r1, =0xfc1171c8\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc117172:\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc117182\n"
"    movs    r2, #1\n"
"    movs    r1, #0\n"
"    movs    r0, #0x46\n"
"    bl      sub_fc2a6c1c\n"
"loc_fc117182:\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1026fa\n"
"    ldr     r0, [r7, #0x28]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc1171a8\n"
"    cmp     r6, r0\n"
"    beq     loc_fc11719c\n"
"    movs    r1, #1\n"
"    b       loc_fc11719e\n"
"loc_fc11719c:\n"
"    movs    r1, #0\n"
"loc_fc11719e:\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18bfb6\n"
"    b       loc_fc1171ba\n"
"loc_fc1171a8:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc1171b0\n"
"    movs    r1, #1\n"
"    b       loc_fc1171b2\n"
"loc_fc1171b0:\n"
"    movs    r1, #0\n"
"loc_fc1171b2:\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18bf70\n"
"loc_fc1171ba:\n"
"    mov     r0, r4\n"
"    pop.w   {r1, r2, r3, r4, r5, r6, r7, r8, sb, pc}\n"
".ltorg\n"
    );
}


void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile ( // capdis -stubs -s=task_ExpDrv -c=467 -f=chdk PRIMARY.BIN 0xfc000000
// task_ExpDrv 0xfc27bad1
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   sb, =0x0000cc60\n"
"    ldr.w   fp, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr     r6, =0x0006a77c\n"
"    add.w   r8, sp, #0x1c\n"
"    movw    sl, #0xbb8\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc27baec:\n"
"    ldr.w   r0, [sb, #0x24]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r4, sb\n"
"    blx     sub_fc314ce0\n" // j_ReceiveMessageQueue
"    ldr     r0, [sp, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc27bb28\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x15\n"
"loc_fc27bb06:\n"
"    beq     loc_fc27bbe4\n"
"    cmp     r0, #0x16\n"
"    beq     loc_fc27bb06\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc27bb06\n"
"    cmp     r0, #0x18\n"
"    beq     loc_fc27bb06\n"
"    cmp     r0, #0x19\n"
"    beq     loc_fc27bb06\n"
"    cmp     r0, #0x1a\n"
"    beq     loc_fc27bb06\n"
"    cmp     r0, #0x35\n"
"    beq     loc_fc27bbea\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27b80e\n"
"loc_fc27bb28:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x3d\n"
"    bne     loc_fc27bb46\n"
"    bl      sub_fc27cc52\n"
"    ldr.w   r0, [sb, #0x20]\n"
"    movs    r1, #1\n"
"    blx     sub_fc314cf8\n" // j_SetEventFlag
"    blx     sub_fc314d08\n" // -> ExitTask
"    add     sp, #0x2c\n"
//"    b       loc_fc27b560\n"                              // -
"    ldmia.w sp!, {r4, r5, r6, r7, r8, sb, sl, fp, pc}\n"   // +
"loc_fc27bb46:\n"
"    cmp     r1, #0x3c\n"
"    bne     loc_fc27bb58\n"
"loc_fc27bb4a:\n"
"    add.w   r0, r0, #0xac\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc27bfd2\n"
"loc_fc27bb58:\n"
"    cmp     r1, #0x33\n"
"    bne     loc_fc27bb8e\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x80\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    ldr     r0, =0xfc2779ab\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc3396f6\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x80\n"
"    mov     r2, sl\n"
"    blx     sub_fc314c50\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc27bb80\n"
"    movw    r2, #0x173c\n"
"    b       loc_fc27bc50\n"
"loc_fc27bb80:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc27bfd2\n"
"loc_fc27bb8e:\n"
"    cmp     r1, #0x34\n"
"    bne     loc_fc27bbe6\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27b80e\n"
"    movw    r5, #0x100\n"
"    ldr     r0, [r4, #0x20]\n"
"    mov     r1, r5\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    ldr     r0, =0xfc2779b5\n"
"    mov     r1, r5\n"
"    bl      sub_fc3398a2\n"
"    ldr     r0, [r4, #0x20]\n"
"    mov     r2, sl\n"
"    mov     r1, r5\n"
"    blx     sub_fc314c50\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc27bb80\n"
"    movw    r2, #0x1746\n"
"    b       loc_fc27bc50\n"
// literal pool removed
"loc_fc27bbe4:\n"               // reconstructed
"    b       loc_fc27bc5a\n"    // reconstructed
"loc_fc27bbe6:\n"
"    cmp     r1, #0x35\n"
"    bne     loc_fc27bbf4\n"
"loc_fc27bbea:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc27b80e\n"
"    b       loc_fc27bb80\n"
"loc_fc27bbf4:\n"
"    cmp     r1, #0x36\n"
"    bne     loc_fc27bc0e\n"
"    bl      sub_fc27b852\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    bl      sub_fc20f65e\n"
"    b       loc_fc27bfd2\n"
"loc_fc27bc0e:\n"
"    cmp     r1, #0x37\n"
"    beq     loc_fc27bb4a\n"
"    cmp     r1, #0x3a\n"
"    bne     loc_fc27bc24\n"
"    bl      sub_fc142f1c\n"
"    bl      sub_fc20f968\n"
"    bl      sub_fc20f65e\n"
"    b       loc_fc27bb80\n"
"loc_fc27bc24:\n"
"    cmp     r1, #0x3b\n"
"    bne     loc_fc27bc5a\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #4\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    ldr     r1, =0xfc2779c9\n"
"    movs    r2, #4\n"
"    mov     r0, fp\n"
"    bl      sub_fc27cca4\n"
"    bl      sub_fc142c80\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #4\n"
"    mov     r2, sl\n"
"    blx     sub_fc314e48\n" // j_WaitForAnyEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc27bb80\n"
"    movw    r2, #0x1829\n"
"loc_fc27bc50:\n"
"    ldr     r1, =0xfc277d90\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"    b       loc_fc27bb80\n"
"loc_fc27bc5a:\n"
"    ldr     r0, [sp, #0x28]\n"
"    movs    r5, #1\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x13\n"
"    beq     loc_fc27bc68\n"
"    cmp     r1, #0x14\n"
"    bne     loc_fc27bca6\n"
"loc_fc27bc68:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc27a170\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc27ceca\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x20]\n"
"    b       loc_fc27bef4\n"
"loc_fc27bca6:\n"
"    cmp     r1, #0x15\n"
"    beq     loc_fc27bcbe\n"
"    cmp     r1, #0x16\n"
"    beq     loc_fc27bcbe\n"
"    cmp     r1, #0x17\n"
"    beq     loc_fc27bcbe\n"
"    cmp     r1, #0x18\n"
"    beq     loc_fc27bcbe\n"
"    cmp     r1, #0x19\n"
"    beq     loc_fc27bcbe\n"
"    cmp     r1, #0x1a\n"
"    bne     loc_fc27bd2a\n"
"loc_fc27bcbe:\n"
"    bl      sub_fc142f1c\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r3, sp, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc27a34e\n"
"    cmp     r0, #1\n"
"    mov     r4, r0\n"
"    beq     loc_fc27bcd8\n"
"    cmp     r4, #5\n"
"    bne     loc_fc27bcf8\n"
"loc_fc27bcd8:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc27b7cc\n"
"loc_fc27bcf6:\n"
"    b       loc_fc27befa\n"
"loc_fc27bcf8:\n"
"    cmp     r4, #2\n"
"    beq     loc_fc27bd00\n"
"    cmp     r4, #6\n"
"    bne     loc_fc27bd14\n"
"loc_fc27bd00:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc27b564\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc27b7cc\n"
"loc_fc27bd14:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc27befa\n"
"loc_fc27bd2a:\n"
"    cmp     r1, #0x2d\n"
"    beq     loc_fc27bd32\n"
"    cmp     r1, #0x2e\n"
"    bne     loc_fc27bda0\n"
"loc_fc27bd32:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r7, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1, {r1, r2, r3}\n"
"    stm     r7!, {r1, r2, r3}\n"
"    bl      sub_fc27946c\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    bl      sub_fc142f1c\n"
"    bl      sub_fc20f968\n"
"    bl      sub_fc20f65e\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #2\n"
"    mov     r7, sl\n"
"    mov     r2, sl\n"
"    blx     sub_fc314c50\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc27bd84\n"
"    ldr     r1, =0xfc277d90\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xcae\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc27bd84:\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x20\n"
"    mov     r2, r7\n"
"    blx     sub_fc314c50\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc27bcf6\n"
"    ldr     r1, =0xfc277d90\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xcb1\n"
"    blx     sub_fc314e50\n" // j_DebugAssert
"    b       loc_fc27befa\n"
"loc_fc27bda0:\n"
"    adds    r1, r0, #4\n"
"    mov     r4, r8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x33\n"
"    bhs     loc_fc27bdea\n"
"    tbb     [pc, r1]\n" // (jumptable r1 51 elements)
"branchtable_fc27bdb2:\n"
"    .byte((loc_fc27bde6 - branchtable_fc27bdb2) / 2)\n" // (case 0)
"    .byte((loc_fc27bde6 - branchtable_fc27bdb2) / 2)\n" // (case 1)
"    .byte((loc_fc27bdec - branchtable_fc27bdb2) / 2)\n" // (case 2)
"    .byte((loc_fc27bdf2 - branchtable_fc27bdb2) / 2)\n" // (case 3)
"    .byte((loc_fc27bdf2 - branchtable_fc27bdb2) / 2)\n" // (case 4)
"    .byte((loc_fc27bdf2 - branchtable_fc27bdb2) / 2)\n" // (case 5)
"    .byte((loc_fc27bde6 - branchtable_fc27bdb2) / 2)\n" // (case 6)
"    .byte((loc_fc27bdec - branchtable_fc27bdb2) / 2)\n" // (case 7)
"    .byte((loc_fc27bdf2 - branchtable_fc27bdb2) / 2)\n" // (case 8)
"    .byte((loc_fc27bdf2 - branchtable_fc27bdb2) / 2)\n" // (case 9)
"    .byte((loc_fc27be04 - branchtable_fc27bdb2) / 2)\n" // (case 10)
"    .byte((loc_fc27be04 - branchtable_fc27bdb2) / 2)\n" // (case 11)
"    .byte((loc_fc27be04 - branchtable_fc27bdb2) / 2)\n" // (case 12)
"    .byte((loc_fc27bed8 - branchtable_fc27bdb2) / 2)\n" // (case 13)
"    .byte((loc_fc27bede - branchtable_fc27bdb2) / 2)\n" // (case 14)
"    .byte((loc_fc27bede - branchtable_fc27bdb2) / 2)\n" // (case 15)
"    .byte((loc_fc27bede - branchtable_fc27bdb2) / 2)\n" // (case 16)
"    .byte((loc_fc27bede - branchtable_fc27bdb2) / 2)\n" // (case 17)
"    .byte((loc_fc27bee4 - branchtable_fc27bdb2) / 2)\n" // (case 18)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 19)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 20)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 21)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 22)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 23)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 24)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 25)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 26)
"    .byte((loc_fc27bdf8 - branchtable_fc27bdb2) / 2)\n" // (case 27)
"    .byte((loc_fc27bdfe - branchtable_fc27bdb2) / 2)\n" // (case 28)
"    .byte((loc_fc27bdfe - branchtable_fc27bdb2) / 2)\n" // (case 29)
"    .byte((loc_fc27bdfe - branchtable_fc27bdb2) / 2)\n" // (case 30)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 31)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 32)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 33)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 34)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 35)
"    .byte((loc_fc27be0c - branchtable_fc27bdb2) / 2)\n" // (case 36)
"    .byte((loc_fc27be12 - branchtable_fc27bdb2) / 2)\n" // (case 37)
"    .byte((loc_fc27be3c - branchtable_fc27bdb2) / 2)\n" // (case 38)
"    .byte((loc_fc27be66 - branchtable_fc27bdb2) / 2)\n" // (case 39)
"    .byte((loc_fc27be6a - branchtable_fc27bdb2) / 2)\n" // (case 40)
"    .byte((loc_fc27be72 - branchtable_fc27bdb2) / 2)\n" // (case 41)
"    .byte((loc_fc27be9c - branchtable_fc27bdb2) / 2)\n" // (case 42)
"    .byte((loc_fc27bec6 - branchtable_fc27bdb2) / 2)\n" // (case 43)
"    .byte((loc_fc27bec6 - branchtable_fc27bdb2) / 2)\n" // (case 44)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 45)
"    .byte((loc_fc27bee8 - branchtable_fc27bdb2) / 2)\n" // (case 46)
"    .byte((loc_fc27becc - branchtable_fc27bdb2) / 2)\n" // (case 47)
"    .byte((loc_fc27becc - branchtable_fc27bdb2) / 2)\n" // (case 48)
"    .byte((loc_fc27becc - branchtable_fc27bdb2) / 2)\n" // (case 49)
"    .byte((loc_fc27bed2 - branchtable_fc27bdb2) / 2)\n" // (case 50)
".align 1\n"
"loc_fc27bde6:\n"
"    bl      sub_fc277ed4\n"
"loc_fc27bdea:\n"
"    b       loc_fc27bee8\n"
"loc_fc27bdec:\n"
"    bl      sub_fc27814c\n"
"    b       loc_fc27bee8\n"
"loc_fc27bdf2:\n"
"    bl      sub_fc278370\n"
"    b       loc_fc27bee8\n"
"loc_fc27bdf8:\n"
"    bl      sub_fc278624\n"
"    b       loc_fc27bee8\n"
"loc_fc27bdfe:\n"
"    bl      sub_fc2787e0\n"
"    b       loc_fc27bee8\n"
"loc_fc27be04:\n"
"    bl      sub_fc278b4c_my\n" // ->
"    movs    r5, #0\n"
"    b       loc_fc27bee8\n"
"loc_fc27be0c:\n"
"    bl      sub_fc278c50\n"
"    b       loc_fc27bee8\n"
"loc_fc27be12:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc279158\n"
"    b       loc_fc27bee8\n"
"loc_fc27be3c:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc27cd1c\n"
"    b       loc_fc27bee8\n"
"loc_fc27be66:\n"
"    movs    r1, #1\n"
"    b       loc_fc27be6c\n"
"loc_fc27be6a:\n"
"    movs    r1, #0\n"
"loc_fc27be6c:\n"
"    bl      sub_fc27921a\n"
"    b       loc_fc27bee8\n"
"loc_fc27be72:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r0, #6]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc27cde8\n"
"    b       loc_fc27bee8\n"
"loc_fc27be9c:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc27ce5c\n"
"    b       loc_fc27bee8\n"
"loc_fc27bec6:\n"
"    bl      sub_fc27925e\n"
"    b       loc_fc27bee8\n"
"loc_fc27becc:\n"
"    bl      sub_fc27981c\n"
"    b       loc_fc27bee8\n"
"loc_fc27bed2:\n"
"    bl      sub_fc279b10\n"
"    b       loc_fc27bee8\n"
"loc_fc27bed8:\n"
"    bl      sub_fc279d2a\n"
"    b       loc_fc27bee8\n"
"loc_fc27bede:\n"
"    bl      sub_fc279e88\n"
"    b       loc_fc27bee8\n"
"loc_fc27bee4:\n"
"    bl      sub_fc279fd2\n"
"loc_fc27bee8:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"loc_fc27bef4:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc27befa:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x11\n"
"    beq     loc_fc27bf1e\n"
"    bgt     loc_fc27bf12\n"
"    cmp     r0, #1\n"
"    beq     loc_fc27bf1e\n"
"    cmp     r0, #4\n"
"    beq     loc_fc27bf1e\n"
"    cmp     r0, #0xf\n"
"    bne     loc_fc27bf50\n"
"    b       loc_fc27bf1e\n"
"loc_fc27bf12:\n"
"    cmp     r0, #0x14\n"
"    beq     loc_fc27bf1e\n"
"    cmp     r0, #0x1a\n"
"    beq     loc_fc27bf1e\n"
"    cmp     r0, #0x1d\n"
"    bne     loc_fc27bf50\n"
"loc_fc27bf1e:\n"
"    ldrsh.w r0, [r6]\n"
"    mov     r2, fp\n"
"    cmp     r0, fp\n"
"    beq     loc_fc27bf30\n"
"    ldrsh.w r1, [r6, #8]\n"
"    cmp     r1, r2\n"
"    bne     loc_fc27bf48\n"
"loc_fc27bf30:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc362e56\n" // get_current_exp
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"    strh.w  r0, [sp, #0x24]\n"
"    b       loc_fc27bf50\n"
"loc_fc27bf48:\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x24]\n"
"loc_fc27bf50:\n"
"    cmp     r5, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc27bf88\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r4, r0, r1, lsl #2\n"
"    ldr     r0, =0x0006a77c\n"
"    subs    r4, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc314e58\n"
"    ldr     r0, =0x0006a77c\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc314e58\n"
"    ldr     r0, =0x0006a77c\n"
"    movs    r2, #0xc\n"
"    mov     r1, r4\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc314e58\n"
"    b       loc_fc27bfd2\n"
"loc_fc27bf88:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xc\n"
"    bne     loc_fc27bfb2\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc277cd4\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc27bfce\n"
"loc_fc27bfb2:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc277cd4\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc27bfce:\n"
"    bl      sub_fc277e14\n"
"loc_fc27bfd2:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc27cc52\n"
"    b       loc_fc27baec\n"
".ltorg\n"
    );
}

void __attribute__((naked,noinline)) sub_fc278b4c_my() {
    asm volatile ( // capdis -stubs -s=0xfc278b4d -c=52 -jfw -f=chdk PRIMARY.BIN 0xfc000000
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000cc60\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x20]\n"
"    blx     sub_fc314da0\n" // j_ClearEventFlag
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc277a12\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc277b9a\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc277bde\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc277c22\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc277c66\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x0006a794\n"
"    cmp     r0, #0xc\n"
"    bne     loc_fc278ba0\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc278bb8\n"
"loc_fc278ba0:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc278bb8\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc2779a1\n"
"    bl      sub_fc339712\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x2c]\n"
"    b       loc_fc278bbe\n"
"loc_fc278bb8:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc278bbe:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc278bd0\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc2779fd\n"
"    bl      sub_fc27ccc8\n"
"    b       loc_fc278bd4\n"
"loc_fc278bd0:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc278bd4:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc142cda_my\n" // ->
"    ldr     pc, =0xfc278bdf\n" // Continue in firmware
    );
}

void __attribute__((naked,noinline)) sub_fc142cda_my() {
    asm volatile ( // capdis -stubs -s=0xfc142cdb -c=35 -f=chdk PRIMARY.BIN 0xfc000000
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000c5a4\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc142cf2\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16b\n"
"    ldr     r1, =0xfc142d98\n" //  *"Shutter.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc142cf2:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc142cfc\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc142cfc:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc142d0e\n"
"    movs    r0, #0\n"
"    movw    r2, #0x171\n"
"    ldr     r1, =0xfc142d98\n" //  *"Shutter.c"
"    blx     sub_fc314e50\n" // j_DebugAssert
"loc_fc142d0e:\n"
"    mov     r0, r4\n"
//"    bl      _apex2us\n"  // -
"    bl      apex2us\n"     // +
"    mov     r4, r0\n"
"    bl      sub_fc2309fa\n" //  return
"    mov     r0, r4\n"
"    bl      sub_fc15e4a8\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc142d34\n" //  return
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    movw    r2, #0x176\n"
"    ldr     r1, =0xfc142d98\n" //  *"Shutter.c"
"    b.w     sub_fc314302\n" // loc -> sub -> DebugAssert
"loc_fc142d34:\n"
"    pop     {r4, r5, r6, pc}\n"
    );
}

