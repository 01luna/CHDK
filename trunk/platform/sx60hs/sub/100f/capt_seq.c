#include "lolevel.h"
#include "platform.h"
#include "core.h"
#include "conf.h"
#define NR_AUTO (0) //this camera needs it to be set back to zero
static long *nrflag = (long*)0x1e858;
extern int active_raw_buffer;
// debug
extern void _LogCameraEvent(int id,const char *fmt,...);

extern char *hook_raw_image_addr(void);

void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}

void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}


#include "../../../generic/capt_seq.c"
extern int _captseq_raw_addr_init(int raw_index, char **ptr) ;
char *current_raw_addr;

void captseq_raw_addr_init_my(int raw_index,char **ptr) {
    _captseq_raw_addr_init(raw_index,ptr);
    current_raw_addr=*(ptr + 0x5c/4); // fc154c5a: 65e0  str   r0, [r4, #92]
#ifdef CAPTSEQ_DEBUG_LOG
    _LogCameraEvent(0x60,"rawinit i:0x%x p:0x%x v:0x%x",raw_index,ptr,current_raw_addr);
#endif
}

void clear_current_raw_addr(void) {
    current_raw_addr=NULL;
}
//-s=task_CaptSeq -c=117 -f=chdk
// task_CaptSeq 0xfc15275f
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x0003c478\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000ba2c\n"
"loc_fc152766:\n" 
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #8]\n"
"    blx     sub_fc2cf348\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc152788\n"
"    movw    r2, #0x448\n"
"    ldr     r1, =0xfc152410\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"    blx     sub_fc2cf358\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc152788:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc1527a0\n"
"    cmp     r0, #0x29\n"
"    beq     loc_fc1527a0\n"
"    cmp     r0, #0x1d\n"
"    beq     loc_fc1527a0\n"
"    cmp     r0, #0x21\n"
"    beq     loc_fc1527a0\n"
"    bl      sub_fc1dd978\n"
"loc_fc1527a0:\n"
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2b\n"
"    bhs     loc_fc152888\n"
"    tbb     [pc, r1]\n" // (jumptable r1 43 elements)
"branchtable_fc1527ac:\n"
"    .byte((loc_fc1527d8 - branchtable_fc1527ac) / 2)\n" // (case 0)
"    .byte((loc_fc1527f0 - branchtable_fc1527ac) / 2)\n" // (case 1)
"    .byte((loc_fc1527f8 - branchtable_fc1527ac) / 2)\n" // (case 2)
"    .byte((loc_fc152806 - branchtable_fc1527ac) / 2)\n" // (case 3)
"    .byte((loc_fc152800 - branchtable_fc1527ac) / 2)\n" // (case 4)
"    .byte((loc_fc152812 - branchtable_fc1527ac) / 2)\n" // (case 5)
"    .byte((loc_fc152818 - branchtable_fc1527ac) / 2)\n" // (case 6)
"    .byte((loc_fc15281e - branchtable_fc1527ac) / 2)\n" // (case 7)
"    .byte((loc_fc152826 - branchtable_fc1527ac) / 2)\n" // (case 8)
"    .byte((loc_fc152866 - branchtable_fc1527ac) / 2)\n" // (case 9)
"    .byte((loc_fc152830 - branchtable_fc1527ac) / 2)\n" // (case 10)
"    .byte((loc_fc152838 - branchtable_fc1527ac) / 2)\n" // (case 11)
"    .byte((loc_fc15284c - branchtable_fc1527ac) / 2)\n" // (case 12)
"    .byte((loc_fc152854 - branchtable_fc1527ac) / 2)\n" // (case 13)
"    .byte((loc_fc15285a - branchtable_fc1527ac) / 2)\n" // (case 14)
"    .byte((loc_fc152860 - branchtable_fc1527ac) / 2)\n" // (case 15)
"    .byte((loc_fc152870 - branchtable_fc1527ac) / 2)\n" // (case 16)
"    .byte((loc_fc152876 - branchtable_fc1527ac) / 2)\n" // (case 17)
"    .byte((loc_fc15287c - branchtable_fc1527ac) / 2)\n" // (case 18)
"    .byte((loc_fc152882 - branchtable_fc1527ac) / 2)\n" // (case 19)
"    .byte((loc_fc15288a - branchtable_fc1527ac) / 2)\n" // (case 20)
"    .byte((loc_fc15288e - branchtable_fc1527ac) / 2)\n" // (case 21)
"    .byte((loc_fc152894 - branchtable_fc1527ac) / 2)\n" // (case 22)
"    .byte((loc_fc15289a - branchtable_fc1527ac) / 2)\n" // (case 23)
"    .byte((loc_fc1528a0 - branchtable_fc1527ac) / 2)\n" // (case 24)
"    .byte((loc_fc1528a6 - branchtable_fc1527ac) / 2)\n" // (case 25)
"    .byte((loc_fc1528ac - branchtable_fc1527ac) / 2)\n" // (case 26)
"    .byte((loc_fc1528b4 - branchtable_fc1527ac) / 2)\n" // (case 27)
"    .byte((loc_fc1528ba - branchtable_fc1527ac) / 2)\n" // (case 28)
"    .byte((loc_fc1528be - branchtable_fc1527ac) / 2)\n" // (case 29)
"    .byte((loc_fc1528c6 - branchtable_fc1527ac) / 2)\n" // (case 30)
"    .byte((loc_fc1528cc - branchtable_fc1527ac) / 2)\n" // (case 31)
"    .byte((loc_fc1528f6 - branchtable_fc1527ac) / 2)\n" // (case 32)
"    .byte((loc_fc1528fc - branchtable_fc1527ac) / 2)\n" // (case 33)
"    .byte((loc_fc152902 - branchtable_fc1527ac) / 2)\n" // (case 34)
"    .byte((loc_fc152908 - branchtable_fc1527ac) / 2)\n" // (case 35)
"    .byte((loc_fc15290e - branchtable_fc1527ac) / 2)\n" // (case 36)
"    .byte((loc_fc152914 - branchtable_fc1527ac) / 2)\n" // (case 37)
"    .byte((loc_fc15291c - branchtable_fc1527ac) / 2)\n" // (case 38)
"    .byte((loc_fc152922 - branchtable_fc1527ac) / 2)\n" // (case 39)
"    .byte((loc_fc152946 - branchtable_fc1527ac) / 2)\n" // (case 40)
"    .byte((loc_fc15294c - branchtable_fc1527ac) / 2)\n" // (case 41)
"    .byte((loc_fc152966 - branchtable_fc1527ac) / 2)\n" // (case 42)
".align 1\n"
"loc_fc1527d8:\n" // case 0: preshoot, quick press shoot
"    ldr     r0, [r0, #0xc]\n"
"    uxtb    r0, r0\n"
"    bl      sub_fc152cfa\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq_override\n"
#endif
"    BL      clear_current_raw_addr\n" // +
"    BL      shooting_expo_param_override\n" //sx280
"    bl      sub_fc150454\n"
"    ldr     r0, [r4, #0x28]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc1527ee\n"
//"    bl      sub_fc1dcaa8\n" //may need _my routine sx280
"    bl      sub_fc1dcaa8_my\n"
"loc_fc1527ee:\n"
"    b       loc_fc152966\n"
"loc_fc1527f0:\n"
"    ldr     r0, [r0, #0x10]\n" //case 1 normal shoot
//"    bl      sub_fc1dc8d2\n" //my need _my routinej
"    bl      sub_fc1dc8d2_my\n"
"    b       loc_fc152966\n"
"loc_fc1527f8:\n"
"    movs    r0, #1\n"
"    bl      sub_fc152ff4\n"
"    b       loc_fc152966\n"
"loc_fc152800:\n"
"    bl      sub_fc152a72\n"
"    b       loc_fc15280e\n"
"loc_fc152806:\n"
"    ldr     r0, [r0, #0xc]\n"
"    uxtb    r0, r0\n"
"    bl      sub_fc152ce2\n"
"loc_fc15280e:\n"
"    str     r6, [r4, #0x28]\n"
"    b       loc_fc152966\n"
"loc_fc152812:\n"
"    bl      sub_fc152ce8\n"
"    b       loc_fc152966\n"
"loc_fc152818:\n"
"    bl      sub_fc152ef0\n"
"    b       loc_fc15282a\n"
"loc_fc15281e:\n"
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc1dcb50\n"
"    b       loc_fc152966\n"
"loc_fc152826:\n"
"    bl      sub_fc152f7a\n"
"loc_fc15282a:\n"
"    bl      sub_fc150454\n"
"    b       loc_fc152966\n"
"loc_fc152830:\n"
"    ldr     r0, [r4, #0x54]\n"
"    bl      sub_fc153580\n"
"    b       loc_fc152966\n"
"loc_fc152838:\n"
"    bl      sub_fc15380c\n"
"    b       loc_fc152966\n"
".ltorg\n"
/*
"    movs    r0, r0\n"
"    stm     r6!, {r2, r4, r5, r6}\n"
"    movs    r3, r0\n"
"    stm     r4!, {r3, r4, r5, r6}\n"
"    movs    r3, r0\n"
"    rev     r4, r5\n"
"    movs    r0, r0\n"
c674 0003
c478 0003
ba2c 0000
*/
"loc_fc15284c:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc153858\n"
"    b       loc_fc152966\n"
"loc_fc152854:\n"
"    bl      sub_fc1539d2\n"
"    b       loc_fc152966\n"
"loc_fc15285a:\n"
"    bl      sub_fc153da0\n"
"    b       loc_fc152966\n"
"loc_fc152860:\n"
"    bl      sub_fc153e36\n"
"    b       loc_fc152966\n"
"loc_fc152866:\n"
"    ldr     r0, [r0, #0xc]\n"
"    uxtb    r0, r0\n"
"    bl      sub_fc152ce2\n"
"    b       loc_fc152966\n"
"loc_fc152870:\n"
"    bl      sub_fc1db418\n"
"    b       loc_fc152966\n"
"loc_fc152876:\n"
"    bl      sub_fc1db600\n"
"    b       loc_fc152966\n"
"loc_fc15287c:\n"
"    bl      sub_fc1db69c\n"
"    b       loc_fc152966\n"
"loc_fc152882:\n"
"    bl      sub_fc1db718\n"
"    b       loc_fc152966\n"
"loc_fc152888:\n"
"    b       loc_fc152958\n"
"loc_fc15288a:\n"
"    movs    r0, #0\n"
"    b       loc_fc1528ae\n"
"loc_fc15288e:\n"
"    bl      sub_fc1dbb04\n"
"    b       loc_fc152966\n"
"loc_fc152894:\n"
"    bl      sub_fc1dbb64\n"
"    b       loc_fc152966\n"
"loc_fc15289a:\n"
"    bl      sub_fc1dbb68\n"
"    b       loc_fc152966\n"
"loc_fc1528a0:\n"
"    bl      sub_fc1dbb78\n"
"    b       loc_fc152966\n"
"loc_fc1528a6:\n"
"    bl      sub_fc1dbbf0\n"
"    b       loc_fc152966\n"
"loc_fc1528ac:\n"
"    movs    r0, #1\n"
"loc_fc1528ae:\n"
"    bl      sub_fc1db9e4\n"
"    b       loc_fc152966\n"
"loc_fc1528b4:\n"
"    bl      sub_fc153102\n"
"    b       loc_fc152966\n"
"loc_fc1528ba:\n"
"    movs    r0, #0\n"
"    b       loc_fc1528c0\n"
"loc_fc1528be:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc1528c0:\n"
"    bl      sub_fc153164\n"
"    b       loc_fc152966\n"
"loc_fc1528c6:\n"
"    bl      sub_fc1db8d8\n"
"    b       loc_fc152966\n"
"loc_fc1528cc:\n"
"    ldr     r1, =0x0003c4da\n"
"    movs    r2, #2\n"
"    movs    r0, #0x72\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1528e8\n"
"    movw    r2, #0x508\n"
"    ldr     r1, =0xfc152410\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc1528e8:\n"
"    ldrh.w  r0, [r4, #0x62]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc152966\n"
"    bl      sub_fc1db8d2\n"
"    b       loc_fc152966\n"
"loc_fc1528f6:\n"
"    bl      sub_fc1db956\n"
"    b       loc_fc152966\n"
"loc_fc1528fc:\n"
"    bl      sub_fc1dd354\n"
"    b       loc_fc152966\n"
"loc_fc152902:\n"
"    bl      sub_fc150d7a\n"
"    b       loc_fc152966\n"
"loc_fc152908:\n"
"    bl      sub_fc2aa48e\n"
"    b       loc_fc152966\n"
"loc_fc15290e:\n"
"    bl      sub_fc2aa568\n"
"    b       loc_fc152966\n"
"loc_fc152914:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc1dbcc4\n"
"    b       loc_fc152966\n"
"loc_fc15291c:\n"
"    bl      sub_fc1dbd2c\n"
"    b       loc_fc152966\n"
"loc_fc152922:\n"
"    bl      sub_fc15893e\n"
"    ldrh.w  r0, [r4, #0x1a4]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc152938\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x4200\n"
"    subs    r1, #0x36\n"
"    bne     loc_fc152966\n"
"loc_fc152938:\n"
"    bl      sub_fc2aa568\n"
"    bl      sub_fc2aaa7e\n"
"    bl      sub_fc2aa8c6\n"
"    b       loc_fc152966\n"
"loc_fc152946:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x11\n"
"    b       loc_fc152950\n"
"loc_fc15294c:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"loc_fc152950:\n"
"    movs    r0, #0\n"
"    bl      sub_fc150f62\n"
"    b       loc_fc152966\n"
"loc_fc152958:\n"   //near line 308 of g7x
"    movw    r2, #0x572\n"
"    ldr     r1, =0xfc152410\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc152966:\n"
// debug after message handled
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
"    BL      capt_seq_hook_set_nr\n" //  dark frame control
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5, #4]\n"
"    blx     sub_fc2cf328\n" // j_SetEventFlag
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc152984\n"
"    movw    r2, #0x128\n"
"    ldr     r1, =0xfc152410\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc152984:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc152766\n"
/*"    ldr     r2, =0x0003c2f0\n"
"    movs    r0, #0\n"
"    push    {r3, r4, r5, lr}\n"
"    mov     r1, r0\n"
*/
".ltorg\n"
   );
}
// -s=0xfc1dcaa9 -c=56 -f=chdk
void __attribute__((naked,noinline)) sub_fc1dcaa8_my() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    bl      sub_fc151ece\n"
"    mov     r4, r0\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2d7930\n"
"    ldr     r6, =0x00014348\n"
"    lsls    r0, r0, #0x1f\n"
"    mov.w   r5, #1\n"
"    bne     loc_fc1dcb42\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    movw    r0, #0x10d\n"
//"    bl      sub_fc321ee0\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1dcadc\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16d\n"
"    ldr     r1, =0xfc1dcc28\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc2cf408\n"
"loc_fc1dcadc:\n"
"    ldrsh.w r0, [sp]\n"
"    bl      sub_fc1377fe\n"
"    bl      sub_fc1376d6\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1dcb46\n"
"    movs    r0, #0\n"
"    bl      sub_fc13778e\n"
"    bl      sub_fc152cee\n"
"    bl      sub_fc154bcc\n"
"    mov     r1, r4\n"
//"    bl      sub_fc154c1a\n"
"bl captseq_raw_addr_init_my\n"
"    movs    r2, #4\n"
"    movw    r0, #0x113\n"
"    add.w   r1, r4, #0x58\n"
"    bl      _SetPropertyCase\n"
//"    bl      sub_fc321dae\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2d\n"
"    add.w   r1, r4, #0x5c\n"
"    bl      _SetPropertyCase\n"
//"    bl      sub_fc321dae\n"
"    movs    r2, #4\n"
"    movs    r0, #0x41\n"
"    add.w   r1, r4, #8\n"
"    bl      _SetPropertyCase\n"
//"    bl      sub_fc321dae\n"
"    bl      sub_fc1dd17e\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc1dc678\n"
"    mov     r0, r4\n"
//"    bl      sub_fc39ff78\n"
"    bl      sub_fc39ff78_my\n" // ->
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1dcb44\n"
"loc_fc1dcb42:\n"
"    str     r5, [r6]\n"
"loc_fc1dcb44:\n"
//"    BL      capt_seq_hook_raw_here \n" // + ???
"    pop     {r3, r4, r5, r6, r7, pc}\n"
//sx280 ends here
"loc_fc1dcb46:\n"
"    bl      sub_fc150d70\n"
"    bl      sub_fc2d7968\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}
//-s=0xfc1dc8d3 -e=0xfc1dc8d3 -f=chdk
void __attribute__((naked,noinline)) sub_fc1dc8d2_my() {
    asm volatile (
"    push    {r2, r3, r4, r5, r6, lr}\n"
"    ldr     r6, =0x0003c478\n"
"    mov     r4, r0\n"
"    movs    r5, #0\n"
"    ldr     r0, [r6, #0x28]\n"
"    cbz     r0, loc_fc1dc8fa\n"
"    ldr     r0, =0x00014348\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc1dc8e6\n"
"    movs    r5, #0x1d\n"
"loc_fc1dc8e6:\n"
"    mov     r2, r4\n"
"    movs    r1, #2\n"
"    mov     r0, r5\n"
"    bl      sub_fc150f62\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dd7d6\n"
"    b       loc_fc1dcaa2\n"
"loc_fc1dc8fa:\n"
"    bl      sub_fc154bcc\n" // gets active raw buffer
"    mov     r1, r4\n"
//"    bl      sub_fc154c1a\n"
"bl captseq_raw_addr_init_my\n"
"    movs    r2, #4\n"
"    movw    r0, #0x113\n"
"    add.w   r1, r4, #0x58\n"
"    bl      _SetPropertyCase\n"
//"    bl      sub_fc321dae\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2d\n"
"    add.w   r1, r4, #0x5c\n"
"    bl      _SetPropertyCase\n"
//"    bl      sub_fc321dae\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbnz    r0, loc_fc1dc934\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1dc93a\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1dc94a\n"
"    b       loc_fc1dc93a\n"
"loc_fc1dc934:\n"
"    ldr     r0, [r4, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc1dc94a\n"
"loc_fc1dc93a:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2d7930\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1dc94a\n"
"    bl      sub_fc150d70\n"
"    movs    r5, #1\n"
"loc_fc1dc94a:\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc1dca4c\n"
"    ldr.w   r0, [r6, #0xec]\n"
"    cbz     r0, loc_fc1dc96e\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1dc962\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1dc9ae\n"
"loc_fc1dc962:\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbz     r0, loc_fc1dc96e\n"
"    ldr     r0, [r4, #0xc]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1dc9ae\n"
"loc_fc1dc96e:\n"
"    movs    r2, #2\n"
"    movw    r0, #0x10d\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1dc988\n"
"    movs    r2, #0xc9\n"
"    movs    r0, #0\n"
"    ldr     r1, =0xfc1dcc28\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc2cf408\n" //j_DebugAssert
"loc_fc1dc988:\n"
"    ldrsh.w r0, [sp, #4]\n"
"    bl      sub_fc1377fe\n"
"    bl      sub_fc1376d6\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1dc9a0\n"
"    movs    r0, #0\n"
"    bl      sub_fc13778e\n"
"    b       loc_fc1dc9ae\n"
"loc_fc1dc9a0:\n"
"    bl      sub_fc150d70\n"
"    bl      sub_fc2d7968\n"
"    movs    r5, #1\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc1dca90\n"
"loc_fc1dc9ae:\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dd39e\n"
"    mov     r5, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1dca90\n"
"    bl      sub_fc1dd17e\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc39fc56\n"
"    mov     r5, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1dca90\n"
"    bl      sub_fc152cee\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc678\n"
"    ldr.w   r0, [r6, #0x130]\n"
"    cbnz    r0, loc_fc1dc9f0\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1dc9f0\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1dc9f6\n"
"loc_fc1dc9f0:\n"
"    movs    r0, #2\n"
"    bl      sub_fc15980a\n"
"loc_fc1dc9f6:\n"
"    ldr.w   r0, [r6, #0xa8]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc1dca6c\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    movw    r5, #0x1000\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1dca26\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1dca26\n"
"    bl      sub_fc1dd17e\n"
"    movw    r3, #0x112\n"
"    movw    r2, #0x3a98\n"
"    mov     r1, r5\n"
"    str     r3, [sp]\n"
"    ldr     r3, =0xfc1dcc28\n" //  *"SsCaptureCtrl.c"
"    bl      sub_fc2d7ae4\n"
"loc_fc1dca26:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x185\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1dca42\n"
"    movs    r0, #0\n"
"    movw    r2, #0x116\n"
"    ldr     r1, =0xfc1dcc28\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc1dca42:\n"
"    ldr     r0, [sp, #4]\n"
"    cbnz    r0, loc_fc1dca56\n"
"    bl      sub_fc1dd17e\n"
"    b       loc_fc1dca4e\n"
"loc_fc1dca4c:\n"
"    b       loc_fc1dca90\n"
"loc_fc1dca4e:\n"
"    mov     r1, r5\n"
"    blx     sub_fc2cf328\n" // j_SetEventFlag
"    b       loc_fc1dca6c\n"
"loc_fc1dca56:\n"
"    bl      sub_fc1dd17e\n"
"    mov     r1, r5\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    ldr     r2, =0xfc1dc8c1\n"
"    mov     r3, r5\n"
"    ldr     r0, [sp, #4]\n"
"    mov     r1, r2\n"
"    bl      sub_fc322d70\n"
"loc_fc1dca6c:\n"
"    ldr.w   r0, [r6, #0xb0]\n"
"    cbz     r0, loc_fc1dca7a\n"
"    mov     r0, r4\n"
"    bl      sub_fc3a0740\n" // SsHDRCaptureSeq.c
"    b       loc_fc1dcaa2\n"
"loc_fc1dca7a:\n"
"    ldr.w   r0, [r6, #0xb4]\n"
"    cmp     r0, #0\n"
"    mov     r0, r4\n"
"    beq     loc_fc1dca8a\n"
"    bl      sub_fc3a03ae\n" // SsGISCaptureSeq.c
"    b       loc_fc1dcaa2\n"
"loc_fc1dca8a:\n"
//"bl sub_fc39ff78\n"
"    bl      sub_fc39ff78_my\n" // SsStandardCaptureSeq.c hook
"    b       loc_fc1dcaa2\n"
"loc_fc1dca90:\n"
"    movs    r1, #2\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc150f62\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dd90c\n"
"loc_fc1dcaa2:\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x28]\n"
"    pop     {r2, r3, r4, r5, r6, pc}\n"
    );
}
// -s=0xfc39ff79 -e=0xfc3a017f -f=chdk
void __attribute__((naked,noinline)) sub_fc39ff78_my() {
    asm volatile ( 
"    push.w  {r2, r3, r4, r5, r6, r7, r8, sb, sl, lr}\n"
"    ldr     r7, =0x0003c478\n"
"    mov     r4, r0\n"
"    ldr.w   r0, [r7, #0x16c]\n"
"    cbz     r0, loc_fc39ff94\n"
"    ldrh.w  r0, [r7, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc39ff94\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc39ff9e\n"
"loc_fc39ff94:\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc60e\n"
"    bl      sub_fc1dd03a\n"
"loc_fc39ff9e:\n"
"    ldr.w   r0, [r7, #0xa4]\n"
"    cbnz    r0, loc_fc39ffba\n"
"    ldrh.w  r0, [r7, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc39ffb2\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc39ffba\n"
"loc_fc39ffb2:\n"
"    bl      sub_fc153152\n"
"    bl      sub_fc1dcc5a\n"
"loc_fc39ffba:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x134\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc39ffd6\n"
"    movs    r0, #0\n"
"    movw    r2, #0x193\n"
"    ldr     r1, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc39ffd6:\n"
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc39ffe6\n"
"    ldr     r0, =0xfc39ff1b\n"
"    movs    r1, #0\n"
"    b       loc_fc39ffea\n"
"loc_fc39ffe6:\n"
"    ldr     r0, =0xfc1dc2d3\n"
"    mov     r1, r4\n"
"loc_fc39ffea:\n"
"    bl      sub_fc16fe1c\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc39fff8\n"
"    bl      sub_fc1dc546\n"
"loc_fc39fff8:\n"
"    movs    r0, #0\n"
"    bl      sub_fc15655e\n"
//"bl log_nr_call\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc724\n"
"    ldr     r1, =0x000265c4\n"
"    movs    r2, #4\n"
"    movs    r0, #0x8d\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc3a001e\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1ae\n"
"    ldr     r1, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc3a001e:\n"
"    bl      sub_fc156618\n"
"    bl      sub_fc1dc7c0\n"
"    movs    r1, #0\n"
"    mov     r0, r4\n"
"    bl      sub_fc39ff1c\n"
"    mov     r6, r0\n"
"    BL      wait_until_remote_button_is_released\n" // + remote hook
"bl log_remote_hook\n"
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc3a003e\n"
"    ldr     r2, =0xfc1dc515\n"
"    b       loc_fc3a0040\n"
"loc_fc3a003e:\n"
"    ldr     r2, =0xfc1dc52b\n"
"loc_fc3a0040:\n"
"    ldrh    r0, [r4, #0x18]\n"
"    ldr     r5, =0x000265c4\n"
"    cbz     r0, loc_fc3a004e\n"
"    cmp     r0, #1\n"
"    beq     loc_fc3a0064\n"
"    cmp     r0, #4\n"
"    bne     loc_fc3a00ca\n"
"loc_fc3a004e:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r4, #0x5c]\n"
"    mov     r0, r4\n"
"    ldr     r2, [r5]\n"
"    bl      sub_fc1dc126\n"
"    mov     r5, r0\n"
"    bl      sub_fc28bb0a\n"
"    b       loc_fc3a00d8\n"
"loc_fc3a0064:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r4, #0x5c]\n"
"    mov     r8, r5\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc186\n" 
"    movs    r2, #1\n"
"    mov     r5, r0\n"
"    movs    r1, #0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc277200\n"
//loc
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc3a00d8\n"
"    ldr.w   r0, [r7, #0x100]\n"
"    cbz     r0, loc_fc3a009a\n"
"    ldr     r1, [r4, #8]\n"
"    ldr     r2, =0x00212cc4\n"
"    ldr     r0, [r4, #0x5c]\n"
"    add.w   r1, r2, r1, lsl #2\n"
"    str     r0, [r1, #-0x4]\n"
"    b       loc_fc3a00c4\n"
"loc_fc3a009a:\n"
"    ldr     r0, =0xfc39ff1b\n"
"    movs    r1, #0\n"
"    bl      sub_fc16fe1c\n"
"    movs    r1, #1\n"
"    mov     r0, r4\n"
"    bl      sub_fc39ff1c\n"
"    mov     r6, r0\n"
"    ldr.w   r0, [r8]\n"
"    mov     r5, r8\n"
"    bl      sub_fc1dc5b0\n"
"    ldr     r1, [r4, #0x5c]\n"
"    mov     r3, r6\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc1f4\n" 
"    mov     r5, r0\n"
"loc_fc3a00c4:\n"
"    bl      sub_fc1dc0d0\n"
"    b       loc_fc3a00d8\n"
"loc_fc3a00ca:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1e1\n"
"    ldr     r1, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"    movs    r5, #0x1d\n"
"loc_fc3a00d8:\n"
"    bl      sub_fc1dc7c4\n"
"    ldr.w   r8, =0xfc39ff1b\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc3a0134\n"
"    ldr.w   r0, [r7, #0x108]\n"
"    cbnz    r0, loc_fc3a0100\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dddba\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc3a0100\n"
"    movs    r0, #0\n"
"    movw    r2, #0x207\n"
"    ldr     r1, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc3a0100:\n"
#ifdef CAPTSEQ_DEBUG_LOG
 "bl log_rh\n"
#endif
"BL capt_seq_hook_raw_here\n"
"BL clear_current_raw_addr\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc7b0\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dc784\n"
"    cmp     r6, r8\n"
"    beq     loc_fc3a0134\n"
"    bl      sub_fc1dd17e\n"
"    movs    r1, #4\n"
"    movw    sb, #0x214\n"
"    ldr     r3, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sb, [sp]\n"
"    bl      sub_fc2d7ae4\n"
"    cbz     r0, loc_fc3a0134\n"
"    movs    r0, #0\n"
"    mov     r2, sb\n"
"    ldr     r1, =0xfc3a0328\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc3a0134:\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc3a0144\n"
"    movs    r2, #1\n"
"    movs    r1, #0\n"
"    movs    r0, #0x46\n"
"    bl      sub_fc277200\n"
"loc_fc3a0144:\n"
"    movs    r1, #2\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc150f62\n"
"    ldr     r0, [r7, #0x28]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc3a016a\n"
"    cmp     r6, r0\n"
"    beq     loc_fc3a015e\n"
"    movs    r1, #1\n"
"    b       loc_fc3a0160\n"
"loc_fc3a015e:\n"
"    movs    r1, #0\n"
"loc_fc3a0160:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dd794\n"
"    b       loc_fc3a017c\n"
"loc_fc3a016a:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc3a0172\n"
"    movs    r1, #1\n"
"    b       loc_fc3a0174\n"
"loc_fc3a0172:\n"
"    movs    r1, #0\n"
"loc_fc3a0174:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1dd74e\n"
"loc_fc3a017c:\n"
"    mov     r0, r5\n"
"    pop.w   {r2, r3, r4, r5, r6, r7, r8, sb, sl, pc}\n"
".ltorg\n"
     );
}

void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook");
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook");
}

 
 
//exp_drv_task  -s=task_ExpDrv -c=428 -f=chdk

void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
// task_ExpDrv 0xfc291ccf
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   sb, =0x0000d1b0\n"
"    ldr.w   sl, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr     r6, =0x0005e458\n"
"    add.w   r8, sp, #0x1c\n"
"    movw    fp, #0xbb8\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc291cea:\n"
"    ldr.w   r0, [sb, #0x20]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r4, sb\n"
"    blx     sub_fc2cf348\n" // j_ReceiveMessageQueue
"    ldr     r0, [sp, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc291d22\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x14\n"
"loc_fc291d04:\n"
"    beq     loc_fc291e04\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc291d04\n"
"    cmp     r0, #0x16\n"
"    beq     loc_fc291d04\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc291d04\n"
"    cmp     r0, #0x18\n"
"    beq     loc_fc291e14\n"
"    cmp     r0, #0x2e\n"
"    beq     loc_fc291dbe\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc291c8a\n"
"loc_fc291d22:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x34\n"
"    bne     loc_fc291d40\n"
"    bl      sub_fc292b82\n"
"    ldr.w   r0, [sb, #0x1c]\n"
"    movs    r1, #1\n"
"    blx     sub_fc2cf328\n" // j_SetEventFlag
"    blx     sub_fc2cf358\n"
"    add     sp, #0x2c\n"
//"    b       loc_fc291a14\n" //out of range
" ldmia.w sp!, {r4, r5, r6, r7, r8, r9, sl, fp, pc}\n"
//// 0xfc291a14
//"    pop.w   {r4, r5, r6, r7, r8, sb, sl, fp, pc}\n"

"loc_fc291d40:\n"
"    cmp     r1, #0x33\n"
"    bne     loc_fc291d52\n"
"    add.w   r0, r0, #0xac\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc292162\n"
"loc_fc291d52:\n"
"    cmp     r1, #0x2c\n"
"    bne     loc_fc291d88\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    ldr     r0, =0xfc28db35\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc14d27a\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    mov     r2, fp\n"
"    blx     sub_fc2cf1b8\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc291d7a\n"
"    movw    r2, #0x17d8\n"
"    b       loc_fc291e0a\n"
"loc_fc291d7a:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc292162\n"
"loc_fc291d88:\n"
"    cmp     r1, #0x2d\n"
"    bne     loc_fc291dba\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc291c8a\n"
"    movw    r5, #0x100\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r1, r5\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    ldr     r0, =0xfc28db3f\n"
"    mov     r1, r5\n"
"    bl      sub_fc14dbfa\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r2, fp\n"
"    mov     r1, r5\n"
"    blx     sub_fc2cf1b8\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc291d7a\n"
"    movw    r2, #0x17e2\n"
"    b       loc_fc291e0a\n"
"loc_fc291dba:\n"
"    cmp     r1, #0x2e\n"
"    bne     loc_fc291dc8\n"
"loc_fc291dbe:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc291c8a\n"
"    b       loc_fc291d7a\n"
"loc_fc291dc8:\n"
"    cmp     r1, #0x31\n"
"    bne     loc_fc291dda\n"
"    bl      sub_fc16d89c\n"
"    bl      sub_fc16e228\n"
"    bl      sub_fc16df0a\n"
"    b       loc_fc291d7a\n"
"loc_fc291dda:\n"
"    cmp     r1, #0x32\n"
"    bne     loc_fc291e14\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    ldr     r1, =0xfc28db53\n"
"    movs    r2, #4\n"
"    mov     r0, sl\n"
"    bl      sub_fc292bd4\n"
"    bl      sub_fc16d5fe\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    mov     r2, fp\n"
"    blx     sub_fc2cf3d0\n" // j_WaitForAnyEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc291d7a\n"
"    b       loc_fc291e06\n"
"loc_fc291e04:\n"
"    b       loc_fc291e14\n"
"loc_fc291e06:\n"
"    movw    r2, #0x181a\n"
"loc_fc291e0a:\n"
"    ldr     r1, =0xfc28e360\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"    b       loc_fc291d7a\n"
"loc_fc291e14:\n"
"    ldr     r0, [sp, #0x28]\n"
"    movs    r5, #1\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x12\n"
"    beq     loc_fc291e22\n"
"    cmp     r1, #0x13\n"
"    bne     loc_fc291e60\n"
"loc_fc291e22:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc290578\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc292dea\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x20]\n"
"    b       loc_fc292088\n"
"loc_fc291e60:\n"
"    cmp     r1, #0x14\n"
"    beq     loc_fc291e74\n"
"    cmp     r1, #0x15\n"
"    beq     loc_fc291e74\n"
"    cmp     r1, #0x16\n"
"    beq     loc_fc291e74\n"
"    cmp     r1, #0x17\n"
"    beq     loc_fc291e74\n"
"    cmp     r1, #0x18\n"
"    bne     loc_fc291ee6\n"
"loc_fc291e74:\n"
"    add     r3, sp, #0xc\n"
"    mov     r2, sp\n"
"    add     r1, sp, #0x1c\n"
"    bl      sub_fc29074c\n"
"    cmp     r0, #1\n"
"    mov     r4, r0\n"
"    beq     loc_fc291e88\n"
"    cmp     r4, #5\n"
"    bne     loc_fc291e9e\n"
"loc_fc291e88:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc291ec4\n"
"loc_fc291e9e:\n"
"    cmp     r4, #2\n"
"    beq     loc_fc291ea6\n"
"    cmp     r4, #6\n"
"    bne     loc_fc291ed0\n"
"loc_fc291ea6:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc291a18\n"
"loc_fc291ec4:\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc291c3a\n"
"    b       loc_fc29208e\n"
"loc_fc291ed0:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc29208e\n"
"loc_fc291ee6:\n"
"    cmp     r1, #0x28\n"
"    beq     loc_fc291eee\n"
"    cmp     r1, #0x29\n"
"    bne     loc_fc291f20\n"
"loc_fc291eee:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc28f6ac\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc28fa9c\n"
"    b       loc_fc29208e\n"
"loc_fc291f20:\n"
"    adds    r1, r0, #4\n"
"    mov     r4, r8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2c\n"
"    bhs     loc_fc291f62\n"
"    tbb     [pc, r1]\n" // (jumptable r1 44 elements)
"branchtable_fc291f32:\n"
"    .byte((loc_fc291f5e - branchtable_fc291f32) / 2)\n" // (case 0)
"    .byte((loc_fc291f5e - branchtable_fc291f32) / 2)\n" // (case 1)
"    .byte((loc_fc291f64 - branchtable_fc291f32) / 2)\n" // (case 2)
"    .byte((loc_fc291f6a - branchtable_fc291f32) / 2)\n" // (case 3)
"    .byte((loc_fc291f6a - branchtable_fc291f32) / 2)\n" // (case 4)
"    .byte((loc_fc291f6a - branchtable_fc291f32) / 2)\n" // (case 5)
"    .byte((loc_fc291f5e - branchtable_fc291f32) / 2)\n" // (case 6)
"    .byte((loc_fc291f64 - branchtable_fc291f32) / 2)\n" // (case 7)
"    .byte((loc_fc291f6a - branchtable_fc291f32) / 2)\n" // (case 8)
"    .byte((loc_fc291f6a - branchtable_fc291f32) / 2)\n" // (case 9)
"    .byte((loc_fc291f7c - branchtable_fc291f32) / 2)\n" // (case 10)
"    .byte((loc_fc291f7c - branchtable_fc291f32) / 2)\n" // (case 11)
"    .byte((loc_fc29206c - branchtable_fc291f32) / 2)\n" // (case 12)
"    .byte((loc_fc292072 - branchtable_fc291f32) / 2)\n" // (case 13)
"    .byte((loc_fc292072 - branchtable_fc291f32) / 2)\n" // (case 14)
"    .byte((loc_fc292072 - branchtable_fc291f32) / 2)\n" // (case 15)
"    .byte((loc_fc292072 - branchtable_fc291f32) / 2)\n" // (case 16)
"    .byte((loc_fc292078 - branchtable_fc291f32) / 2)\n" // (case 17)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 18)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 19)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 20)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 21)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 22)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 23)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 24)
"    .byte((loc_fc291f70 - branchtable_fc291f32) / 2)\n" // (case 25)
"    .byte((loc_fc291f76 - branchtable_fc291f32) / 2)\n" // (case 26)
"    .byte((loc_fc291f76 - branchtable_fc291f32) / 2)\n" // (case 27)
"    .byte((loc_fc291f76 - branchtable_fc291f32) / 2)\n" // (case 28)
"    .byte((loc_fc291fac - branchtable_fc291f32) / 2)\n" // (case 29)
"    .byte((loc_fc291fac - branchtable_fc291f32) / 2)\n" // (case 30)
"    .byte((loc_fc291fac - branchtable_fc291f32) / 2)\n" // (case 31)
"    .byte((loc_fc291fb2 - branchtable_fc291f32) / 2)\n" // (case 32)
"    .byte((loc_fc291fdc - branchtable_fc291f32) / 2)\n" // (case 33)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 34)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 35)
"    .byte((loc_fc292006 - branchtable_fc291f32) / 2)\n" // (case 36)
"    .byte((loc_fc292030 - branchtable_fc291f32) / 2)\n" // (case 37)
"    .byte((loc_fc29205a - branchtable_fc291f32) / 2)\n" // (case 38)
"    .byte((loc_fc29205a - branchtable_fc291f32) / 2)\n" // (case 39)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 40)
"    .byte((loc_fc29207c - branchtable_fc291f32) / 2)\n" // (case 41)
"    .byte((loc_fc292060 - branchtable_fc291f32) / 2)\n" // (case 42)
"    .byte((loc_fc292066 - branchtable_fc291f32) / 2)\n" // (case 43)
".align 1\n"
"loc_fc291f5e:\n"
"    bl      sub_fc28e0b0\n"
"loc_fc291f62:\n"
"    b       loc_fc29207c\n"
"loc_fc291f64:\n"
"    bl      sub_fc28e314\n"
"    b       loc_fc29207c\n"
"loc_fc291f6a:\n"
"    bl      sub_fc28e53e\n"
"    b       loc_fc29207c\n"
"loc_fc291f70:\n"
"    bl      sub_fc28e7e2\n"
"    b       loc_fc29207c\n"
"loc_fc291f76:\n"
"    bl      sub_fc28e996\n"
"    b       loc_fc29207c\n"
"loc_fc291f7c:\n"
//"    bl      sub_fc28edc8\n"
"    bl      sub_fc28edc8_my\n"//  --->
"    movs    r5, #0\n"
"    b       loc_fc29207c\n"
".ltorg\n"
// something wrong here: literals?
/*
"    b       loc_fc292648\n"
"    stc2    p11, c13, [r8], #-0xac\n"
"    stc2    p11, c13, [r8], #-0x1fc\n"
"    stc2    p1, c13, [r8], #-0x2c0\n"
"    movs    r0, r0\n"
"    blt     loc_fc29202a\n"
"    stc2    p4, c14, [r8], #-0x160\n"
"    movs    r5, r0\n"
"    bl      sub_fbe92f9e\n"
"    blt     loc_fc29200e\n"
"    stc2    p11, c13, [r8], #-0xfc\n"
"    stc2    p11, c13, [r8], #-0x14c\n"
"    stc2    p7, c15, [r8], #-0x3f0\n"
*/
/* todo figure this out
loc_fc291f7c:
fc291f7c: 	f7fc ff24 	bl	sub_fc28edc8
fc291f80: 	2500      	movs	r5, #0
fc291f82: 	e07b      	b	loc_fc29207c
fc291f84: 	e360      	b	loc_fc292648
fc291f86: 	fc28 db2b 	stc2	p11, c13, [r8], #-0xac
fc291f8a: 	fc28 db7f 	stc2	p11, c13, [r8], #-0x1fc
fc291f8e: 	fc28 d1b0 	stc2	p1, c13, [r8], #-0x2c0
fc291f92: 	0000      	movs	r0, r0
fc291f94: 	db49      	blt	loc_fc29202a
fc291f96: 	fc28 e458 	stc2	p4, c14, [r8], #-0x160
fc291f9a: 	0005      	movs	r5, r0
fc291f9c: 	f400 ffff 	bl	sub_fbe92f9e
fc291fa0: 	db35      	blt	loc_fc29200e
fc291fa2: 	fc28 db3f 	stc2	p11, c13, [r8], #-0xfc
fc291fa6: 	fc28 db53 	stc2	p11, c13, [r8], #-0x14c
fc291faa: 	fc28 f7fc 	stc2	p7, c15, [r8], #-0x3f0
; ff89
*/
// ff89
// 0xfc291fac fc f7 89 ff
"loc_fc291fac:\n"
"    bl      sub_fc28eec2\n"
"    b       loc_fc29207c\n"
"loc_fc291fb2:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc28f3f2\n"
"    b       loc_fc29207c\n"
"loc_fc291fdc:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc292c40\n"
"    b       loc_fc29207c\n"
"loc_fc292006:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r0, #6]\n"
"loc_fc29200e:\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"loc_fc29202a:\n"
"    bl      sub_fc292cc6\n"
"    b       loc_fc29207c\n"
"loc_fc292030:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc292d7c\n"
"    b       loc_fc29207c\n"
"loc_fc29205a:\n"
"    bl      sub_fc28f4d2\n"
"    b       loc_fc29207c\n"
"loc_fc292060:\n"
"    bl      sub_fc28fb64\n"
"    b       loc_fc29207c\n"
"loc_fc292066:\n"
"    bl      sub_fc28ff46\n"
"    b       loc_fc29207c\n"
"loc_fc29206c:\n"
"    bl      sub_fc29014c\n"
"    b       loc_fc29207c\n"
"loc_fc292072:\n"
"    bl      sub_fc2902a2\n"
"    b       loc_fc29207c\n"
"loc_fc292078:\n"
"    bl      sub_fc2903be\n"
"loc_fc29207c:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"loc_fc292088:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc29208e:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x10\n"
"    beq     loc_fc2920b2\n"
"    bgt     loc_fc2920a6\n"
"    cmp     r0, #1\n"
"    beq     loc_fc2920b2\n"
"    cmp     r0, #4\n"
"    beq     loc_fc2920b2\n"
"    cmp     r0, #0xe\n"
"    bne     loc_fc2920e0\n"
"    b       loc_fc2920b2\n"
"loc_fc2920a6:\n"
"    cmp     r0, #0x13\n"
"    beq     loc_fc2920b2\n"
"    cmp     r0, #0x18\n"
"    beq     loc_fc2920b2\n"
"    cmp     r0, #0x1b\n"
"    bne     loc_fc2920e0\n"
"loc_fc2920b2:\n"
"    ldrsh.w r1, [r6]\n"
"    mov     r2, sl\n"
"    cmp     r1, sl\n"
"    beq     loc_fc2920c4\n"
"    ldrsh.w r0, [r6, #8]\n"
"    cmp     r0, r2\n"
"    bne     loc_fc2920d8\n"
"loc_fc2920c4:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc2dd202\n"
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"    b       loc_fc2920dc\n"
"loc_fc2920d8:\n"
"    strh.w  r1, [sp, #0x1c]\n"
"loc_fc2920dc:\n"
"    strh.w  r0, [sp, #0x24]\n"
"loc_fc2920e0:\n"
"    cmp     r5, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc292118\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r4, r0, r1, lsl #2\n"
"    ldr     r0, =0x0005e458\n"
"    subs    r4, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc2cf428\n"
"    ldr     r0, =0x0005e458\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc2cf428\n"
"    ldr     r0, =0x0005e458\n"
"    movs    r2, #0xc\n"
"    mov     r1, r4\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc2cf428\n"
"    b       loc_fc292162\n"
"loc_fc292118:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc292142\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc28df02\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc29215e\n"
"loc_fc292142:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc28df02\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc29215e:\n"
"    bl      sub_fc28e036\n"
"loc_fc292162:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc292b82\n"
"    b       loc_fc291cea\n"
".ltorg\n"
    );
}
//loc_fc28edc8: -s=0xfc1e6633 -c=  -f=chdk
void __attribute__((naked,noinline)) sub_fc28edc8_my() {
asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000d1b0\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x1c]\n"
"    blx     sub_fc2cf3d8\n" // j_ClearEventFlag
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc28db94\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc28dd32\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc28dd76\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc28ddba\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc28ddfe\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x0005e470\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc28ee1c\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc28ee34\n"
"loc_fc28ee1c:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc28ee34\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc28db2b\n"
"    bl      sub_fc14d46a\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x28]\n"
"    b       loc_fc28ee3a\n"
"loc_fc28ee34:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc28ee3a:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc28ee4c\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc28db7f\n"
"    bl      sub_fc292c16\n"
"    b       loc_fc28ee50\n"
"loc_fc28ee4c:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc28ee50:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
//"    bl      sub_fc16d658\n"
"    bl      sub_fc16d658_my\n"// -->
"ldr pc, =0xfc28ee5b\n" //continue in ROM thumb
".ltorg\n"
/*
fc28ee56: 	f6de fbff 	bl	sub_fc16d658
fc28ee5a: 	f9b4 0008 	ldrsh.w	r0, [r4, #8]
fc28ee5e: 	2101      	movs	r1, #1
 
*/
 );
}
//loc_fc16d658:
void __attribute__((naked,noinline)) sub_fc16d658_my() {
asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000cd4c\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc16d670\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16b\n"
"    ldr     r1, =0xfc16d6b8\n" //  *"Shutter.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc16d670:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc16d67a\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc16d67a:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc16d68c\n"
"    movs    r0, #0\n"
"    movw    r2, #0x171\n"
"    ldr     r1, =0xfc16d6b8\n" //  *"Shutter.c"
"    blx     sub_fc2cf408\n" // j_DebugAssert
"loc_fc16d68c:\n"
"    mov     r0, r4\n"
"    bl      apex2us\n"
//"    mov     r4, r0\n"
//"    bl      sub_fc194f4e\n"
//"    mov     r0, r4\n"
"    bl      sub_fc199bb8\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc16d6b2\n"
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    movw    r2, #0x176\n"
"    ldr     r1, =0xfc16d6b8\n" //  *"Shutter.c"
//"    b.w     loc_fc2ce950\n"
"ldr pc, =0xfc2ce951\n" //replace above with thumb
"loc_fc16d6b2:\n"
"    pop     {r4, r5, r6, pc}\n"
".ltorg\n"
 );
}



