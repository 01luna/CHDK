/*
 * touchw.c - auto-generated by CHDK code_gen.
 */
extern int kbd_is_blocked(void);

/*************************************************************/
//** my_touchw_task @ 0xFFA3B740 - 0xFFA3B778, length=15
void __attribute__((naked,noinline)) my_touchw_task() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR}\n"
"    BL      sub_FFA3B638 \n"
"    LDR     R5, =0x895C \n"
"    LDR     R4, =0x56C2C \n"

"loc_FFA3B750:\n"
"    MOV     R1, #0 \n"
"    LDR     R0, [R4] \n"
"    BL      _TakeSemaphore \n"
"    LDR     R2, =0x56C38 \n"
"    LDR     R1, =0x56C6C \n"
// loosely based on ixus860_sd870
"     BL      kbd_is_blocked\n"
"     MOV     R6, R0\n"
"    LDR     R0, [R2] \n"
"    LDR     R3, [R1] \n"

// if not blocked, use original
"     CMP     R6, #0\n"
"     BEQ     bypass_skip_touch\n"

// if kbd is blocked, skip touch events
"     CMP     R0, #2\n"
"     CMPEQ   R3, #1\n"
"     BEQ     loc_FFA3B750\n"

"bypass_skip_touch:\n"

"    ADD     R3, R3, R0, LSL#2 \n"
"    MOV     LR, PC \n"
"    LDR     PC, [R5, R3, LSL#2] \n"
"    B       loc_FFA3B750 \n"
);
}
