/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

#define USE_STUBS_NRFLAG 1          // see stubs_entry.S

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFF866C80 - 0xFF866F48, length=179
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R3-R9,LR} \n"
"    LDR     R6, =0x1AC98 \n"
"    LDR     R5, =0x5A14 \n"
"    MOV     R9, #1 \n"
"    MOV     R7, #0 \n"

"loc_FF866C94:\n"
"    LDR     R0, [R5, #0x14] \n"
"    MOV     R2, #0 \n"
"    MOV     R1, SP \n"
"    BL      sub_FF82A4F8 /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF866CC0 \n"
"    LDR     R1, =0x415 \n"
"    LDR     R0, =0xFF866700 /*'SsShootTask.c'*/ \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    LDMFD   SP!, {R3-R9,PC} \n"

"loc_FF866CC0:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x1B \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF866F10 \n"
"    B       loc_FF866D44 \n"
"    B       loc_FF866DB4 \n"
"    B       loc_FF866DBC \n"
"    B       loc_FF866DD4 \n"
"    B       loc_FF866DC8 \n"
"    B       loc_FF866DDC \n"
"    B       loc_FF866DE4 \n"
"    B       loc_FF866DEC \n"
"    B       loc_FF866E44 \n"
"    B       loc_FF866E50 \n"
"    B       loc_FF866E58 \n"
"    B       loc_FF866E60 \n"
"    B       loc_FF866E68 \n"
"    B       loc_FF866E70 \n"
"    B       loc_FF866E78 \n"
"    B       loc_FF866E80 \n"
"    B       loc_FF866E88 \n"
"    B       loc_FF866E90 \n"
"    B       loc_FF866E98 \n"
"    B       loc_FF866EA0 \n"
"    B       loc_FF866EA8 \n"
"    B       loc_FF866EB4 \n"
"    B       loc_FF866EC0 \n"
"    B       loc_FF866EC8 \n"
"    B       loc_FF866EF8 \n"
"    B       loc_FF866F00 \n"
"    B       loc_FF866F08 \n"
"    B       loc_FF866F1C \n"

"loc_FF866D44:\n"
"    BL      sub_FF95F0C8 \n"
"    BL      shooting_expo_param_override\n"      // added
"    BL      sub_FF864B94 \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BEQ     loc_FF866F1C \n"
"    BL      sub_FF8663D8 \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BEQ     loc_FF866D8C \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FF869B98 \n"
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x40000000 \n"
"    STRNE   R0, [R4, #8] \n"
"    BNE     loc_FF866F1C \n"

"loc_FF866D8C:\n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960A6C \n"
"    BL      sub_FF9733C8 \n"
"    BL      sub_FF87491C \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960F8C \n"
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    B       loc_FF866F1C \n"

"loc_FF866DB4:\n"
"    BL      sub_FF86677C_my \n"  // --> Patched. Old value = 0xFF86677C.
"    B       loc_FF866DCC \n"

"loc_FF866DBC:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FF95F310 \n"
"    B       loc_FF866F1C \n"

"loc_FF866DC8:\n"
"    BL      sub_FF95EE64 \n"

"loc_FF866DCC:\n"
"    STR     R7, [R6, #0x24] \n"
"    B       loc_FF866F1C \n"

"loc_FF866DD4:\n"
"    BL      sub_FF95F094 \n"
"    B       loc_FF866DCC \n"

"loc_FF866DDC:\n"
"    BL      sub_FF95F09C \n"
"    B       loc_FF866F1C \n"

"loc_FF866DE4:\n"
"    BL      sub_FF95F1FC \n"
"    B       loc_FF866E48 \n"

"loc_FF866DEC:\n"
"    LDR     R4, [R0, #0xC] \n"
"    BL      sub_FF95F0A4 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF95FBD4 \n"
"    TST     R0, #1 \n"
"    MOV     R8, R0 \n"
"    BNE     loc_FF866E2C \n"
"    BL      sub_FF87491C \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960EBC \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF961374 \n"
"    MOV     R8, R0 \n"
"    LDR     R0, [R4, #0x14] \n"
"    BL      sub_FF874B10 \n"

"loc_FF866E2C:\n"
"    BL      sub_FF95F094 \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #7 \n"
"    MOV     R0, R8 \n"
"    BL      sub_FF864FD0 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E44:\n"
"    BL      sub_FF95F28C \n"

"loc_FF866E48:\n"
"    BL      sub_FF864B94 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E50:\n"
"    BL      sub_FF95F094 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E58:\n"
"    BL      sub_FF95FE20 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E60:\n"
"    BL      sub_FF96001C \n"
"    B       loc_FF866F1C \n"

"loc_FF866E68:\n"
"    BL      sub_FF960100 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E70:\n"
"    BL      sub_FF9601B4 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E78:\n"
"    BL      sub_FF960618 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E80:\n"
"    BL      sub_FF96065C \n"
"    B       loc_FF866F1C \n"

"loc_FF866E88:\n"
"    MOV     R0, #0 \n"
"    B       loc_FF866EAC \n"

"loc_FF866E90:\n"
"    BL      sub_FF9607D0 \n"
"    B       loc_FF866F1C \n"

"loc_FF866E98:\n"
"    BL      sub_FF960864 \n"
"    B       loc_FF866F1C \n"

"loc_FF866EA0:\n"
"    BL      sub_FF960918 \n"
"    B       loc_FF866F1C \n"

"loc_FF866EA8:\n"
"    MOV     R0, #1 \n"

"loc_FF866EAC:\n"
"    BL      sub_FF9606B0 \n"
"    B       loc_FF866F1C \n"

"loc_FF866EB4:\n"
"    BL      sub_FF95F4AC \n"
"    BL      sub_FF867034 \n"
"    B       loc_FF866F1C \n"

"loc_FF866EC0:\n"
"    BL      sub_FF96042C \n"
"    B       loc_FF866F1C \n"

"loc_FF866EC8:\n"
"    MOV     R2, #2 \n"
"    ADD     R1, R6, #0x58 \n"
"    MOV     R0, #0x6F \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    LDRNE   R0, =0xFF866700 /*'SsShootTask.c'*/ \n"
"    MOVNE   R1, #0x4D0 \n"
"    BLNE    _DebugAssert \n"
"    LDRH    R0, [R6, #0x58] \n"
"    CMP     R0, #1 \n"
"    BLEQ    sub_FF960420 \n"
"    B       loc_FF866F1C \n"

"loc_FF866EF8:\n"
"    BL      sub_FF960564 \n"
"    B       loc_FF866F1C \n"

"loc_FF866F00:\n"
"    BL      sub_FF866664 \n"
"    B       loc_FF866F1C \n"

"loc_FF866F08:\n"
"    BL      sub_FF8268FC \n"
"    B       loc_FF866F1C \n"

"loc_FF866F10:\n"
"    LDR     R1, =0x4F1 \n"
"    LDR     R0, =0xFF866700 /*'SsShootTask.c'*/ \n"
"    BL      _DebugAssert \n"

"loc_FF866F1C:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0, #4] \n"
"    LDR     R0, [R5, #0x10] \n"
"    BL      sub_FF82A274 /*_SetEventFlag*/ \n"
"    LDR     R4, [SP] \n"
"    LDR     R0, [R4, #8] \n"
"    CMP     R0, #0 \n"
"    LDREQ   R0, =0xFF866700 /*'SsShootTask.c'*/ \n"
"    MOVEQ   R1, #0xF7 \n"
"    BLEQ    _DebugAssert \n"
"    STR     R7, [R4, #8] \n"
"    B       loc_FF866C94 \n"
);
}

/*************************************************************/
//** sub_FF86677C_my @ 0xFF86677C - 0xFF866954, length=119
void __attribute__((naked,noinline)) sub_FF86677C_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R4, [R0, #0xC] \n"
"    LDR     R5, =0x1AC98 \n"
"    LDR     R0, [R4, #8] \n"
"    LDR     R6, =0x820A \n"
"    ORR     R0, R0, #1 \n"
"    STR     R0, [R4, #8] \n"
"    LDRH    R0, [R5] \n"
"    LDR     R8, =0x5A14 \n"
"    MOV     R7, #0 \n"
"    CMP     R0, R6 \n"
"    BEQ     loc_FF866820 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF866874 \n"
"    LDR     R0, [R4, #0xC] \n"
"    CMP     R0, #1 \n"
"    BLS     loc_FF86682C \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF866874 \n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #2 \n"
"    BNE     loc_FF866838 \n"
"    BL      sub_FF95F560 \n"
"    LDRH    R0, [R5] \n"
"    CMP     R0, R6 \n"
"    BEQ     loc_FF866820 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF866874 \n"
"    LDR     R0, [R4, #0xC] \n"
"    CMP     R0, #1 \n"
"    BLS     loc_FF86682C \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF866874 \n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #2 \n"
"    BEQ     loc_FF866864 \n"
"    B       loc_FF866838 \n"

"loc_FF866820:\n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    BEQ     loc_FF866874 \n"

"loc_FF86682C:\n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF866874 \n"

"loc_FF866838:\n"
"    LDRH    R0, [R5, #0x82] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF866874 \n"
"    LDRH    R0, [R5] \n"
"    CMP     R0, R6 \n"
"    LDRNE   R0, [R4, #0xC] \n"
"    CMPNE   R0, #1 \n"
"    BLS     loc_FF866874 \n"
"    LDR     R0, [R4, #0x10] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF866874 \n"

"loc_FF866864:\n"
"    LDR     R2, =0xEA60 \n"
"    LDR     R0, [R8, #0x10] \n"
"    MOV     R1, #0x40000000 \n"
"    BL      sub_FF869EF8 \n"

"loc_FF866874:\n"
"    BL      sub_FF866664 \n"
"    LDR     R0, [R5, #0x24] \n"
"    CMP     R0, #0 \n"
"    MOVEQ   R0, #2 \n"
"    BLEQ    sub_FF85FC7C \n"
"    BL      sub_FF95F0A4 \n"
"    LDR     R0, [R4, #0x18] \n"
"    CMP     R0, #0 \n"
"    BLNE    sub_FF861F28 \n"
"    LDR     R0, [R5, #0x24] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF8668F0 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960A6C \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF95F7F0 \n"
"    TST     R0, #1 \n"
"    MOVNE   R2, R4 \n"
"    LDMNEFD SP!, {R4-R8,LR} \n"
"    MOVNE   R1, #1 \n"
"    BNE     sub_FF864FD0 \n"
"    BL      sub_FF9733C8 \n"
"    BL      sub_FF87491C \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960EBC \n"
"    BL      sub_FF9617AC \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF960F8C_my \n"  // --> Patched. Old value = 0xFF960F8C. This is where shooting AND darkframe sub is done so hook it
"    MOV     R7, R0 \n"
"    BL      capt_seq_hook_raw_here \n"         // added
"    B       loc_FF8668FC \n"

"loc_FF8668F0:\n"
"    LDR     R0, [R8, #4] \n"
"    CMP     R0, #0 \n"
"    MOVNE   R7, #0x1D \n"

"loc_FF8668FC:\n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, R7 \n"
"    BL      sub_FF864FD0 \n"
"    BL      sub_FF961314 \n"
"    CMP     R0, #0 \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x2000 \n"
"    STRNE   R0, [R4, #8] \n"
"    LDR     R0, [R4, #0x18] \n"
"    CMP     R0, #0 \n"
"    BLNE    sub_FF861F40 \n"
"    LDRH    R0, [R5, #0x88] \n"
"    CMP     R0, #3 \n"
"    LDMEQFD SP!, {R4-R8,PC} \n"
"    LDRH    R0, [R5, #0x86] \n"
"    CMP     R0, #0 \n"
"    LDREQH  R0, [R5, #0x82] \n"
"    CMPEQ   R0, #2 \n"
"    MOVEQ   R0, R4 \n"
"    LDMEQFD SP!, {R4-R8,LR} \n"
"    BEQ     sub_FF95F5A8 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"
);
}

/*************************************************************/
//** sub_FF960F8C_my @ 0xFF960F8C - 0xFF960FF8, length=28
void __attribute__((naked,noinline)) sub_FF960F8C_my() {
asm volatile (
"    STMFD   SP!, {R0-R8,LR} \n"
"    MOV     R4, R0 \n"
"    BL      sub_FF9618E8 \n"
"    MVN     R1, #0 \n"
"    BL      sub_FF82A2A8 /*_ClearEventFlag*/ \n"
"    MOV     R2, #4 \n"
"    ADD     R1, SP, #8 \n"
"    MOV     R0, #0x8A \n"
"    BL      _GetPropertyCase \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x1D2 \n"
"    LDRNE   R0, =0xFF9611A4 /*'SsCaptureSeq.c'*/ \n"
"    BLNE    _DebugAssert \n"
"    LDR     R6, =0x1AD48 \n"
"    LDR     R7, =0x1AC98 \n"
"    LDRSH   R1, [R6, #0xE] \n"
"    LDR     R0, [R7, #0x7C] \n"
//"  BL      _sub_FF91C038 \n"  // --> Nullsub call removed.
"    BL      _GetCCDTemperature \n"
"    LDR     R2, =0xB708 \n"
"    ADD     R3, R4, #0x78 \n"
"    STRH    R0, [R4, #0x74] \n"
"    STRD    R2, [SP] \n"
"    MOV     R1, R0 \n"
"    LDRH    R0, [R7, #0x54] \n"
"    LDRSH   R2, [R6, #0xC] \n"
"    LDR     R3, =0xB704 \n"
"    BL      sub_FFA402C0 \n"  // 2 (NR) is set into 0xB704 in this sub! Still before shooting
"    BL      wait_until_remote_button_is_released\n" // added
"    BL      capt_seq_hook_set_nr\n"                 // added
"    LDR     PC, =0xFF960FFC \n"  // Continue in firmware
);
}

/*************************************************************/
//** exp_drv_task @ 0xFF8D37C0 - 0xFF8D3D88, length=371
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R8, =0xBB8 \n"
"    LDR     R6, =0x3F21C \n"
"    LDR     R5, =0x7B5C \n"
"    SUB     SP, SP, #0x20 \n"
"    ADD     R7, SP, #0x10 \n"

"loc_FF8D37D8:\n"
"    LDR     R0, [R5, #0x20] \n"
"    MOV     R2, #0 \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_FF82A4F8 /*_ReceiveMessageQueue*/ \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x23 \n"
"    BNE     loc_FF8D3818 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4838 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF82A274 /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x20 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"

"loc_FF8D3818:\n"
"    CMP     R1, #0x22 \n"
"    BNE     loc_FF8D3834 \n"
"    LDR     R2, [R0, #0x88]! \n"
"    LDR     R1, [R0, #4] \n"
"    MOV     R0, R1 \n"
"    BLX     R2 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3834:\n"
"    CMP     R1, #0x1D \n"
"    BNE     loc_FF8D3884 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF82A2A8 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8D0328 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF9526DC \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF82A1AC /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0xCAE \n"
"    BNE     loc_FF8D391C \n"

"loc_FF8D3870:\n"
"    LDR     R1, [SP, #0x1C] \n"
"    LDR     R0, [R1, #0x8C] \n"
"    LDR     R1, [R1, #0x88] \n"
"    BLX     R1 \n"
"    B       loc_FF8D3D80 \n"

"loc_FF8D3884:\n"
"    CMP     R1, #0x1E \n"
"    BNE     loc_FF8D38C4 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF82A2A8 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8D0338 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF952E84 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF82A1AC /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8D3870 \n"
"    LDR     R1, =0xCB8 \n"
"    B       loc_FF8D391C \n"

"loc_FF8D38C4:\n"
"    CMP     R1, #0x1F \n"
"    CMPNE   R1, #0x20 \n"
"    BNE     loc_FF8D396C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF82A2A8 /*_ClearEventFlag*/ \n"
"    LDR     R0, [R4] \n"
"    MOV     R1, #0x40 \n"
"    CMP     R0, #0x1F \n"
"    LDR     R0, =0xFF8D0378 \n"
"    BNE     loc_FF8D38FC \n"
"    BL      sub_FF9533E8 \n"
"    B       loc_FF8D3900 \n"

"loc_FF8D38FC:\n"
"    BL      sub_FF953488 \n"

"loc_FF8D3900:\n"
"    LDR     R0, [R5, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF82A1AC /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8D3870 \n"
"    LDR     R1, =0xCC6 \n"

"loc_FF8D391C:\n"
"    LDR     R0, =0xFF8D0A4C /*'ExpDrv.c'*/ \n"
"    BL      _DebugAssert \n"
"    B       loc_FF8D3870 \n"
"    ANDEQ   R0, R0, R4, LSR R10 \n"

"loc_FF8D396C:\n"
"    CMP     R1, #0x21 \n"
"    BNE     loc_FF8D3984 \n"
"    BL      sub_FF8B4AEC \n"
"    BL      sub_FF8B57A0 \n"
"    BL      sub_FF8B52DC \n"
"    B       loc_FF8D3870 \n"

"loc_FF8D3984:\n"
"    CMP     R1, #0xD \n"
"    MOV     R4, #1 \n"
"    BNE     loc_FF8D39E8 \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2,R3,R12} \n"
"    STMIA   R7, {R2,R3,R12} \n"
"    BL      sub_FF8D2318 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4C00 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x90] \n"
"    LDR     R2, [R0, #0x94] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    B       loc_FF8D3CB8 \n"

"loc_FF8D39E8:\n"
"    CMP     R1, #0xE \n"
"    CMPNE   R1, #0xF \n"
"    BNE     loc_FF8D3A90 \n"
"    ADD     R2, SP, #4 \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8D2550 \n"
"    CMP     R0, #1 \n"
"    MOV     R4, R0 \n"
"    CMPNE   R4, #5 \n"
"    BNE     loc_FF8D3A30 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, R4 \n"
"    LDR     R1, [R0, #0x7C]! \n"
"    LDR     R12, [R0, #0xC]! \n"
"    LDR     R3, [R0, #4] \n"
"    ADD     R0, SP, #4 \n"
"    BLX     R12 \n"
"    B       loc_FF8D3A68 \n"

"loc_FF8D3A30:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    CMP     R4, #2 \n"
"    LDR     R3, [R0, #0x8C] \n"
"    CMPNE   R4, #6 \n"
"    BNE     loc_FF8D3A78 \n"
"    LDR     R12, [R0, #0x88] \n"
"    ADD     R0, SP, #4 \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    BLX     R12 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    ADD     R2, SP, #4 \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8D3520 \n"

"loc_FF8D3A68:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R1, R4 \n"
"    BL      sub_FF8D376C \n"
"    B       loc_FF8D3CB8 \n"

"loc_FF8D3A78:\n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R12, [R0, #0x88] \n"
"    ADD     R0, R0, #4 \n"
"    MOV     R2, R4 \n"
"    BLX     R12 \n"
"    B       loc_FF8D3CB8 \n"

"loc_FF8D3A90:\n"
"    CMP     R1, #0x19 \n"
"    CMPNE   R1, #0x1A \n"
"    BNE     loc_FF8D3ADC \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2-R4} \n"
"    STMIA   R7, {R2-R4} \n"
"    BL      sub_FF8D18F4 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D1BD8 \n"
"    B       loc_FF8D3CB8 \n"

"loc_FF8D3ADC:\n"
"    ADD     R1, R0, #4 \n"
"    LDMIA   R1, {R2,R3,R12} \n"
"    STMIA   R7, {R2,R3,R12} \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x1C \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3B6C \n"
"    B       loc_FF8D3B74 \n"
"    B       loc_FF8D3B7C \n"
"    B       loc_FF8D3B7C \n"
"    B       loc_FF8D3B6C \n"
"    B       loc_FF8D3B74 \n"
"    B       loc_FF8D3B7C \n"
"    B       loc_FF8D3B7C \n"
"    B       loc_FF8D3B94 \n"
"    B       loc_FF8D3B94 \n"
"    B       loc_FF8D3C80 \n"
"    B       loc_FF8D3C88 \n"
"    B       loc_FF8D3C90 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3B84 \n"
"    B       loc_FF8D3B8C \n"
"    B       loc_FF8D3BA0 \n"
"    B       loc_FF8D3BA8 \n"
"    B       loc_FF8D3BD8 \n"
"    B       loc_FF8D3C08 \n"
"    B       loc_FF8D3C38 \n"
"    B       loc_FF8D3C68 \n"
"    B       loc_FF8D3C68 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3C98 \n"
"    B       loc_FF8D3C70 \n"
"    B       loc_FF8D3C78 \n"

"loc_FF8D3B6C:\n"
"    BL      sub_FF8D0830 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3B74:\n"
"    BL      sub_FF8D0AAC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3B7C:\n"
"    BL      sub_FF8D0CAC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3B84:\n"
"    BL      sub_FF8D0EFC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3B8C:\n"
"    BL      sub_FF8D10EC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3B94:\n"
"    BL      sub_FF8D1340_my \n"  // --> Patched. Old value = 0xFF8D1340.
"    MOV     R4, #0 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3BA0:\n"
"    BL      sub_FF8D1478 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3BA8:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D48AC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3BD8:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R6, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4A20 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C08:\n"
"    LDRH    R1, [R6] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R0, #6] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R6, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4AC8 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C38:\n"
"    LDRH    R1, [R6] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R6, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R6, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R6, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8D4B68 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C68:\n"
"    BL      sub_FF8D16CC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C70:\n"
"    BL      sub_FF8D1CDC \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C78:\n"
"    BL      sub_FF8D1F0C \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C80:\n"
"    BL      sub_FF8D2080 \n"
"    B       loc_FF8D3C98 \n"

"loc_FF8D3C88:\n"
"    MOV     R1, #0 \n"
"    B       loc_FF8D3C94 \n"

"loc_FF8D3C90:\n"
"    MOV     R1, #1 \n"

"loc_FF8D3C94:\n"
"    BL      sub_FF8D2214 \n"

"loc_FF8D3C98:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    CMP     R4, #1 \n"
"    BNE     loc_FF8D3D00 \n"

"loc_FF8D3CB8:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, #0xC \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R0, R0, R1, LSL#2 \n"
"    SUB     R4, R0, #8 \n"
"    LDR     R0, =0x3F21C \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA929B4 \n"
"    LDR     R0, =0x3F228 \n"
"    MOV     R2, #0xC \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA929B4 \n"
"    LDR     R0, =0x3F234 \n"
"    MOV     R2, #0xC \n"
"    MOV     R1, R4 \n"
"    BL      sub_FFA929B4 \n"
"    B       loc_FF8D3D78 \n"

"loc_FF8D3D00:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #9 \n"
"    BNE     loc_FF8D3D48 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF8D062C \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    B       loc_FF8D3D74 \n"

"loc_FF8D3D48:\n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"
"    BL      sub_FF8D062C \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"

"loc_FF8D3D74:\n"
"    BL      sub_FF8D0778 \n"

"loc_FF8D3D78:\n"
"    MOV     R0, #0 \n"
"    STR     R0, [R5, #0x34] \n"

"loc_FF8D3D80:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8D4838 \n"
"    B       loc_FF8D37D8 \n"
);
}

/*************************************************************/
//** sub_FF8D1340_my @ 0xFF8D1340 - 0xFF8D13F8, length=47
void __attribute__((naked,noinline)) sub_FF8D1340_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R7, =0x7B5C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x3E \n"
"    BL      sub_FF82A2A8 /*_ClearEventFlag*/ \n"
"    LDRSH   R0, [R4, #4] \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF8D0398 \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF8D04CC \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FF8D0524 \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FF8D057C \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    BL      sub_FF8D05D4 \n"
"    MOV     R5, R0 \n"
"    LDR     R0, [R4] \n"
"    LDR     R8, =0x3F234 \n"
"    CMP     R0, #9 \n"
"    MOVEQ   R6, #0 \n"
"    MOVEQ   R5, #0 \n"
"    BEQ     loc_FF8D13CC \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF8D13CC \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFF8D0318 \n"
"    MOV     R2, #2 \n"
"    BL      sub_FF9527E8 \n"
"    STRH    R0, [R4, #4] \n"
"    MOV     R0, #0 \n"
"    STR     R0, [R7, #0x28] \n"
"    B       loc_FF8D13D4 \n"

"loc_FF8D13CC:\n"
"    LDRH    R0, [R8] \n"
"    STRH    R0, [R4, #4] \n"

"loc_FF8D13D4:\n"
"    CMP     R5, #1 \n"
"    LDRNEH  R0, [R8, #8] \n"
"    BNE     loc_FF8D13F0 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFF8D0388 \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FF8D4868 \n"

"loc_FF8D13F0:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF8B4890_my \n"  // --> Patched. Old value = 0xFF8B4890.
"    LDR     PC, =0xFF8D13FC \n"  // Continue in firmware
);
}

/*************************************************************/
//** sub_FF8B4890_my @ 0xFF8B4890 - 0xFF8B48F8, length=27
void __attribute__((naked,noinline)) sub_FF8B4890_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R5, =0x74CC \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #4] \n"
"    CMP     R0, #1 \n"
"    LDRNE   R1, =0x16B \n"
"    LDRNE   R0, =0xFF8B4674 /*'Shutter.c'*/ \n"
"    BLNE    _DebugAssert \n"
"    CMN     R4, #0xC00 \n"
"    LDREQSH R4, [R5, #2] \n"
"    CMN     R4, #0xC00 \n"
"    LDREQ   R1, =0x171 \n"
"    LDREQ   R0, =0xFF8B4674 /*'Shutter.c'*/ \n"
"    STRH    R4, [R5, #2] \n"
"    BLEQ    _DebugAssert \n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    MOV     R4, R0 \n"
//"  BL      _sub_FF8E33E8 \n"  // --> Nullsub call removed.
"    MOV     R0, R4 \n"
"    BL      sub_FF8E7C18 \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x176 \n"
"    LDMNEFD SP!, {R4-R6,LR} \n"
"    LDRNE   R0, =0xFF8B4674 /*'Shutter.c'*/ \n"
"    BNE     _DebugAssert \n"
"    LDMFD   SP!, {R4-R6,PC} \n"
);
}
