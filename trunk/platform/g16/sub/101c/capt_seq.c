#include "lolevel.h"
#include "platform.h"
#include "core.h"

//#define PAUSE_FOR_FILE_COUNTER 300  // G16 : not needed. Enables delay in capt_seq_hook_raw_here to ensure file counter is updated before use by RAW/DNG filenaming

//#define CAPT_SEQ_DEBUG 1

#define NR_AUTO (0)                       // G16 : seems to fix issues with first shot(s) not being in the right mode
static long *nrflag = (long*)0x0001c028 ; // 0x0001c024 - 0x08 + 0x0c  found at 0xfc33bebe

#ifdef CAPT_SEQ_DEBUG
extern void _LogCameraEvent(int id,const char *fmt,...);   // debug
extern int active_raw_buffer;
extern char *hook_raw_image_addr(void);

void log_remote_hook(void)
{
    _LogCameraEvent(0x60,"Remote Hook:");
}

void log_raw_hook(void) {
#ifdef VARIABLE_RAW_BUFFER
    _LogCameraEvent(0x60,"Raw Hook: arb:%d rb:0x%08x rbc:0x%08x",active_raw_buffer,hook_raw_image_addr(),current_raw_addr2);
#else
    _LogCameraEvent(0x60,"Raw Hook: arb:%d rb:0x%08x",active_raw_buffer,hook_raw_image_addr());
#endif
}

void log_capt_seq1(int m)
{
    _LogCameraEvent(0x60,"Capture Sequence Start: m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"Capture Sequence End: m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq3(void)
{
    _LogCameraEvent(0x60,"Capture Sequence Override: arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
#endif

#include "../../../generic/capt_seq.c"

//***  capt_seq_task *****

// G16 1.01c  task_CaptSeq 193
// task_CaptSeq 0xfc0f24ab
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x0003a2f4\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000bd10\n"
"loc_fc0f24b2:\n"
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #4]\n"
"    blx     sub_fc2a1610\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0f24d4\n"
"    movw    r2, #0x4d9\n"
"    ldr     r1, =0xfc0f20e8\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"    blx     sub_fc2a1630\n" // -> ExitTask
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc0f24d4:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc0f24ec\n"
"    cmp     r0, #0x22\n"
"    beq     loc_fc0f24ec\n"
"    cmp     r0, #0x2b\n"
"    beq     loc_fc0f24ec\n"
"    cmp     r0, #0x1e\n"
"    beq     loc_fc0f24ec\n"
"    bl      sub_fc1d5544\n"
"loc_fc0f24ec:\n"
#ifdef CAPT_SEQ_DEBUG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq1\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2e\n"
"    bhs     loc_fc0f25d6\n"
"    tbb     [pc, r1]\n" // (jumptable r1 46 elements)
"branchtable_fc0f24f8:\n"
"    .byte((loc_fc0f2526 - branchtable_fc0f24f8) / 2)\n" // (case 0) **
"    .byte((loc_fc0f2544 - branchtable_fc0f24f8) / 2)\n" // (case 1) **
"    .byte((loc_fc0f254c - branchtable_fc0f24f8) / 2)\n" // (case 2)
"    .byte((loc_fc0f255a - branchtable_fc0f24f8) / 2)\n" // (case 3) **
"    .byte((loc_fc0f2554 - branchtable_fc0f24f8) / 2)\n" // (case 4) **
"    .byte((loc_fc0f2562 - branchtable_fc0f24f8) / 2)\n" // (case 5)
"    .byte((loc_fc0f2568 - branchtable_fc0f24f8) / 2)\n" // (case 6)
"    .byte((loc_fc0f256e - branchtable_fc0f24f8) / 2)\n" // (case 7)
"    .byte((loc_fc0f2576 - branchtable_fc0f24f8) / 2)\n" // (case 8)
"    .byte((loc_fc0f25a8 - branchtable_fc0f24f8) / 2)\n" // (case 9)
"    .byte((loc_fc0f2580 - branchtable_fc0f24f8) / 2)\n" // (case 10)
"    .byte((loc_fc0f2588 - branchtable_fc0f24f8) / 2)\n" // (case 11)
"    .byte((loc_fc0f258e - branchtable_fc0f24f8) / 2)\n" // (case 12)
"    .byte((loc_fc0f2596 - branchtable_fc0f24f8) / 2)\n" // (case 13)
"    .byte((loc_fc0f259c - branchtable_fc0f24f8) / 2)\n" // (case 14)
"    .byte((loc_fc0f25a2 - branchtable_fc0f24f8) / 2)\n" // (case 15)
"    .byte((loc_fc0f25ae - branchtable_fc0f24f8) / 2)\n" // (case 16)
"    .byte((loc_fc0f25b4 - branchtable_fc0f24f8) / 2)\n" // (case 17)
"    .byte((loc_fc0f25ba - branchtable_fc0f24f8) / 2)\n" // (case 18)
"    .byte((loc_fc0f25c0 - branchtable_fc0f24f8) / 2)\n" // (case 19)
"    .byte((loc_fc0f25c6 - branchtable_fc0f24f8) / 2)\n" // (case 20)
"    .byte((loc_fc0f25cc - branchtable_fc0f24f8) / 2)\n" // (case 21)
"    .byte((loc_fc0f25d0 - branchtable_fc0f24f8) / 2)\n" // (case 22)
"    .byte((loc_fc0f25d8 - branchtable_fc0f24f8) / 2)\n" // (case 23)
"    .byte((loc_fc0f25de - branchtable_fc0f24f8) / 2)\n" // (case 24)
"    .byte((loc_fc0f25e4 - branchtable_fc0f24f8) / 2)\n" // (case 25)
"    .byte((loc_fc0f25ea - branchtable_fc0f24f8) / 2)\n" // (case 26)
"    .byte((loc_fc0f25f0 - branchtable_fc0f24f8) / 2)\n" // (case 27)
"    .byte((loc_fc0f25f8 - branchtable_fc0f24f8) / 2)\n" // (case 28)
"    .byte((loc_fc0f25fe - branchtable_fc0f24f8) / 2)\n" // (case 29)
"    .byte((loc_fc0f2602 - branchtable_fc0f24f8) / 2)\n" // (case 30)
"    .byte((loc_fc0f260a - branchtable_fc0f24f8) / 2)\n" // (case 31) **
"    .byte((loc_fc0f2610 - branchtable_fc0f24f8) / 2)\n" // (case 32)
"    .byte((loc_fc0f263a - branchtable_fc0f24f8) / 2)\n" // (case 33)
"    .byte((loc_fc0f2640 - branchtable_fc0f24f8) / 2)\n" // (case 34)
"    .byte((loc_fc0f2646 - branchtable_fc0f24f8) / 2)\n" // (case 35)
"    .byte((loc_fc0f264c - branchtable_fc0f24f8) / 2)\n" // (case 36)
"    .byte((loc_fc0f2652 - branchtable_fc0f24f8) / 2)\n" // (case 37)
"    .byte((loc_fc0f2658 - branchtable_fc0f24f8) / 2)\n" // (case 38)
"    .byte((loc_fc0f2660 - branchtable_fc0f24f8) / 2)\n" // (case 39)
"    .byte((loc_fc0f2666 - branchtable_fc0f24f8) / 2)\n" // (case 40) **
"    .byte((loc_fc0f2670 - branchtable_fc0f24f8) / 2)\n" // (case 41)
"    .byte((loc_fc0f26a8 - branchtable_fc0f24f8) / 2)\n" // (case 42)
"    .byte((loc_fc0f26ae - branchtable_fc0f24f8) / 2)\n" // (case 43) **
"    .byte((loc_fc0f269c - branchtable_fc0f24f8) / 2)\n" // (case 44)
"    .byte((loc_fc0f26c8 - branchtable_fc0f24f8) / 2)\n" // (case 45) **
".align 1\n"
"loc_fc0f2526:\n"  // case 0 : Half Press ?
"    bl      sub_fc15321c\n"
#ifdef CAPT_SEQ_DEBUG
"bl log_capt_seq3\n"
#endif
"    BL      shooting_expo_param_override\n" // ---->> added
"    bl      sub_fc151b06\n"
"    ldr     r0, [r4, #0x28]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc0f2538\n"
"    bl      sub_fc1d447a_my\n"   // ---->> SUB1
"loc_fc0f2538:\n"
"    b       loc_fc0f26c8\n"
".ltorg\n"

/* literal pool removed */

"loc_fc0f2544:\n"    // case 1 : Normal Shoot
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc1d4286_my\n"  // ---->> SUB2
"    b       loc_fc0f26c8\n"

"loc_fc0f254c:\n"             // case 2
"    movs    r0, #1\n"
"    bl      sub_fc1534ea\n"
"    b       loc_fc0f26c8\n"

"loc_fc0f2554:\n"              // case 4
"    bl      sub_fc152fde\n"
"    b       loc_fc0f255e\n"
"loc_fc0f255a:\n"              // case 3
"    bl      sub_fc153208\n"
"loc_fc0f255e:\n"
"    str     r6, [r4, #0x28]\n"
"    b       loc_fc0f26c8\n"

"loc_fc0f2562:\n"
"    bl      sub_fc15320c\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2568:\n"
"    bl      sub_fc1533c4\n"
"    b       loc_fc0f257a\n"
"loc_fc0f256e:\n"
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc1d44ee\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2576:\n"
"    bl      sub_fc153474\n"
"loc_fc0f257a:\n"
"    bl      sub_fc151b06\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2580:\n"
"    ldr     r0, [r4, #0x58]\n"
"    bl      sub_fc153a98\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2588:\n"
"    bl      sub_fc153d2e\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f258e:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc153d7a\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2596:\n"
"    bl      sub_fc153f7e\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f259c:\n"
"    bl      sub_fc15441a\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25a2:\n"
"    bl      sub_fc1544aa\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25a8:\n"
"    bl      sub_fc153208\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25ae:\n"
"    bl      sub_fc1d2ed4\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25b4:\n"
"    bl      sub_fc1d30a4\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25ba:\n"
"    bl      sub_fc1d311e\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25c0:\n"
"    bl      sub_fc1d31b0\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25c6:\n"
"    bl      sub_fc1d3264\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25cc:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f25f2\n"
"loc_fc0f25d0:\n"
"    bl      sub_fc1d362a\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25d6:\n"
"    b       loc_fc0f26ba\n"
"loc_fc0f25d8:\n"
"    bl      sub_fc1d3688\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25de:\n"
"    bl      sub_fc1d368c\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25e4:\n"
"    bl      sub_fc1d369c\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25ea:\n"
"    bl      sub_fc1d3718\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25f0:\n"
"    movs    r0, #1\n"
"loc_fc0f25f2:\n"
"    bl      sub_fc1d351c\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25f8:\n"
"    bl      sub_fc153622\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f25fe:\n"
"    movs    r0, #0\n"
"    b       loc_fc0f2604\n"
"loc_fc0f2602:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc0f2604:\n"
"    bl      sub_fc153680\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f260a:\n"
"    bl      sub_fc1d341e\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2610:\n"
"    ldr     r1, =0x0003a356\n"
"    movs    r2, #2\n"
"    movs    r0, #0x6f\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0f262c\n"
"    movw    r2, #0x5ed\n"
"    ldr     r1, =0xfc0f20e8\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc0f262c:\n"
"    ldrh.w  r0, [r4, #0x62]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc0f26c8\n"
"    bl      sub_fc1d3418\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f263a:\n"
"    bl      sub_fc1d34b4\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2640:\n"
"    bl      sub_fc1d4f1e\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2646:\n"
"    bl      sub_fc152510\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f264c:\n"
"    bl      sub_fc1563f2\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2652:\n"
"    bl      sub_fc1564a6\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2658:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc1d37d8\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2660:\n"
"    bl      sub_fc1d383a\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2666:\n"
"    bl      sub_fc1565a2\n"
"    bl      sub_fc1564e8\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f2670:\n"
"    movs    r0, #1\n"
"    bl      sub_fc1d4b60\n"
"    movs    r0, #1\n"
"    bl      sub_fc1d4c2a\n"
"    ldrh.w  r0, [r4, #0x1b0]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc0f268e\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x4200\n"
"    subs    r1, #0x30\n"
"    bne     loc_fc0f26c8\n"
"loc_fc0f268e:\n"
"    bl      sub_fc1564a6\n"
"    bl      sub_fc1569ac\n"
"    bl      sub_fc1567cc\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f269c:\n"
"    bl      sub_fc15469e\n"
"    movs    r0, #1\n"
"    bl      sub_fc156110\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f26a8:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"    b       loc_fc0f26b2\n"
"loc_fc0f26ae:\n"
"    movs    r2, #0\n"
"    movs    r1, #0xf\n"
"loc_fc0f26b2:\n"
"    movs    r0, #0\n"
"    bl      sub_fc15272a\n"
"    b       loc_fc0f26c8\n"
"loc_fc0f26ba:\n"
"    movw    r2, #0x65f\n"
"    ldr     r1, =0xfc0f20e8\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc0f26c8:\n"

#ifdef CAPT_SEQ_DEBUG
// debug after message handled
"  ldr     r0, [sp]\n"
"  ldr     r0, [r0]\n"
"  bl log_capt_seq2\n"
#endif
"    bl      capt_seq_hook_set_nr\n" //  ---->> dark frame control
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5]\n"
"    blx     sub_fc2a1530\n" // j_SetEventFlag
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc0f26e6\n"
"    movw    r2, #0x127\n"
"    ldr     r1, =0xfc0f20e8\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc0f26e6:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc0f24b2\n"

".ltorg\n"
    );
}

// G16 1.01c  0xfc1d447b 39
void __attribute__((naked,noinline)) sub_fc1d447a_my() {   // SUB1
    asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    bl      sub_fc152e7e\n"
"    mov     r4, r0\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2ba334\n"
"    ldr     r6, =0x000136f0\n"
"    lsls    r0, r0, #0x1f\n"
"    mov.w   r5, #1\n"
"    bne     loc_fc1d44ea\n"
"    bl      sub_fc2ba36e\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1d44ea\n"
"    bl      sub_fc153210\n"
"    bl      sub_fc1552ae\n"
"    mov     r1, r4\n"
"  bl        sub_fc155328\n"
"    movs    r2, #4\n"
"    movw    r0, #0x10e\n"
"    add.w   r1, r4, #0x84\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2c\n"
"    add.w   r1, r4, #0x88\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x3f\n"
"    add.w   r1, r4, #8\n"
"    bl      _SetPropertyCase\n"
"    bl      sub_fc1d4d1a\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc1d3fa4\n"
"    mov     r0, r4\n"
"    bl      sub_fc38ecda_my\n"   // ---->>  SUB3
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1d44ec\n"
"loc_fc1d44ea:\n"
"    str     r5, [r6]\n"
"loc_fc1d44ec:\n"
"    pop     {r4, r5, r6, pc}\n"

".ltorg\n"
    );
}

// G16 1.01c  0xfc1d4287 187
void __attribute__((naked,noinline)) sub_fc1d4286_my() {    // SUB2
    asm volatile (
"    push    {r2, r3, r4, r5, r6, lr}\n"
"    ldr     r6, =0x0003a2f4\n"
"    mov     r4, r0\n"
"    movs    r5, #0\n"
"    ldr     r0, [r6, #0x28]\n"
"    cbz     r0, loc_fc1d42ae\n"
"    ldr     r0, =0x000136f0\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc1d429a\n"
"    movs    r5, #0x1d\n"
"loc_fc1d429a:\n"
"    mov     r2, r4\n"
"    movs    r1, #1\n"
"    mov     r0, r5\n"
"    bl      sub_fc15272a\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d53a4\n"
"    b       loc_fc1d4474\n"
"loc_fc1d42ae:\n"
"    bl      sub_fc1552ae\n"
"    mov     r1, r4\n"
"    bl      sub_fc155328\n"
"    movs    r2, #4\n"
"    movw    r0, #0x10e\n"
"    add.w   r1, r4, #0x84\n"
"    bl      _SetPropertyCase\n"
"    movs    r2, #4\n"
"    movs    r0, #0x2c\n"
"    add.w   r1, r4, #0x88\n"
"    bl      _SetPropertyCase\n"
"    ldr.w   r0, [r6, #0x134]\n"
"    cbz     r0, loc_fc1d42fa\n"
"    ldrh.w  r0, [r6, #0x1ae]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1d42fa\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1d42fa\n"
"    ldr.w   r0, [r6, #0xec]\n"
"    cbnz    r0, loc_fc1d4312\n"
"    bl      sub_fc0e425e\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1d4312\n"
"    bl      sub_fc2ba3bc\n"
"    b       loc_fc1d4310\n"
"loc_fc1d42fa:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc2ba334\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1d430c\n"
"    bl      sub_fc2ba36e\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1d4312\n"
"loc_fc1d430c:\n"
"    bl      sub_fc152506\n"
"loc_fc1d4310:\n"
"    movs    r5, #1\n"
"loc_fc1d4312:\n"
"    ldr.w   r0, [r6, #0x1d8]\n"
"    cbz     r0, loc_fc1d432e\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc1d432e\n"
"    movs    r0, #1\n"
"    bl      sub_fc156110\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1d432e\n"
"    bl      sub_fc152506\n"
"    movs    r5, #1\n"
"loc_fc1d432e:\n"
"    lsls    r0, r5, #0x1f\n"
"loc_fc1d4330:\n"
"    bne     loc_fc1d441a\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d4f68\n"
"    bl      sub_fc1d4d1a\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    mov     r0, r4\n"
"    bl      sub_fc38e9f2\n"
"    mov     r5, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc1d4330\n"
"    bl      sub_fc153210\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d3fa4\n"
"    ldr.w   r0, [r6, #0x130]\n"
"    cbnz    r0, loc_fc1d436e\n"
"    ldrh.w  r0, [r6, #0x1ae]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1d436e\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc1d4374\n"
"loc_fc1d436e:\n"
"    movs    r0, #2\n"
"    bl      sub_fc0f4ae2\n"
"loc_fc1d4374:\n"
"    ldr.w   r0, [r6, #0xa8]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc1d43e2\n"
"    ldrh.w  r0, [r6, #0x1ae]\n"
"    movw    r5, #0x1000\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1d43a2\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1d43a2\n"
"    bl      sub_fc1d4d1a\n"
"    movs    r3, #0xf5\n"
"    movw    r2, #0x3a98\n"
"    mov     r1, r5\n"
"    str     r3, [sp]\n"
"    ldr     r3, =0xfc1d45c8\n" //  *"SsCaptureCtrl.c"
"    bl      sub_fc2ba528\n"
"loc_fc1d43a2:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x180\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc1d43bc\n"
"    movs    r2, #0xf9\n"
"    movs    r0, #0\n"
"    ldr     r1, =0xfc1d45c8\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc1d43bc:\n"
"    ldr     r0, [sp, #4]\n"
"    cbnz    r0, loc_fc1d43cc\n"
"    bl      sub_fc1d4d1a\n"
"    mov     r1, r5\n"
"    blx     sub_fc2a1530\n" // j_SetEventFlag
"    b       loc_fc1d43e2\n"
"loc_fc1d43cc:\n"
"    bl      sub_fc1d4d1a\n"
"    mov     r1, r5\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    ldr     r2, =0xfc1d4275\n"
"    mov     r3, r5\n"
"    ldr     r0, [sp, #4]\n"
"    mov     r1, r2\n"
"    bl      sub_fc2fbb00\n"
"loc_fc1d43e2:\n"
"    ldr.w   r0, [r6, #0x19c]\n"
"    cbz     r0, loc_fc1d43fe\n"
"    ldrh.w  r0, [r6, #0x1ae]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc1d43fe\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bls     loc_fc1d43fe\n"
"    movw    r0, #0x2710\n"
"    bl      sub_fc13e33a\n"
"loc_fc1d43fe:\n"
"    ldr.w   r0, [r6, #0xb0]\n"
"    cbz     r0, loc_fc1d440c\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f42a\n"
"    b       loc_fc1d4452\n"
"loc_fc1d440c:\n"
"    ldr.w   r0, [r6, #0xb4]\n"
"    cbz     r0, loc_fc1d441c\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f16a\n"
"    b       loc_fc1d4452\n"
"loc_fc1d441a:\n"
"    b       loc_fc1d4462\n"
"loc_fc1d441c:\n"
"    ldr.w   r0, [r6, #0xb8]\n"
"    cbz     r0, loc_fc1d442a\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f72e\n"
"    b       loc_fc1d4452\n"
"loc_fc1d442a:\n"
"    ldr.w   r0, [r6, #0xbc]\n"
"    cbz     r0, loc_fc1d443e\n"
"    ldr     r0, =0x0003a4ec\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc1d443e\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f9f6\n"
"    b       loc_fc1d4452\n"
"loc_fc1d443e:\n"
"    ldr.w   r0, [r6, #0xc0]\n"
"    cmp     r0, #0\n"
"    mov     r0, r4\n"
"    beq     loc_fc1d444e\n"
"    bl      sub_fc38fcc0\n"
"    b       loc_fc1d4452\n"
"loc_fc1d444e:\n"
"    bl      sub_fc38ecda_my\n"    //   ---->>  SUB3
"loc_fc1d4452:\n"
"    ldr.w   r0, [r6, #0x1d8]\n"
"    cbz     r0, loc_fc1d4474\n"
"    movs    r1, #0\n"
"    movs    r0, #1\n"
"    bl      sub_fc15615a\n"
"    b       loc_fc1d4474\n"
"loc_fc1d4462:\n"
"    movs    r1, #1\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc15272a\n"
"    mov     r1, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d54da\n"
"loc_fc1d4474:\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x28]\n"
"    pop     {r2, r3, r4, r5, r6, pc}\n"

".ltorg\n"
    );
}

// G16 1.01c  0xfc38ecdb 207
void __attribute__((naked,noinline)) sub_fc38ecda_my() {   // SUB3
    asm volatile (
"    push.w  {r2, r3, r4, r5, r6, r7, r8, sb, sl, lr}\n"
"    ldr     r7, =0x0003a2f4\n"
"    mov     r4, r0\n"
"    ldr.w   r0, [r7, #0x174]\n"
"    cbz     r0, loc_fc38ecf6\n"
"    ldrh.w  r0, [r7, #0x1ae]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc38ecf6\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc38ed00\n"
"loc_fc38ecf6:\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d3f44\n"
"    bl      sub_fc1d4990\n"
"loc_fc38ed00:\n"
"    ldr.w   r0, [r7, #0xa4]\n"
"    cbnz    r0, loc_fc38ed1c\n"
"    ldrh.w  r0, [r7, #0x1ae]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc38ed14\n"
"    ldr     r0, [r4, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc38ed1c\n"
"loc_fc38ed14:\n"
"    bl      sub_fc15366e\n"
"    bl      sub_fc1d45fe\n"
"loc_fc38ed1c:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x12f\n"
"    add     r1, sp, #4\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc38ed38\n"
"    movs    r0, #0\n"
"    movw    r2, #0x17b\n"
"    ldr     r1, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc38ed38:\n"
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc38ed48\n"
"    ldr     r0, =0xfc38ecb3\n"
"    movs    r1, #0\n"
"    b       loc_fc38ed4c\n"
"loc_fc38ed48:\n"
"    ldr     r0, =0xfc1d3c5b\n"
"    mov     r1, r4\n"
"loc_fc38ed4c:\n"
"    bl      sub_fc23b134\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d4056\n"
"    ldr     r1, =0x00023e88\n"
"    movs    r2, #4\n"
"    movs    r0, #0x8a\n"
"    bl      _GetPropertyCase\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc38ed70\n"
"    movs    r0, #0\n"
"    movw    r2, #0x18a\n"
"    ldr     r1, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc38ed70:\n"
"    bl      sub_fc1561d2\n"
"    bl      sub_fc1d4106\n"
"    movs    r1, #0\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f098\n"
"    mov     r6, r0\n"
"    bl      wait_until_remote_button_is_released\n" // ---->> remote hook
#ifdef CAPT_SEQ_DEBUG
"    bl      log_remote_hook\n"   // ---->>
#endif
"    ldr     r0, [sp, #4]\n"
"    mov.w   sb, #0\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc38ed94\n"
"    ldr     r2, =0xfc1d3de3\n"
"    b       loc_fc38ed96\n"
"loc_fc38ed94:\n"
"    ldr     r2, =0xfc1d3e59\n"
"loc_fc38ed96:\n"
"    ldrh    r0, [r4, #0x18]\n"
"    ldr     r5, =0x00023e88\n"
"    cbz     r0, loc_fc38eda4\n"
"    cmp     r0, #1\n"
"    beq     loc_fc38edbc\n"
"    cmp     r0, #4\n"
"    bne     loc_fc38ee28\n"
"loc_fc38eda4:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr.w   r1, [r4, #0x88]\n"
"    mov     r0, r4\n"
"    ldr     r2, [r5]\n"
"    bl      sub_fc1d3b06\n"
"    mov     r5, r0\n"
"    bl      sub_fc247414\n"
"    b       loc_fc38ee36\n"
"loc_fc38edbc:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr.w   r1, [r4, #0x88]\n"
"    mov     r8, r5\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d3b52\n"
"    movs    r2, #1\n"
"    mov     r5, r0\n"
"    movs    r1, #0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc255758\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc38ee36\n"
"    ldr.w   r0, [r7, #0x100]\n"
"    cbz     r0, loc_fc38edf6\n"
"    ldr     r1, [r4, #8]\n"
"    ldr     r2, =0x0017b14c\n"
"    ldr.w   r0, [r4, #0x88]\n"
"    add.w   r1, r2, r1, lsl #2\n"
"    str     r0, [r1, #-0x4]\n"
"    b       loc_fc38ee22\n"
"loc_fc38edf6:\n"
"    ldr     r0, =0xfc38ecb3\n"
"    movs    r1, #0\n"
"    bl      sub_fc23b134\n"
"    movs    r1, #1\n"
"    mov     r0, r4\n"
"    bl      sub_fc38f098\n"
"    mov     r6, r0\n"
"    ldr.w   r0, [r8]\n"
"    mov     r5, r8\n"
"    bl      sub_fc1d3ee6\n"
"    ldr.w   r1, [r4, #0x88]\n"
"    mov     r3, r6\n"
"    ldr     r2, [r5]\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d3ba2\n"
"    mov     r5, r0\n"
"loc_fc38ee22:\n"
"    bl      sub_fc1d3ab0\n"
"    b       loc_fc38ee36\n"
"loc_fc38ee28:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1bc\n"
"    ldr     r1, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"    movs    r5, #0x1d\n"
"loc_fc38ee36:\n"
"    bl      sub_fc1d410a\n"
"    ldr.w   r8, =0xfc38ecb3\n"
"    lsls    r0, r5, #0x1f\n"
"    bne     loc_fc38eeb2\n"
"    ldr.w   r0, [r7, #0x108]\n"
"    cbnz    r0, loc_fc38ee6c\n"
"    ldr.w   r0, [r7, #0x19c]\n"
"    cmp     r0, #0\n"
"    mov     r0, r4\n"
"    beq     loc_fc38ee68\n"
"    bl      sub_fc1d5a1e\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc38ee6c\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1d2\n"
"    ldr     r1, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"    b       loc_fc38ee6c\n"
"loc_fc38ee68:\n"
"    bl      sub_fc1d5720\n"
"loc_fc38ee6c:\n"
#ifdef CAPT_SEQ_DEBUG
"  bl log_raw_hook\n"                  // ---->>
#endif
"    bl      capt_seq_hook_raw_here\n" // ---->>
"    mov     r0, r4\n"
"    bl      sub_fc1d40f6\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d40c6\n"
"    cmp     r6, r8\n"
"    beq     loc_fc38eea0\n"
"    bl      sub_fc1d4d1a\n"
"    movs    r1, #4\n"
"    movw    sl, #0x1e3\n"
"    ldr     r3, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sl, [sp]\n"
"    bl      sub_fc2ba528\n"
"    cbz     r0, loc_fc38eea0\n"
"    movs    r0, #0\n"
"    mov     r2, sl\n"
"    ldr     r1, =0xfc38f0b0\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc38eea0:\n"
"    ldr.w   r0, [r7, #0x184]\n"
"    cbz     r0, loc_fc38eeaa\n"
"    mov     r0, sb\n"
"    b       loc_fc38eeae\n"
"loc_fc38eeaa:\n"
"    bl      sub_fc13f2e6\n"
"loc_fc38eeae:\n"
"    str.w   r0, [r4, #0x128]\n"
"loc_fc38eeb2:\n"
"    ldr.w   r0, [r7, #0x19c]\n"
"    cbz     r0, loc_fc38eec2\n"
"    movs    r2, #1\n"
"    movs    r1, #0\n"
"    movs    r0, #0x46\n"
"    bl      sub_fc255758\n"
"loc_fc38eec2:\n"
"    movs    r1, #1\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc15272a\n"
"    ldr     r0, [r7, #0x28]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc38eee8\n"
"    cmp     r6, r0\n"
"    beq     loc_fc38eedc\n"
"    movs    r1, #1\n"
"    b       loc_fc38eede\n"
"loc_fc38eedc:\n"
"    movs    r1, #0\n"
"loc_fc38eede:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d5362\n"
"    b       loc_fc38eefa\n"
"loc_fc38eee8:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc38eef0\n"
"    movs    r1, #1\n"
"    b       loc_fc38eef2\n"
"loc_fc38eef0:\n"
"    movs    r1, #0\n"
"loc_fc38eef2:\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc1d531c\n"
"loc_fc38eefa:\n"
"    mov     r0, r5\n"
"    pop.w   {r2, r3, r4, r5, r6, r7, r8, sb, sl, pc}\n"

".ltorg\n"
    );
}


// *******  exp_drv_task  *******

// G16 1.01a  task_ExpDrv 425
// task_ExpDrv 0xfc226ba3
void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   sb, =0x0000d8d0\n"
"    ldr.w   sl, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr     r6, =0x0005c6fc\n"
"    add.w   r8, sp, #0x1c\n"
"    movw    fp, #0xbb8\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc226bbe:\n"
"    ldr.w   r0, [sb, #0x20]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r4, sb\n"
"    blx     sub_fc2a1610\n" // j_ReceiveMessageQueue
"    ldr     r0, [sp, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc226bf2\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x14\n"
"loc_fc226bd8:\n"
"    beq     loc_fc226cd8\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc226bd8\n"
"    cmp     r0, #0x16\n"
"    beq     loc_fc226bd8\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc226ce4\n"
"    cmp     r0, #0x2a\n"
"    beq     loc_fc226c8e\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc226b5e\n"
"loc_fc226bf2:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x30\n"
"    bne     loc_fc226c10\n"
"    bl      sub_fc227944\n"
"    ldr.w   r0, [sb, #0x1c]\n"
"    movs    r1, #1\n"
"    blx     sub_fc2a1530\n" // j_SetEventFlag
"    blx     sub_fc2a1630\n" // -> ExitTask
"    add     sp, #0x2c\n"
//"    b       loc_fc226924\n"                             // branches to pop.w   {r4, r5, r6, r7, r8, sb, sl, fp, pc}
"    ldmia.w sp!, {r4, r5, r6, r7, r8, r9, sl, fp, pc}\n"  // substitute this instead
"loc_fc226c10:\n"
"    cmp     r1, #0x2f\n"
"    bne     loc_fc226c22\n"
"    add.w   r0, r0, #0xa8\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc227030\n"
"loc_fc226c22:\n"
"    cmp     r1, #0x28\n"
"    bne     loc_fc226c58\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    ldr     r0, =0xfc222bc9\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc14db82\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #0x80\n"
"    mov     r2, fp\n"
"    blx     sub_fc2a1528\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc226c4a\n"
"    movw    r2, #0x16ef\n"
"    b       loc_fc226cd6\n"
"loc_fc226c4a:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xa8\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc227030\n"
"loc_fc226c58:\n"
"    cmp     r1, #0x29\n"
"    bne     loc_fc226c8a\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc226b5e\n"
"    movw    r5, #0x100\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r1, r5\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    ldr     r0, =0xfc222bd3\n"
"    mov     r1, r5\n"
"    bl      sub_fc14e502\n"
"    ldr     r0, [r4, #0x1c]\n"
"    mov     r2, fp\n"
"    mov     r1, r5\n"
"    blx     sub_fc2a1528\n" // j_WaitForAllEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc226c4a\n"
"    movw    r2, #0x16f9\n"
"    b       loc_fc226cd6\n"
"loc_fc226c8a:\n"
"    cmp     r1, #0x2a\n"
"    bne     loc_fc226c98\n"
"loc_fc226c8e:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc226b5e\n"
"    b       loc_fc226c4a\n"
"loc_fc226c98:\n"
"    cmp     r1, #0x2d\n"
"    bne     loc_fc226caa\n"
"    bl      sub_fc2e118e\n"
"    bl      sub_fc1742fc\n"
"    bl      sub_fc173fe2\n"
"    b       loc_fc226c4a\n"
"loc_fc226caa:\n"
"    cmp     r1, #0x2e\n"
"    bne     loc_fc226ce4\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    ldr     r1, =0xfc222be7\n"
"    movs    r2, #4\n"
"    mov     r0, sl\n"
"    bl      sub_fc2e0d70\n"
"    bl      sub_fc2e0efc\n"
"    ldr     r0, [r4, #0x1c]\n"
"    movs    r1, #4\n"
"    mov     r2, fp\n"
"    blx     sub_fc2a15c0\n" // j_WaitForAnyEventFlag
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc226c4a\n"
"    movw    r2, #0x1731\n"
"loc_fc226cd6:\n"
"    b       loc_fc226cda\n"
"loc_fc226cd8:\n"
"    b       loc_fc226ce4\n"
"loc_fc226cda:\n"
"    ldr     r1, =0xfc222fcc\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"    b       loc_fc226c4a\n"
"loc_fc226ce4:\n"
"    ldr     r0, [sp, #0x28]\n"
"    movs    r5, #1\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x12\n"
"    beq     loc_fc226cf2\n"
"    cmp     r1, #0x13\n"
"    bne     loc_fc226d30\n"
"loc_fc226cf2:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc2254a0\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc227b2c\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x1c]\n"
"    b       loc_fc226f52\n"
"loc_fc226d30:\n"
"    cmp     r1, #0x14\n"
"    beq     loc_fc226d40\n"
"    cmp     r1, #0x15\n"
"    beq     loc_fc226d40\n"
"    cmp     r1, #0x16\n"
"    beq     loc_fc226d40\n"
"    cmp     r1, #0x17\n"
"    bne     loc_fc226db2\n"
"loc_fc226d40:\n"
"    add     r3, sp, #0xc\n"
"    mov     r2, sp\n"
"    add     r1, sp, #0x1c\n"
"    bl      sub_fc22569a\n"
"    cmp     r0, #1\n"
"    mov     r4, r0\n"
"    beq     loc_fc226d54\n"
"    cmp     r4, #5\n"
"    bne     loc_fc226d6a\n"
"loc_fc226d54:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc226d90\n"
"loc_fc226d6a:\n"
"    cmp     r4, #2\n"
"    beq     loc_fc226d72\n"
"    cmp     r4, #6\n"
"    bne     loc_fc226d9c\n"
"loc_fc226d72:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc226928\n"
"loc_fc226d90:\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc226b16\n"
"    b       loc_fc226f58\n"
"loc_fc226d9c:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc226f58\n"
"loc_fc226db2:\n"
"    cmp     r1, #0x24\n"
"    beq     loc_fc226dba\n"
"    cmp     r1, #0x25\n"
"    bne     loc_fc226dec\n"
"loc_fc226dba:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc224606\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2249e6\n"
"    b       loc_fc226f58\n"
"loc_fc226dec:\n"
"    adds    r1, r0, #4\n"
"    mov     r4, r8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x28\n"
"    bhs     loc_fc226e2a\n"
"    tbb     [pc, r1]\n" // (jumptable r1 40 elements)
"branchtable_fc226dfe:\n"
"    .byte((loc_fc226e26 - branchtable_fc226dfe) / 2)\n" // (case 0)
"    .byte((loc_fc226e26 - branchtable_fc226dfe) / 2)\n" // (case 1)
"    .byte((loc_fc226e2c - branchtable_fc226dfe) / 2)\n" // (case 2)
"    .byte((loc_fc226e32 - branchtable_fc226dfe) / 2)\n" // (case 3)
"    .byte((loc_fc226e32 - branchtable_fc226dfe) / 2)\n" // (case 4)
"    .byte((loc_fc226e32 - branchtable_fc226dfe) / 2)\n" // (case 5)
"    .byte((loc_fc226e26 - branchtable_fc226dfe) / 2)\n" // (case 6)
"    .byte((loc_fc226e2c - branchtable_fc226dfe) / 2)\n" // (case 7)
"    .byte((loc_fc226e32 - branchtable_fc226dfe) / 2)\n" // (case 8)
"    .byte((loc_fc226e32 - branchtable_fc226dfe) / 2)\n" // (case 9)
"    .byte((loc_fc226e44 - branchtable_fc226dfe) / 2)\n" // (case 10)
"    .byte((loc_fc226e44 - branchtable_fc226dfe) / 2)\n" // (case 11)
"    .byte((loc_fc226f36 - branchtable_fc226dfe) / 2)\n" // (case 12)
"    .byte((loc_fc226f3c - branchtable_fc226dfe) / 2)\n" // (case 13)
"    .byte((loc_fc226f3c - branchtable_fc226dfe) / 2)\n" // (case 14)
"    .byte((loc_fc226f3c - branchtable_fc226dfe) / 2)\n" // (case 15)
"    .byte((loc_fc226f3c - branchtable_fc226dfe) / 2)\n" // (case 16)
"    .byte((loc_fc226f42 - branchtable_fc226dfe) / 2)\n" // (case 17)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 18)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 19)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 20)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 21)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 22)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 23)
"    .byte((loc_fc226e38 - branchtable_fc226dfe) / 2)\n" // (case 24)
"    .byte((loc_fc226e3e - branchtable_fc226dfe) / 2)\n" // (case 25)
"    .byte((loc_fc226e3e - branchtable_fc226dfe) / 2)\n" // (case 26)
"    .byte((loc_fc226e3e - branchtable_fc226dfe) / 2)\n" // (case 27)
"    .byte((loc_fc226e4c - branchtable_fc226dfe) / 2)\n" // (case 28)
"    .byte((loc_fc226e4c - branchtable_fc226dfe) / 2)\n" // (case 29)
"    .byte((loc_fc226e52 - branchtable_fc226dfe) / 2)\n" // (case 30)
"    .byte((loc_fc226e7c - branchtable_fc226dfe) / 2)\n" // (case 31)

"    .byte((loc_fc226ed0 - branchtable_fc226dfe) / 2)\n" // (case 32)*

"    .byte((loc_fc226efa - branchtable_fc226dfe) / 2)\n" // (case 33)
"    .byte((loc_fc226f24 - branchtable_fc226dfe) / 2)\n" // (case 34)
"    .byte((loc_fc226f24 - branchtable_fc226dfe) / 2)\n" // (case 35)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 36)
"    .byte((loc_fc226f46 - branchtable_fc226dfe) / 2)\n" // (case 37)
"    .byte((loc_fc226f2a - branchtable_fc226dfe) / 2)\n" // (case 38)
"    .byte((loc_fc226f30 - branchtable_fc226dfe) / 2)\n" // (case 39)
".align 1\n"
"loc_fc226e26:\n"
"    bl      sub_fc2230a4\n"
"loc_fc226e2a:\n"
"    b       loc_fc226f46\n"
"loc_fc226e2c:\n"
"    bl      sub_fc223314\n"
"    b       loc_fc226f46\n"
"loc_fc226e32:\n"
"    bl      sub_fc223530\n"
"    b       loc_fc226f46\n"
"loc_fc226e38:\n"
"    bl      sub_fc2237b6\n"
"    b       loc_fc226f46\n"
"loc_fc226e3e:\n"
"    bl      sub_fc223988\n"
"    b       loc_fc226f46\n"
"loc_fc226e44:\n"
"    bl      sub_fc223dc3_my\n"      // ---->>
"    movs    r5, #0\n"
"    b       loc_fc226f46\n"
"loc_fc226e4c:\n"
"    bl      sub_fc223ebc\n"
"    b       loc_fc226f46\n"
"loc_fc226e52:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc22434c\n"
"    b       loc_fc226f46\n"
"loc_fc226e7c:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2279c0\n"
"    b       loc_fc226f46\n"

/*  literal block removed here */

"loc_fc226ed0:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r0, #6]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc227a46\n"
"    b       loc_fc226f46\n"
"loc_fc226efa:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc227abc\n"
"    b       loc_fc226f46\n"
"loc_fc226f24:\n"
"    bl      sub_fc224406\n"
"    b       loc_fc226f46\n"
"loc_fc226f2a:\n"
"    bl      sub_fc224aae\n"
"    b       loc_fc226f46\n"
"loc_fc226f30:\n"
"    bl      sub_fc224e94\n"
"    b       loc_fc226f46\n"
"loc_fc226f36:\n"
"    bl      sub_fc225076\n"
"    b       loc_fc226f46\n"
"loc_fc226f3c:\n"
"    bl      sub_fc2251ee\n"
"    b       loc_fc226f46\n"
"loc_fc226f42:\n"
"    bl      sub_fc22530a\n"
"loc_fc226f46:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x14]\n"
"    ldr     r1, [r0]\n"
"loc_fc226f52:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc226f58:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x10\n"
"    beq     loc_fc226f7c\n"
"    bgt     loc_fc226f70\n"
"    cmp     r0, #1\n"
"    beq     loc_fc226f7c\n"
"    cmp     r0, #4\n"
"    beq     loc_fc226f7c\n"
"    cmp     r0, #0xe\n"
"    bne     loc_fc226fae\n"
"    b       loc_fc226f7c\n"
"loc_fc226f70:\n"
"    cmp     r0, #0x13\n"
"    beq     loc_fc226f7c\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc226f7c\n"
"    cmp     r0, #0x1a\n"
"    bne     loc_fc226fae\n"
"loc_fc226f7c:\n"
"    ldrsh.w r0, [r6]\n"
"    mov     r2, sl\n"
"    cmp     r0, sl\n"
"    beq     loc_fc226f8e\n"
"    ldrsh.w r1, [r6, #8]\n"
"    cmp     r1, r2\n"
"    bne     loc_fc226fa6\n"
"loc_fc226f8e:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc2cffea\n"
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"    strh.w  r0, [sp, #0x24]\n"
"    b       loc_fc226fae\n"
"loc_fc226fa6:\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x24]\n"
"loc_fc226fae:\n"
"    cmp     r5, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc226fe6\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r4, r0, r1, lsl #2\n"
"    ldr     r0, =0x0005c6fc\n"
"    subs    r4, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc2a16c8\n"
"    ldr     r0, =0x0005c6fc\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc2a16c8\n"
"    ldr     r0, =0x0005c6fc\n"
"    movs    r2, #0xc\n"
"    mov     r1, r4\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc2a16c8\n"
"    b       loc_fc227030\n"
"loc_fc226fe6:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc227010\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc222eea\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc22702c\n"
"loc_fc227010:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc222eea\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc22702c:\n"
"    bl      sub_fc223028\n"
"loc_fc227030:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc227944\n"
"    b       loc_fc226bbe\n"

".ltorg\n"
 );
}

// G16 1.01c  0xfc223dc3 60
void __attribute__((naked,noinline)) sub_fc223dc3_my() {
asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000d8d0\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x1c]\n"
"    blx     sub_fc2a15c8\n" // j_ClearEventFlag
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc222c28\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc222d7a\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc222dbe\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc222e02\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc222e46\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x0005c714\n"
"    cmp     r0, #0xb\n"
"    bne     loc_fc223e16\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc223e2e\n"
"loc_fc223e16:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc223e2e\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc222bbf\n"
"    bl      sub_fc14dd72\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x28]\n"
"    b       loc_fc223e34\n"
"loc_fc223e2e:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc223e34:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc223e46\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc222c13\n"
"    bl      sub_fc227996\n"
"    b       loc_fc223e4a\n"
"loc_fc223e46:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc223e4a:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc2e0f56_my\n"         // ----->>
"    ldr     pc,=0xfc223e55\n"          // continue in ROM thumb

".ltorg\n"
 );
}

// G16 1.01c  0xfc2e0f57 35
void __attribute__((naked,noinline)) sub_fc2e0f56_my() {
    asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000d4d0\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc2e0f6e\n"
"    movs    r0, #0\n"
"    movw    r2, #0x154\n"
"    ldr     r1, =0xfc2e108c\n" //  *"Shutter.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc2e0f6e:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc2e0f78\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc2e0f78:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc2e0f8a\n"
"    movs    r0, #0\n"
"    movw    r2, #0x15a\n"
"    ldr     r1, =0xfc2e108c\n" //  *"Shutter.c"
"    blx     sub_fc2a16b0\n" // j_DebugAssert
"loc_fc2e0f8a:\n"
"    mov     r0, r4\n"
"    bl      apex2us\n"       // ----->>
//"    bl      _apex2us\n"
"    mov     r4, r0\n"
"    bl      sub_fc1a9032\n"
"    mov     r0, r4\n"
"    bl      sub_fc1ad042\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2e0fb0\n"
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    movw    r2, #0x15f\n"
"    ldr     r1, =0xfc2e108c\n" //  *"Shutter.c"
//"    b.w     loc_fc2a0ce0\n" // -> DebugAssert
"    ldr     pc,=0xfc2a0ce1\n" // -> DebugAssert  << replaced with thumb code
"loc_fc2e0fb0:\n"
"    pop     {r4, r5, r6, pc}\n"

".ltorg\n"
 );
}

