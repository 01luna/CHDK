#include "lolevel.h"
#include "platform.h"
#include "core.h"

// debug
//#define CAPTSEQ_DEBUG_LOG 1

extern int active_raw_buffer;
// debug
extern void _LogCameraEvent(int id,const char *fmt,...);

#define USE_STUBS_NRFLAG 1
#define NR_AUTO (-1) // default value if NRTBL.SetDarkSubType not used is -1 (0 probalby works the same), set to enable auto

#ifdef CAPTSEQ_DEBUG_LOG
extern char *hook_raw_image_addr(void);

void log_capt_seq(int m)
{
    _LogCameraEvent(0x60,"cs m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq2(int m)
{
    _LogCameraEvent(0x60,"cs end m:%d arb:%d rb:0x%08x i:%04d",
                    m,
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
void log_capt_seq_override(void)
{
    _LogCameraEvent(0x60,"cs override arb:%d rb:0x%08x i:%04d",
                    active_raw_buffer,
                    hook_raw_image_addr(),
                    get_exposure_counter());
}
#endif

#include "../../../generic/capt_seq.c"
//-s=task_CaptSeq -c=173 -f=chdk
// task_CaptSeq 0xFC0BD906
void __attribute__((naked,noinline)) capt_seq_task() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r4, =0x00059f20\n"
"    movs    r6, #0\n"
"    ldr     r5, =0x0000b378\n"
"loc_fc0bd90e:\n"
"    movs    r2, #0\n"
"    mov     r1, sp\n"
"    ldr     r0, [r5, #8]\n"
"    blx     sub_fc302304\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0bd930\n"
"    movw    r2, #0x455\n"
"    ldr     r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc302464\n"
"    blx     sub_fc30231c\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
"loc_fc0bd930:\n"
"    ldr     r0, [sp]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc0bd948\n"
"    cmp     r0, #0x28\n"
"    beq     loc_fc0bd948\n"
"    cmp     r0, #0x1c\n"
"    beq     loc_fc0bd948\n"
"    cmp     r0, #0x20\n"
"    beq     loc_fc0bd948\n"
"    bl      sub_fc18b49a\n"
"loc_fc0bd948:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug message
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2f\n"
"    bhs     loc_fc0bda30\n"
"    tbb     [pc, r1]\n" // (jumptable r1 47 elements)
"branchtable_fc0bd954:\n"
"    .byte((loc_fc0bd984 - branchtable_fc0bd954) / 2)\n" // (case 0)
"    .byte((loc_fc0bd99a - branchtable_fc0bd954) / 2)\n" // (case 1)
"    .byte((loc_fc0bd9a2 - branchtable_fc0bd954) / 2)\n" // (case 2)
"    .byte((loc_fc0bd9b0 - branchtable_fc0bd954) / 2)\n" // (case 3)
"    .byte((loc_fc0bd9aa - branchtable_fc0bd954) / 2)\n" // (case 4)
"    .byte((loc_fc0bd9ba - branchtable_fc0bd954) / 2)\n" // (case 5)
"    .byte((loc_fc0bd9c0 - branchtable_fc0bd954) / 2)\n" // (case 6)
"    .byte((loc_fc0bda0c - branchtable_fc0bd954) / 2)\n" // (case 7)
"    .byte((loc_fc0bd9d0 - branchtable_fc0bd954) / 2)\n" // (case 8)
"    .byte((loc_fc0bd9d8 - branchtable_fc0bd954) / 2)\n" // (case 9)
"    .byte((loc_fc0bd9de - branchtable_fc0bd954) / 2)\n" // (case 10)
"    .byte((loc_fc0bd9f4 - branchtable_fc0bd954) / 2)\n" // (case 11)
"    .byte((loc_fc0bd9fa - branchtable_fc0bd954) / 2)\n" // (case 12)
"    .byte((loc_fc0bda00 - branchtable_fc0bd954) / 2)\n" // (case 13)
"    .byte((loc_fc0bda06 - branchtable_fc0bd954) / 2)\n" // (case 14)
"    .byte((loc_fc0bda14 - branchtable_fc0bd954) / 2)\n" // (case 15)
"    .byte((loc_fc0bda1a - branchtable_fc0bd954) / 2)\n" // (case 16)
"    .byte((loc_fc0bda20 - branchtable_fc0bd954) / 2)\n" // (case 17)
"    .byte((loc_fc0bda26 - branchtable_fc0bd954) / 2)\n" // (case 18)
"    .byte((loc_fc0bda2c - branchtable_fc0bd954) / 2)\n" // (case 19)
"    .byte((loc_fc0bda32 - branchtable_fc0bd954) / 2)\n" // (case 20)
"    .byte((loc_fc0bda38 - branchtable_fc0bd954) / 2)\n" // (case 21)
"    .byte((loc_fc0bda3e - branchtable_fc0bd954) / 2)\n" // (case 22)
"    .byte((loc_fc0bda44 - branchtable_fc0bd954) / 2)\n" // (case 23)
"    .byte((loc_fc0bda4a - branchtable_fc0bd954) / 2)\n" // (case 24)
"    .byte((loc_fc0bda50 - branchtable_fc0bd954) / 2)\n" // (case 25)
"    .byte((loc_fc0bda58 - branchtable_fc0bd954) / 2)\n" // (case 26)
"    .byte((loc_fc0bda5e - branchtable_fc0bd954) / 2)\n" // (case 27)
"    .byte((loc_fc0bda62 - branchtable_fc0bd954) / 2)\n" // (case 28)
"    .byte((loc_fc0bda6a - branchtable_fc0bd954) / 2)\n" // (case 29)
"    .byte((loc_fc0bda70 - branchtable_fc0bd954) / 2)\n" // (case 30)
"    .byte((loc_fc0bda9a - branchtable_fc0bd954) / 2)\n" // (case 31)
"    .byte((loc_fc0bdaa0 - branchtable_fc0bd954) / 2)\n" // (case 32)
"    .byte((loc_fc0bdaa6 - branchtable_fc0bd954) / 2)\n" // (case 33)
"    .byte((loc_fc0bdaac - branchtable_fc0bd954) / 2)\n" // (case 34)
"    .byte((loc_fc0bdab2 - branchtable_fc0bd954) / 2)\n" // (case 35)
"    .byte((loc_fc0bdab8 - branchtable_fc0bd954) / 2)\n" // (case 36)
"    .byte((loc_fc0bdac0 - branchtable_fc0bd954) / 2)\n" // (case 37)
"    .byte((loc_fc0bdac6 - branchtable_fc0bd954) / 2)\n" // (case 38)
"    .byte((loc_fc0bdaea - branchtable_fc0bd954) / 2)\n" // (case 39)
"    .byte((loc_fc0bdaf0 - branchtable_fc0bd954) / 2)\n" // (case 40)
"    .byte((loc_fc0bdb28 - branchtable_fc0bd954) / 2)\n" // (case 41)
"    .byte((loc_fc0bdafc - branchtable_fc0bd954) / 2)\n" // (case 42)
"    .byte((loc_fc0bdb02 - branchtable_fc0bd954) / 2)\n" // (case 43)
"    .byte((loc_fc0bdb08 - branchtable_fc0bd954) / 2)\n" // (case 44)
"    .byte((loc_fc0bdb0e - branchtable_fc0bd954) / 2)\n" // (case 45)
"    .byte((loc_fc0bdb14 - branchtable_fc0bd954) / 2)\n" // (case 46)
".align 1\n"
"loc_fc0bd984:\n" // case 0: preshoot, quick press shoot
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d47f2\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_capt_seq_override\n"
#endif
"bl shooting_expo_param_override\n" // +
"    bl      sub_fc0d36ac\n"
"    ldr     r0, [r4, #0x28]\n"
"    cmp     r0, #0\n"
"    beq     loc_fc0bd998\n"
"    bl      sub_fc0daf9e_my\n" // -> nr?, remote hook, raw hook (quick, no half press)
"loc_fc0bd998:\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd99a:\n" // case 1: (normal shoot)
"    ldr     r0, [r0, #0x10]\n"
"    bl      sub_fc0dae40_my\n" // ->  nr?, remote hook, raw hook
"    b       loc_fc0bdb28\n"
"loc_fc0bd9a2:\n"
"    movs    r0, #1\n"
"    bl      sub_fc0d4adc\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9aa:\n"
"    bl      sub_fc0d4534\n"
"    b       loc_fc0bd9b6\n"
"loc_fc0bd9b0:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d47da\n"
"loc_fc0bd9b6:\n"
"    str     r6, [r4, #0x28]\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9ba:\n"
"    bl      sub_fc0d47e0\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9c0:\n"
"    bl      sub_fc0d4a7c\n"
"    bl      sub_fc0d36ac\n"
"    movs    r0, #0\n"
"    bl      sub_fc0a9748\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9d0:\n"
"    ldr     r0, [r4, #0x54]\n"
"    bl      sub_fc0f8f44\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9d8:\n"
"    bl      sub_fc0f91d0\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9de:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0f921c\n"
"    b       loc_fc0bdb28\n"
".ltorg\n"
// "    movs    r0, r0\n"
// "    ldr     r1, =0xfc0bda7c\n"
// "    movs    r5, r0\n"
// "    ldr     r7, [sp, #0x80]\n"
// "    movs    r5, r0\n"
// "    cbz     r0, loc_fc0bda52\n"
// "    movs    r0, r0\n"
"loc_fc0bd9f4:\n"
"    bl      sub_fc0f93ee\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bd9fa:\n"
"    bl      sub_fc0f9438\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda00:\n"
"    bl      sub_fc0f97ee\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda06:\n"
"    bl      sub_fc0f9884\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda0c:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0d47da\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda14:\n"
"    bl      sub_fc0da684\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda1a:\n"
"    bl      sub_fc0da886\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda20:\n"
"    bl      sub_fc0da930\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda26:\n"
"    bl      sub_fc0da9e8\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda2c:\n"
"    movs    r0, #0\n"
"    b       loc_fc0bda52\n"
"loc_fc0bda30:\n"
"    b       loc_fc0bdb1a\n"
"loc_fc0bda32:\n"
"    bl      sub_fc0dab8c\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda38:\n"
"    bl      sub_fc0dabec\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda3e:\n"
"    bl      sub_fc0dabf0\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda44:\n"
"    bl      sub_fc0dac00\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda4a:\n"
"    bl      sub_fc0dac8c\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda50:\n"
"    movs    r0, #1\n"
"loc_fc0bda52:\n"
"    bl      sub_fc0daa6c\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda58:\n"
"    bl      sub_fc0d4bd4\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda5e:\n"
"    movs    r0, #0\n"
"    b       loc_fc0bda64\n"
"loc_fc0bda62:\n"
"    ldr     r0, [r0, #0xc]\n"
"loc_fc0bda64:\n"
"    bl      sub_fc0d4c08\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda6a:\n"
"    bl      sub_fc110728\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda70:\n"
"    ldr     r1, =0x00059f82\n"
"    movs    r2, #2\n"
"    movs    r0, #0x75\n"
"    bl      sub_fc373838\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0bda8c\n"
"    movw    r2, #0x51a\n"
"    ldr     r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc302464\n"
"loc_fc0bda8c:\n"
"    ldrh.w  r0, [r4, #0x62]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc0bdb28\n"
"    bl      sub_fc110722\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bda9a:\n"
"    bl      sub_fc1107ac\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdaa0:\n"
"    bl      sub_fc1108c8\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdaa6:\n"
"    bl      sub_fc0d3eb8\n" //  return
"    b       loc_fc0bdb28\n"
"loc_fc0bdaac:\n"
"    bl      sub_fc0d4f4a\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdab2:\n"
"    bl      sub_fc0d5004\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdab8:\n"
"    ldr     r0, [r0, #0xc]\n"
"    bl      sub_fc0dad6c\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdac0:\n"
"    bl      sub_fc0dadbe\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdac6:\n"
"    bl      sub_fc0d58f8\n"
"    bl      sub_fc0d66b2\n"
"    ldrh.w  r0, [r4, #0x1a4]\n"
"    cmp     r0, #4\n"
"    beq     loc_fc0bdae0\n"
"    ldrh    r0, [r4]\n"
"    sub.w   r1, r0, #0x8200\n"
"    subs    r1, #0x36\n"
"    bne     loc_fc0bdb28\n"
"loc_fc0bdae0:\n"
"    bl      sub_fc0d5004\n"
"    bl      sub_fc0d5336\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdaea:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x11\n"
"    b       loc_fc0bdaf4\n"
"loc_fc0bdaf0:\n"
"    movs    r2, #0\n"
"    movs    r1, #0x10\n"
"loc_fc0bdaf4:\n"
"    movs    r0, #0\n"
"    bl      sub_fc0d4046\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdafc:\n"
"    bl      sub_fc111014\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdb02:\n"
"    bl      sub_fc111090\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdb08:\n"
"    bl      sub_fc1110d0\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdb0e:\n"
"    bl      sub_fc110f58\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdb14:\n"
"    bl      sub_fc110f5a\n"
"    b       loc_fc0bdb28\n"
"loc_fc0bdb1a:\n"
"    movw    r2, #0x588\n"
"    ldr     r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc302464\n"
"loc_fc0bdb28:\n"
#ifdef CAPTSEQ_DEBUG_LOG
// debug after message handled
"ldr     r0, [sp]\n"
"ldr     r0, [r0]\n"
"bl log_capt_seq2\n"
#endif
"    ldr     r0, [sp]\n"
"    ldr     r1, [r0, #4]\n"
"    ldr     r0, [r5, #4]\n"
"    blx     sub_fc302354\n"
"    ldr     r7, [sp]\n"
"    ldr     r0, [r7, #8]\n"
"    cbnz    r0, loc_fc0bdb46\n"
"    movw    r2, #0x12b\n"
"    ldr     r1, =0xfc0bd504\n" //  *"SsShootTask.c"
"    movs    r0, #0\n"
"    blx     sub_fc302464\n"
"loc_fc0bdb46:\n"
"    str     r6, [r7, #8]\n"
"    b       loc_fc0bd90e\n"
".ltorg\n"
    );
}

// -s=0xfc0daf9e -c=56 -f=chdk
void __attribute__((naked,noinline)) sub_fc0daf9e_my() {
    asm volatile (
"    push    {r4, lr}\n"
"    bl      sub_fc0f8b2c\n"
"    mov     r4, r0\n"
"    bl      sub_fc0d47e6\n"
"    bl      sub_fc143c98\n"
"    mov     r1, r4\n"
"    bl      sub_fc143ce6\n"
"    movs    r2, #4\n"
"    movw    r0, #0x116\n"
"    add.w   r1, r4, #0x34\n"
"    bl      sub_fc3736e6\n"
"    movs    r2, #4\n"
"    movs    r0, #0x30\n"
"    add.w   r1, r4, #0x38\n"
"    bl      sub_fc3736e6\n"
"    movs    r2, #4\n"
"    movs    r0, #0x44\n"
"    add.w   r1, r4, #8\n"
"    bl      sub_fc3736e6\n"
"    bl      sub_fc18afda\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc302404\n"
"    mov     r0, r4\n"
"    bl      sub_fc18acac\n"
"    bl      sub_fc256ca2\n"
"    bl      sub_fc0ab14a\n"
"    mov     r0, r4\n"
"    bl      sub_fc11d80e_my\n"		//->
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0db004\n" //  return
"    ldr     r1, =0x000132fc\n"
"    movs    r0, #1\n"
"    str     r0, [r1]\n"
"loc_fc0db004:\n"
"    pop     {r4, pc}\n"
".ltorg\n"
    );
}

//-s=0xfc0dae40 -c=211 -f=chdk
void __attribute__((naked,noinline)) sub_fc0dae40_my() {
    asm volatile (
"    push    {r3, r4, r5, r6, r7, lr}\n"
"    ldr     r6, =0x00059f20\n"
"    mov     r5, r0\n"
"    movs    r4, #0\n"
"    ldr     r0, [r6, #0x28]\n"
"    cbz     r0, loc_fc0dae68\n"
"    ldr     r0, =0x000132fc\n"
"    ldr     r0, [r0]\n"
"    cbz     r0, loc_fc0dae54\n"
"    movs    r4, #0x1d\n"
"loc_fc0dae54:\n"
"    mov     r2, r5\n"
"    movs    r1, #2\n"
"    mov     r0, r4\n"
"    bl      sub_fc0d4046\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b326\n"
"    b       loc_fc0daf94\n"
"loc_fc0dae68:\n"
"    bl      sub_fc143c98\n"
"    mov     r1, r5\n"
"    bl      sub_fc143ce6\n"
"    movs    r2, #4\n"
"    movw    r0, #0x116\n"
"    add.w   r1, r5, #0x34\n"
"    bl      sub_fc3736e6\n"
"    movs    r2, #4\n"
"    movs    r0, #0x30\n"
"    add.w   r1, r5, #0x38\n"
"    bl      sub_fc3736e6\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbnz    r0, loc_fc0daea2\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc0daea8\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0daeb8\n"
"    b       loc_fc0daea8\n"
"loc_fc0daea2:\n"
"    ldr     r0, [r5, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc0daeb8\n"
"loc_fc0daea8:\n"
"    movs    r0, #0xc\n"
"    bl      sub_fc325ca4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0daeb8\n"
"    bl      sub_fc0d3eae\n"
"    movs    r4, #1\n"
"loc_fc0daeb8:\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc0daf82\n"
"    ldr.w   r0, [r6, #0xec]\n"
"    cbz     r0, loc_fc0daedc\n"
"    ldrh.w  r0, [r6, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc0daed0\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0daf22\n"
"loc_fc0daed0:\n"
"    ldr.w   r0, [r6, #0x10c]\n"
"    cbz     r0, loc_fc0daedc\n"
"    ldr     r0, [r5, #0xc]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc0daf22\n"
"loc_fc0daedc:\n"
"    bl      sub_fc111174\n"
"    cbnz    r0, loc_fc0daf22\n"
"    movs    r2, #2\n"
"    mov     r1, sp\n"
"    movw    r0, #0x110\n"
"    bl      sub_fc373838\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc0daefc\n"
"    movs    r2, #0xcb\n"
"    movs    r0, #0\n"
"    ldr     r1, =0xfc0db020\n" //  *"SsCaptureCtrl.c"
"    blx     sub_fc302464\n"
"loc_fc0daefc:\n"
"    ldrsh.w r0, [sp]\n"
"    bl      sub_fc130d60\n"
"    bl      sub_fc130c28\n"
"    cmp     r0, #1\n"
"    bls     loc_fc0daf14\n"
"    movs    r0, #0\n"
"    bl      sub_fc130cf0\n"
"    b       loc_fc0daf22\n"
"loc_fc0daf14:\n"
"    bl      sub_fc0d3eae\n"
"    bl      sub_fc325ce4\n"
"    movs    r4, #1\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc0daf82\n"
"loc_fc0daf22:\n"
"    mov     r0, r5\n"
"    bl      sub_fc11092e\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc0daf82\n"
"    bl      sub_fc18afda\n"
"    mvn     r1, #0x1000\n"
"    blx     sub_fc302404\n"
"    bl      sub_fc256ca2\n"
"    bl      sub_fc0ab14a\n"
"    mov     r0, r5\n"
"    bl      sub_fc11d540\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc0daf82\n"
"    bl      sub_fc0d47e6\n"
"    mov     r0, r5\n"
"    bl      sub_fc18acac\n"
"    movs    r0, #2\n"
"    bl      sub_fc0d61ba\n"
"    ldr.w   r0, [r6, #0xb0]\n"
"    cbz     r0, loc_fc0daf6c\n"
"    mov     r0, r5\n"
"    bl      sub_fc11ddf0\n"
"    b       loc_fc0daf94\n"
"loc_fc0daf6c:\n"
"    ldr.w   r0, [r6, #0xb4]\n"
"    cmp     r0, #0\n"
"    mov     r0, r5\n"
"    beq     loc_fc0daf7c\n"
"    bl      sub_fc11da6e\n"
"    b       loc_fc0daf94\n"
"loc_fc0daf7c:\n"
"    bl      sub_fc11d80e_my\n"  // SsStandardCaptureSeq.c hook
"    b       loc_fc0daf94\n"
"loc_fc0daf82:\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc0d4046\n"
"    mov     r1, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b45c\n"
"loc_fc0daf94:\n"
"    bl      sub_fc0f942a\n"
"    movs    r0, #0\n"
"    str     r0, [r6, #0x28]\n"
"    pop     {r3, r4, r5, r6, r7, pc}\n"
".ltorg\n"
    );
}

// -s=0xfc11d80e -f=chdk
void __attribute__((naked,noinline)) sub_fc11d80e_my() {
    asm volatile (
"    push.w  {r2, r3, r4, r5, r6, r7, r8, sb, sl, lr}\n"
"    ldr     r6, =0xfc11d7e9\n"
"    mov     r5, r0\n"
"    bl      sub_fc18ac42\n"
"    bl      sub_fc0db464\n"
"    ldr     r7, =0x00059f20\n"
"    ldr.w   r0, [r7, #0xa4]\n"
"    cbnz    r0, loc_fc11d83c\n"
"    ldrh.w  r0, [r7, #0x1a2]\n"
"    cmp     r0, #3\n"
"    beq     loc_fc11d834\n"
"    ldr     r0, [r5, #8]\n"
"    cmp     r0, #1\n"
"    bhi     loc_fc11d83c\n"
"loc_fc11d834:\n"
"    bl      sub_fc0d4bf6\n"
"    bl      sub_fc0db046\n"
"loc_fc11d83c:\n"
"    movs    r2, #4\n"
"    movw    r0, #0x137\n"
"    add     r1, sp, #4\n"
"    bl      sub_fc373838\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc11d858\n"
"    movs    r0, #0\n"
"    movw    r2, #0x156\n"
"    ldr     r1, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc302464\n"
"loc_fc11d858:\n"
"    BL      wait_until_remote_button_is_released\n" // + remote hook
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_remote_hook\n"
#endif
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc11d868\n"
"    ldr     r0, =0xfc11d7e9\n"
"    movs    r1, #0\n"
"    b       loc_fc11d86c\n"
"loc_fc11d868:\n"
"    ldr     r0, =0xfc18a9fd\n"
"    mov     r1, r5\n"
"loc_fc11d86c:\n"
"    bl      sub_fc155364\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc11d87a\n"
"    bl      sub_fc18ab58\n"
"loc_fc11d87a:\n"
"    movs    r0, #0\n"
"    bl      sub_fc0be0b0\n"
"    bl      sub_fc111222\n"
"    ldr.w   r8, =0xfc11d7e9\n"
"    mov     r4, r0\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc11d98c\n"
"bl capt_seq_hook_set_nr\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_nr_call\n"
#endif
"    mov     r0, r5\n"
"    bl      sub_fc18adaa\n"  // NR evaluation
"    mov     r0, r5\n"
"    bl      sub_fc11112c\n"
"    ldr     r1, =0x0003eea0\n"
"    movs    r2, #4\n"
"    movs    r0, #0x90\n"
"    bl      sub_fc373838\n" // GetPropertyCase
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc11d8b4\n"
"    movs    r0, #0\n"
"    movw    r2, #0x171\n"
"    ldr     r1, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc302464\n"
"loc_fc11d8b4:\n"
"    bl      sub_fc0be1e4\n"
"    bl      sub_fc18ae3c\n"
"    movs    r1, #0\n"
"    mov     r0, r5\n"
"    bl      sub_fc11d7ea\n"
"    mov     r6, r0\n"
"    ldr     r0, [sp, #4]\n"
"    ubfx    r0, r0, #8, #8\n"
"    cmp     r0, #6\n"
"    bne     loc_fc11d8d4\n"
"    ldr     r2, =0xfc18ab27\n"
"    b       loc_fc11d8d6\n"
"loc_fc11d8d4:\n"
"    ldr     r2, =0xfc18ab3d\n"
"loc_fc11d8d6:\n"
"    ldrh    r0, [r5, #0x18]\n"
"    ldr     r4, =0x0003eea0\n"
"    cbz     r0, loc_fc11d8e4\n"
"    cmp     r0, #1\n"
"    beq     loc_fc11d8fa\n"
"    cmp     r0, #4\n"
"    bne     loc_fc11d94a\n"
"loc_fc11d8e4:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     r0, r5\n"
"    ldr     r2, [r4]\n"
"    bl      sub_fc18a850\n"
"    mov     r4, r0\n"
"    bl      sub_fc2b73c2\n"
"    b       loc_fc11d958\n"
"loc_fc11d8fa:\n"
"    str     r6, [sp]\n"
"    mov     r3, r2\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     sb, r4\n"
"    ldr     r2, [r4]\n"
"    mov     r0, r5\n"
"    bl      sub_fc18a8b0\n"
"    movs    r2, #1\n"
"    mov     r4, r0\n"
"    movs    r1, #0\n"
"    movs    r0, #0x45\n"
"    bl      sub_fc0ab2ec\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc11d958\n"
"    ldr     r0, =0xfc11d7e9\n"
"    movs    r1, #0\n"
"    bl      sub_fc155364\n"
"    movs    r1, #1\n"
"    mov     r0, r5\n"
"    bl      sub_fc11d7ea\n"
"    mov     r6, r0\n"
"    ldr.w   r0, [sb]\n"
"    mov     r4, sb\n"
"    bl      sub_fc18abc0\n"
"    ldr     r1, [r5, #0x38]\n"
"    mov     r3, r6\n"
"    ldr     r2, [r4]\n"
"    mov     r0, r5\n"
"    bl      sub_fc18a91e\n"
"    mov     r4, r0\n"
"    bl      sub_fc18a7fa\n"
"    b       loc_fc11d958\n"
"loc_fc11d94a:\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1aa\n"
"    ldr     r1, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc302464\n"
"    movs    r4, #0x1d\n"
"loc_fc11d958:\n"
"    bl      sub_fc18ae40\n"
"    lsls    r0, r4, #0x1f\n"
"    bne     loc_fc11d9c2\n"
"    mov     r0, r5\n"
"    bl      sub_fc18ae56\n"
"    ldr.w   r0, [r7, #0x108]\n"
"    cbnz    r0, loc_fc11d98a\n"
"    mov     r0, r5\n"
"    bl      sub_fc11116e\n"
"    cbnz    r0, loc_fc11d98a\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b59a\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc11d98a\n"
"    movs    r0, #0\n"
"    movw    r2, #0x1d0\n"
"    ldr     r1, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc302464\n"
"loc_fc11d98a:\n"
"    b       loc_fc11d98e\n"
"loc_fc11d98c:\n"
"    b       loc_fc11d9c2\n"
"loc_fc11d98e:\n"
#ifdef CAPTSEQ_DEBUG_LOG
"bl log_rh\n"
#endif
"BL capt_seq_hook_raw_here\n" //----------------------------------- ???? ----------
"    mov     r0, r5\n"
"    bl      sub_fc18ae2c\n"
"    mov     r0, r5\n"
"    bl      sub_fc18ae00\n"
"    cmp     r6, r8\n"
"    beq     loc_fc11d9c2\n"
"    bl      sub_fc18afda\n"
"    movs    r1, #4\n"
"    movw    sb, #0x1dd\n"
"    ldr     r3, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    movw    r2, #0x3a98\n"
"    str.w   sb, [sp]\n"
"    bl      sub_fc325e5c\n"
"    cbz     r0, loc_fc11d9c2\n"
"    movs    r0, #0\n"
"    mov     r2, sb\n"
"    ldr     r1, =0xfc11da18\n" //  *"SsStandardCaptureSeq.c"
"    blx     sub_fc302464\n"
"loc_fc11d9c2:\n"
"    ldr.w   r0, [r7, #0x18c]\n"
"    cbz     r0, loc_fc11d9d2\n"
"    movs    r2, #1\n"
"    movs    r1, #0\n"
"    movs    r0, #0x46\n"
"    bl      sub_fc0ab2ec\n"
"loc_fc11d9d2:\n"
"    movs    r1, #2\n"
"    mov     r2, r5\n"
"    mov     r0, r4\n"
"    bl      sub_fc0d4046\n"
"    ldr     r0, [r7, #0x28]\n"
"    cmp     r0, #0\n"
"    mov     r0, r8\n"
"    beq     loc_fc11d9f8\n"
"    cmp     r6, r0\n"
"    beq     loc_fc11d9ec\n"
"    movs    r1, #1\n"
"loc_fc11d9ea:\n"
"    b       loc_fc11d9ee\n"
"loc_fc11d9ec:\n"
"    movs    r1, #0\n"
"loc_fc11d9ee:\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b2e4\n"
"    b       loc_fc11da0a\n"
"loc_fc11d9f8:\n"
"    cmp     r6, r0\n"
"    beq     loc_fc11da00\n"
"    movs    r1, #1\n"
"    b       loc_fc11da02\n"
"loc_fc11da00:\n"
"    movs    r1, #0\n"
"loc_fc11da02:\n"
"    mov     r2, r4\n"
"    mov     r0, r5\n"
"    bl      sub_fc18b29e\n"
"loc_fc11da0a:\n"
"    mov     r0, r4\n"
"    pop.w   {r2, r3, r4, r5, r6, r7, r8, sb, sl, pc}\n"
".ltorg\n"
    );
}	

#ifdef CAPTSEQ_DEBUG_LOG
void log_nr_call(void) {
    _LogCameraEvent(0x60,"nr hook %d",_nrflag);
}
void log_remote_hook(void) {
    _LogCameraEvent(0x60,"remote hook");
}
void log_rh(void) {
    _LogCameraEvent(0x60,"raw hook");
}
#endif
//exp_drv_task  -s=task_ExpDrv -c=428 -f=chdk

void __attribute__((naked,noinline)) exp_drv_task() {
    asm volatile (
// task_ExpDrv 0xFC2BC870
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x2c\n"
"    ldr.w   sb, =0x0000d2f8\n"
"    ldr.w   fp, =0xfffff400\n"
"    movs    r0, #0\n"
"    ldr     r6, =0x00066bd0\n"
"    add.w   r8, sp, #0x1c\n"
"    movw    sl, #0xbb8\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc2bc88c:\n"
"    ldr.w   r0, [sb, #0x24]\n"
"    movs    r2, #0\n"
"    add     r1, sp, #0x28\n"
"    mov     r4, sb\n"
"    blx     sub_fc302304\n"
"    ldr     r0, [sp, #0xc]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc2bc8c8\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x15\n"
"loc_fc2bc8a6:\n"
"    beq     loc_fc2bc984\n"
"    cmp     r0, #0x16\n"
"    beq     loc_fc2bc8a6\n"
"    cmp     r0, #0x17\n"
"    beq     loc_fc2bc8a6\n"
"    cmp     r0, #0x18\n"
"    beq     loc_fc2bc8a6\n"
"    cmp     r0, #0x19\n"
"    beq     loc_fc2bc8a6\n"
"    cmp     r0, #0x1a\n"
"    beq     loc_fc2bc8a6\n"
"    cmp     r0, #0x31\n"
"    beq     loc_fc2bc98a\n"
"    movs    r0, #0\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2bc5ae\n"
"loc_fc2bc8c8:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x39\n"
"    bne     loc_fc2bc8e6\n"
"    bl      sub_fc2bd910\n"
"    ldr.w   r0, [sb, #0x20]\n"
"    movs    r1, #1\n"
"    blx     sub_fc302354\n"
"    blx     sub_fc30231c\n"
"    add     sp, #0x2c\n"
"    b       loc_fc2bc300\n" //  return
"loc_fc2bc8e6:\n"
"    cmp     r1, #0x38\n"
"    bne     loc_fc2bc8f8\n"
"loc_fc2bc8ea:\n"
"    add.w   r0, r0, #0xac\n"
"    ldrd    r2, r1, [r0]\n"
"    mov     r0, r1\n"
"    blx     r2\n"
"    b       loc_fc2bcd6e\n"
"loc_fc2bc8f8:\n"
"    cmp     r1, #0x2f\n"
"    bne     loc_fc2bc92e\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x80\n"
"    blx     sub_fc302404\n"
"    ldr     r0, =0xfc2b8827\n"
"    movs    r1, #0x80\n"
"    bl      sub_fc318c76\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x80\n"
"    mov     r2, sl\n"
"    blx     sub_fc3022d4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2bc920\n"
"    movw    r2, #0x198a\n"
"    b       loc_fc2bc9f0\n"
"loc_fc2bc920:\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    b       loc_fc2bcd6e\n"
"loc_fc2bc92e:\n"
"    cmp     r1, #0x30\n"
"    bne     loc_fc2bc986\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2bc5ae\n"
"    movw    r5, #0x100\n"
"    ldr     r0, [r4, #0x20]\n"
"    mov     r1, r5\n"
"    blx     sub_fc302404\n"
"    ldr     r0, =0xfc2b8831\n"
"    mov     r1, r5\n"
"    bl      sub_fc318e20\n"
"    ldr     r0, [r4, #0x20]\n"
"    mov     r2, sl\n"
"    mov     r1, r5\n"
"    blx     sub_fc3022d4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2bc920\n"
"    movw    r2, #0x1994\n"
"    b       loc_fc2bc9f0\n"
// "    bhs     loc_fc2bc954\n"
// "    movs    r0, r0\n"
// "    ldrh    r4, [r1, #0x20]\n"
// "    stc2    p8, c8, [fp], #-0xec\n"
// "    stc2    p11, c6, [fp], #-0x340\n"
// "    movs    r6, r0\n"
// "    ldrh    r5, [r0, #2]\n"
// "    stc2    p4, c15, [fp], #-0\n"
// ffff
// "    ldrh    r5, [r3]\n"
// "    stc2    p8, c8, [fp], #-0x9c\n"
// "    stc2    p8, c8, [fp], #-0xc4\n"
// "    stc2    p0, c14, [fp], #-0xe4\n"
"loc_fc2bc984:\n"
"    b       loc_fc2bc9fa\n"
"loc_fc2bc986:\n"
"    cmp     r1, #0x31\n"
"    bne     loc_fc2bc994\n"
"loc_fc2bc98a:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0xc\n"
"    bl      sub_fc2bc5ae\n"
"    b       loc_fc2bc920\n"
"loc_fc2bc994:\n"
"    cmp     r1, #0x32\n"
"    bne     loc_fc2bc9ae\n"
"    bl      sub_fc2bc5f2\n"
"    ldr     r1, [sp, #0x28]\n"
"    add.w   r1, r1, #0xac\n"
"    ldrd    r1, r0, [r1]\n"
"    blx     r1\n"
"    bl      sub_fc20cffe\n"
"    b       loc_fc2bcd6e\n"
"loc_fc2bc9ae:\n"
"    cmp     r1, #0x33\n"
"    beq     loc_fc2bc8ea\n"
"    cmp     r1, #0x36\n"
"    bne     loc_fc2bc9c4\n"
"    bl      sub_fc36073c\n"
"    bl      sub_fc20d308\n"
"    bl      sub_fc20cffe\n"
"    b       loc_fc2bc920\n"
"loc_fc2bc9c4:\n"
"    cmp     r1, #0x37\n"
"    bne     loc_fc2bc9fa\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #4\n"
"    blx     sub_fc302404\n"
"    ldr     r1, =0xfc2b8845\n"
"    movs    r2, #4\n"
"    mov     r0, fp\n"
"    bl      sub_fc2bd962\n"
"    bl      sub_fc3604a0\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #4\n"
"    mov     r2, sl\n"
"    blx     sub_fc302454\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2bc920\n"
"    movw    r2, #0x1a77\n"
"loc_fc2bc9f0:\n"
"    ldr     r1, =0xfc2b8c0c\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    blx     sub_fc302464\n"
"    b       loc_fc2bc920\n"
"loc_fc2bc9fa:\n"
"    ldr     r0, [sp, #0x28]\n"
"    movs    r5, #1\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x13\n"
"    beq     loc_fc2bca08\n"
"    cmp     r1, #0x14\n"
"    bne     loc_fc2bca46\n"
"loc_fc2bca08:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r4, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    bl      sub_fc2baf26\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2bdb8c\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldr     r1, [r0]\n"
"    ldrd    r3, r2, [r0, #0x20]\n"
"    b       loc_fc2bcc90\n"
"loc_fc2bca46:\n"
"    cmp     r1, #0x15\n"
"    beq     loc_fc2bca5e\n"
"    cmp     r1, #0x16\n"
"    beq     loc_fc2bca5e\n"
"    cmp     r1, #0x17\n"
"    beq     loc_fc2bca5e\n"
"    cmp     r1, #0x18\n"
"    beq     loc_fc2bca5e\n"
"    cmp     r1, #0x19\n"
"    beq     loc_fc2bca5e\n"
"    cmp     r1, #0x1a\n"
"    bne     loc_fc2bcaca\n"
"loc_fc2bca5e:\n"
"    bl      sub_fc36073c\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r3, sp, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc2bb104\n"
"    cmp     r0, #1\n"
"    mov     r4, r0\n"
"    beq     loc_fc2bca78\n"
"    cmp     r4, #5\n"
"    bne     loc_fc2bca98\n"
"loc_fc2bca78:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2bc56c\n"
"loc_fc2bca96:\n"
"    b       loc_fc2bcc96\n"
"loc_fc2bca98:\n"
"    cmp     r4, #2\n"
"    beq     loc_fc2bcaa0\n"
"    cmp     r4, #6\n"
"    bne     loc_fc2bcab4\n"
"loc_fc2bcaa0:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add     r1, sp, #0x1c\n"
"    mov     r2, sp\n"
"    bl      sub_fc2bc304\n"
"    ldr     r2, [sp, #0xc]\n"
"    mov     r1, r4\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2bc56c\n"
"loc_fc2bcab4:\n"
"    ldr     r0, [sp, #0x28]\n"
"    mov     r2, r4\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r7, r3, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r7\n"
"    b       loc_fc2bcc96\n"
"loc_fc2bcaca:\n"
"    cmp     r1, #0x2b\n"
"    beq     loc_fc2bcad2\n"
"    cmp     r1, #0x2c\n"
"    bne     loc_fc2bcb40\n"
"loc_fc2bcad2:\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    mov     r7, r8\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    subs    r1, #8\n"
"    ldm     r1, {r1, r2, r3}\n"
"    stm     r7!, {r1, r2, r3}\n"
"    bl      sub_fc2ba2ca\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"    bl      sub_fc36073c\n"
"    bl      sub_fc20d308\n"
"    bl      sub_fc20cffe\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #2\n"
"    mov     r7, sl\n"
"    mov     r2, sl\n"
"    blx     sub_fc3022d4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2bcb24\n"
"    ldr     r1, =0xfc2b8c0c\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xeae\n"
"    blx     sub_fc302464\n"
"loc_fc2bcb24:\n"
"    ldr     r0, [r4, #0x20]\n"
"    movs    r1, #0x20\n"
"    mov     r2, r7\n"
"    blx     sub_fc3022d4\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc2bca96\n"
"    ldr     r1, =0xfc2b8c0c\n" //  **"ExpDrv.c"
"    movs    r0, #0\n"
"    movw    r2, #0xeb1\n"
"    blx     sub_fc302464\n"
"    b       loc_fc2bcc96\n"
"loc_fc2bcb40:\n"
"    adds    r1, r0, #4\n"
"    mov     r4, r8\n"
"    ldm     r1!, {r2, r3, r7}\n"
"    stm     r4!, {r2, r3, r7}\n"
"    ldr     r1, [r0]\n"
"    cmp     r1, #0x2f\n"
"    bhs     loc_fc2bcb86\n"
"    tbb     [pc, r1]\n" // (jumptable r1 47 elements)
"branchtable_fc2bcb52:\n"
"    .byte((loc_fc2bcb82 - branchtable_fc2bcb52) / 2)\n" // (case 0)
"    .byte((loc_fc2bcb82 - branchtable_fc2bcb52) / 2)\n" // (case 1)
"    .byte((loc_fc2bcb88 - branchtable_fc2bcb52) / 2)\n" // (case 2)
"    .byte((loc_fc2bcb8e - branchtable_fc2bcb52) / 2)\n" // (case 3)
"    .byte((loc_fc2bcb8e - branchtable_fc2bcb52) / 2)\n" // (case 4)
"    .byte((loc_fc2bcb8e - branchtable_fc2bcb52) / 2)\n" // (case 5)
"    .byte((loc_fc2bcb82 - branchtable_fc2bcb52) / 2)\n" // (case 6)
"    .byte((loc_fc2bcb88 - branchtable_fc2bcb52) / 2)\n" // (case 7)
"    .byte((loc_fc2bcb8e - branchtable_fc2bcb52) / 2)\n" // (case 8)
"    .byte((loc_fc2bcb8e - branchtable_fc2bcb52) / 2)\n" // (case 9)
"    .byte((loc_fc2bcba0 - branchtable_fc2bcb52) / 2)\n" // (case 10)
"    .byte((loc_fc2bcba0 - branchtable_fc2bcb52) / 2)\n" // (case 11)
"    .byte((loc_fc2bcba0 - branchtable_fc2bcb52) / 2)\n" // (case 12)
"    .byte((loc_fc2bcc74 - branchtable_fc2bcb52) / 2)\n" // (case 13)
"    .byte((loc_fc2bcc7a - branchtable_fc2bcb52) / 2)\n" // (case 14)
"    .byte((loc_fc2bcc7a - branchtable_fc2bcb52) / 2)\n" // (case 15)
"    .byte((loc_fc2bcc7a - branchtable_fc2bcb52) / 2)\n" // (case 16)
"    .byte((loc_fc2bcc7a - branchtable_fc2bcb52) / 2)\n" // (case 17)
"    .byte((loc_fc2bcc80 - branchtable_fc2bcb52) / 2)\n" // (case 18)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 19)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 20)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 21)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 22)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 23)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 24)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 25)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 26)
"    .byte((loc_fc2bcb94 - branchtable_fc2bcb52) / 2)\n" // (case 27)
"    .byte((loc_fc2bcb9a - branchtable_fc2bcb52) / 2)\n" // (case 28)
"    .byte((loc_fc2bcb9a - branchtable_fc2bcb52) / 2)\n" // (case 29)
"    .byte((loc_fc2bcb9a - branchtable_fc2bcb52) / 2)\n" // (case 30)
"    .byte((loc_fc2bcba8 - branchtable_fc2bcb52) / 2)\n" // (case 31)
"    .byte((loc_fc2bcba8 - branchtable_fc2bcb52) / 2)\n" // (case 32)
"    .byte((loc_fc2bcba8 - branchtable_fc2bcb52) / 2)\n" // (case 33)
"    .byte((loc_fc2bcba8 - branchtable_fc2bcb52) / 2)\n" // (case 34)
"    .byte((loc_fc2bcbae - branchtable_fc2bcb52) / 2)\n" // (case 35)
"    .byte((loc_fc2bcbd8 - branchtable_fc2bcb52) / 2)\n" // (case 36)
"    .byte((loc_fc2bcc02 - branchtable_fc2bcb52) / 2)\n" // (case 37)
"    .byte((loc_fc2bcc06 - branchtable_fc2bcb52) / 2)\n" // (case 38)
"    .byte((loc_fc2bcc0e - branchtable_fc2bcb52) / 2)\n" // (case 39)
"    .byte((loc_fc2bcc38 - branchtable_fc2bcb52) / 2)\n" // (case 40)
"    .byte((loc_fc2bcc62 - branchtable_fc2bcb52) / 2)\n" // (case 41)
"    .byte((loc_fc2bcc62 - branchtable_fc2bcb52) / 2)\n" // (case 42)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 43)
"    .byte((loc_fc2bcc84 - branchtable_fc2bcb52) / 2)\n" // (case 44)
"    .byte((loc_fc2bcc68 - branchtable_fc2bcb52) / 2)\n" // (case 45)
"    .byte((loc_fc2bcc6e - branchtable_fc2bcb52) / 2)\n" // (case 46)
".align 1\n"
"loc_fc2bcb82:\n"
"    bl      sub_fc2b8d50\n"
"loc_fc2bcb86:\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcb88:\n"
"    bl      sub_fc2b8fc8\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcb8e:\n"
"    bl      sub_fc2b91ec\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcb94:\n"
"    bl      sub_fc2b94a0\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcb9a:\n"
"    bl      sub_fc2b965c\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcba0:\n"
"    bl      sub_fc2b99c8_my\n" //		_______-----________
"    movs    r5, #0\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcba8:\n"
"    bl      sub_fc2b9acc\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcbae:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2b9fb8\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcbd8:\n"
"    ldrh    r1, [r0, #4]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2bd9da\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc02:\n"
"    movs    r1, #1\n"
"    b       loc_fc2bcc08\n"
"loc_fc2bcc06:\n"
"    movs    r1, #0\n"
"loc_fc2bcc08:\n"
"    bl      sub_fc2ba07a\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc0e:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r0, #6]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r6, #8]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2bdaaa\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc38:\n"
"    ldrh    r1, [r6]\n"
"    strh.w  r1, [sp, #0x1c]\n"
"    ldrh    r1, [r6, #2]\n"
"    strh.w  r1, [sp, #0x1e]\n"
"    ldrh    r1, [r6, #4]\n"
"    strh.w  r1, [sp, #0x20]\n"
"    ldrh    r1, [r6, #6]\n"
"    strh.w  r1, [sp, #0x22]\n"
"    ldrh    r1, [r0, #0xc]\n"
"    strh.w  r1, [sp, #0x24]\n"
"    ldrh    r1, [r6, #0xa]\n"
"    strh.w  r1, [sp, #0x26]\n"
"    bl      sub_fc2bdb1e\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc62:\n"
"    bl      sub_fc2ba0be\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc68:\n"
"    bl      sub_fc2ba67c\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc6e:\n"
"    bl      sub_fc2ba8c6\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc74:\n"
"    bl      sub_fc2baae2\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc7a:\n"
"    bl      sub_fc2bac40\n"
"    b       loc_fc2bcc84\n"
"loc_fc2bcc80:\n"
"    bl      sub_fc2bad64\n"
"loc_fc2bcc84:\n"
"    ldr     r0, [sp, #0x28]\n"
"    add.w   r0, r0, #0x94\n"
"    ldrd    r3, r2, [r0, #0x18]\n"
"    ldr     r1, [r0]\n"
"loc_fc2bcc90:\n"
"    sub.w   r0, r0, #0x90\n"
"    blx     r3\n"
"loc_fc2bcc96:\n"
"    ldr     r0, [sp, #0x28]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x11\n"
"    beq     loc_fc2bccba\n"
"    bgt     loc_fc2bccae\n"
"    cmp     r0, #1\n"
"    beq     loc_fc2bccba\n"
"    cmp     r0, #4\n"
"    beq     loc_fc2bccba\n"
"    cmp     r0, #0xf\n"
"    bne     loc_fc2bccec\n"
"    b       loc_fc2bccba\n"
"loc_fc2bccae:\n"
"    cmp     r0, #0x14\n"
"    beq     loc_fc2bccba\n"
"    cmp     r0, #0x1a\n"
"    beq     loc_fc2bccba\n"
"    cmp     r0, #0x1d\n"
"    bne     loc_fc2bccec\n"
"loc_fc2bccba:\n"
"    ldrsh.w r0, [r6]\n"
"    mov     r2, fp\n"
"    cmp     r0, fp\n"
"    beq     loc_fc2bcccc\n"
"    ldrsh.w r1, [r6, #8]\n"
"    cmp     r1, r2\n"
"    bne     loc_fc2bcce4\n"
"loc_fc2bcccc:\n"
"    add     r0, sp, #0x10\n"
"    bl      sub_fc36097a\n"
"    ldrh.w  r0, [sp, #0x10]\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    ldrh.w  r0, [sp, #0x18]\n"
"    strh.w  r0, [sp, #0x24]\n"
"    b       loc_fc2bccec\n"
"loc_fc2bcce4:\n"
"    strh.w  r0, [sp, #0x1c]\n"
"    strh.w  r1, [sp, #0x24]\n"
"loc_fc2bccec:\n"
"    cmp     r5, #1\n"
"    ldr     r0, [sp, #0x28]\n"
"    bne     loc_fc2bcd24\n"
"    movs    r2, #0xc\n"
"    ldr.w   r1, [r0, #0x94]\n"
"    add.w   r1, r1, r1, lsl #1\n"
"    add.w   r4, r0, r1, lsl #2\n"
"    ldr     r0, =0x00066bd0\n"
"    subs    r4, #8\n"
"    add     r1, sp, #0x1c\n"
"    blx     sub_fc30245c\n"
"    ldr     r0, =0x00066bd0\n"
"    movs    r2, #0xc\n"
"    add     r1, sp, #0x1c\n"
"    adds    r0, #0xc\n"
"    blx     sub_fc30245c\n"
"    ldr     r0, =0x00066bd0\n"
"    movs    r2, #0xc\n"
"    mov     r1, r4\n"
"    adds    r0, #0x18\n"
"    blx     sub_fc30245c\n"
"    b       loc_fc2bcd6e\n"
"loc_fc2bcd24:\n"
"    ldr     r0, [r0]\n"
"    mov.w   r3, #1\n"
"    cmp     r0, #0xc\n"
"    bne     loc_fc2bcd4e\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    strd    r2, r3, [sp]\n"
"    movs    r0, #0\n"
"    mov     r2, r3\n"
"    bl      sub_fc2b8b50\n"
"    movs    r3, #1\n"
"    movs    r2, #0\n"
"    mov     r1, r3\n"
"    movs    r0, #0\n"
"    strd    r2, r3, [sp]\n"
"    mov     r2, r3\n"
"    b       loc_fc2bcd6a\n"
"loc_fc2bcd4e:\n"
"    movs    r2, #1\n"
"    strd    r2, r3, [sp]\n"
"    mov     r3, r2\n"
"    mov     r1, r2\n"
"    mov     r0, r2\n"
"    bl      sub_fc2b8b50\n"
"    movs    r3, #1\n"
"    str     r3, [sp]\n"
"    mov     r2, r3\n"
"    mov     r1, r3\n"
"    mov     r0, r3\n"
"    str     r3, [sp, #4]\n"
"loc_fc2bcd6a:\n"
"    bl      sub_fc2b8c90\n"
"loc_fc2bcd6e:\n"
"    ldr     r0, [sp, #0x28]\n"
"    bl      sub_fc2bd910\n"
"    b       loc_fc2bc88c\n"

"loc_fc2bc300:\n"
"    pop.w  {r4, r5, r6, r7, r8, r9, r10, r11, pc}\n"
".ltorg\n"
    );
}

//sub_fc2b99c8: -s=0xfc2b99c8 -c=  -f=chdk
void __attribute__((naked,noinline)) sub_fc2b99c8_my() {
asm volatile (
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    ldr     r7, =0x0000d2f8\n"
"    movs    r1, #0x3e\n"
"    mov     r4, r0\n"
"    ldr     r0, [r7, #0x20]\n"
"    blx     sub_fc302404\n"
"    movs    r2, #0\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r3, #1\n"
"    mov     r1, r2\n"
"    bl      sub_fc2b888e\n"
"    mov     r6, r0\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc2b8a16\n"
"    ldrsh.w r0, [r4, #8]\n"
"    bl      sub_fc2b8a5a\n"
"    ldrsh.w r0, [r4, #0xa]\n"
"    bl      sub_fc2b8a9e\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r1, #0\n"
"    bl      sub_fc2b8ae2\n"
"    mov     r5, r0\n"
"    ldr     r0, [r4]\n"
"    ldr.w   r8, =0x00066be8\n"
"    cmp     r0, #0xc\n"
"    bne     loc_fc2b9a1c\n"
"    movs    r6, #0\n"
"    mov     r5, r6\n"
"    b       loc_fc2b9a34\n"
"loc_fc2b9a1c:\n"
"    cmp     r6, #1\n"
"    bne     loc_fc2b9a34\n"
"    ldrsh.w r0, [r4, #4]\n"
"    movs    r2, #2\n"
"    ldr     r1, =0xfc2b881d\n"
"    bl      sub_fc318c90\n"
"    strh    r0, [r4, #4]\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x2c]\n"
"    b       loc_fc2b9a3a\n"
"loc_fc2b9a34:\n"
"    ldrh.w  r0, [r8]\n"
"    strh    r0, [r4, #4]\n"
"loc_fc2b9a3a:\n"
"    cmp     r5, #1\n"
"    bne     loc_fc2b9a4c\n"
"    ldrsh.w r0, [r4, #0xc]\n"
"    movs    r2, #0x20\n"
"    ldr     r1, =0xfc2b8879\n"
"    bl      sub_fc2bd986\n"
"    b       loc_fc2b9a50\n"
"loc_fc2b9a4c:\n"
"    ldrh.w  r0, [r8, #8]\n"
"loc_fc2b9a50:\n"
"    strh    r0, [r4, #0xc]\n"
"    ldrsh.w r0, [r4, #6]\n"
"    bl      sub_fc3604fa_my\n" //__________---------------
"		ldr pc,=0xfc2b9a5b\n" //continue in ROM thumb
".ltorg\n"
 );
}
//loc_fc3604fa:
void __attribute__((naked,noinline)) sub_fc3604fa_my() {
asm volatile (
"    push    {r4, r5, r6, lr}\n"
"    ldr     r5, =0x0000cd28\n"
"    mov     r4, r0\n"
"    ldr     r0, [r5, #4]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc360512\n"
"    movs    r0, #0\n"
"    movw    r2, #0x16b\n"
"    ldr     r1, =0xfc3605b8\n" //  *"Shutter.c"
"    blx     sub_fc302464\n"
"loc_fc360512:\n"
"    ldr     r0, =0xfffff400\n"
"    cmp     r4, r0\n"
"    bne     loc_fc36051c\n"
"    ldrsh.w r4, [r5, #2]\n"
"loc_fc36051c:\n"
"    strh    r4, [r5, #2]\n"
"    cmp     r4, r0\n"
"    bne     loc_fc36052e\n"
"    movs    r0, #0\n"
"    movw    r2, #0x171\n"
"    ldr     r1, =0xfc3605b8\n" //  *"Shutter.c"
"    blx     sub_fc302464\n"
"loc_fc36052e:\n"
"    mov     r0, r4\n"
"    	bl      apex2us\n"
// "    bl      sub_fc3f457e\n"
// "    mov     r4, r0\n"
// "    bl      sub_fc23f4fc\n" //  return
// "    mov     r0, r4\n"
"    bl      sub_fc15fa3a\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc360554\n" //  return
"    pop.w   {r4, r5, r6, lr}\n"
"    movs    r0, #0\n"
"    movw    r2, #0x176\n"
"    ldr     r1, =0xfc3605b8\n" //  *"Shutter.c"
//"    b.w     loc_fc301948\n"
"		ldr pc, =0xfc301949\n" //replace above with thumb
"loc_fc360554:\n"
"    pop     {r4, r5, r6, pc}\n"
".ltorg\n"
 );
}

