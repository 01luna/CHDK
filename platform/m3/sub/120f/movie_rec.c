// byte offset of bitrate constants inside the fw struct passed to set_quality()
#define BR_LOW_OFS 0x2c
#define BR_MID_OFS 0x30
#define BR_HI_OFS  0x28

// maximum allowed bitrate that doesn't crash the camera
#define MAX_VIDEO_BITRATE 41000

#define FW_SHORT_TIME_LIMIT 30      // unlocking fw time limits below this require user permission (seconds)
#define SHORT_TIME_LIMIT 300        // raised time limit for movie modes that have more restricted fw time limits
#define LONG_TIME_LIMIT (3*60*60)   // raised time limit for all other movie kinds

#include "../../../generic/movie_rec.c"

/*************************************************************/
//** movie_record_task @ fc142bc5
void __attribute__((naked,noinline)) movie_record_task() {
asm volatile (
// task_MovieRecord 0xfc142bc5
"    push.w  {r2, r3, r4, r5, r6, r7, r8, sb, sl, fp, ip, lr}\n"
"    ldr     r4, =0x0000b228\n"
"    movs    r7, #0\n"
"    ldr.w   sb, =0x00058ef0\n"
"    mov.w   sl, #1\n"
"    ldr.w   r8, =0x0000b128\n"
"    sub.w   r5, r4, #0x80\n"
"    sub.w   r6, r4, #0x180\n"
"    movw    fp, #0x2710\n"
"loc_fc142be4:\n"
"    movs    r2, #0\n"
"    add     r1, sp, #4\n"
"    ldr     r0, [r6, #0x18]\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    ldr     r0, [sp, #4]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0xb\n"
"    bhs     loc_fc142c14\n"
"    tbb     [pc, r0]\n" // (jumptable r0 11 elements)
"branchtable_fc142bfa:\n"
"    .byte((loc_fc142c06 - branchtable_fc142bfa) / 2)\n" // (case 0)
"    .byte((loc_fc142c2c - branchtable_fc142bfa) / 2)\n" // (case 1)
"    .byte((loc_fc142d7c - branchtable_fc142bfa) / 2)\n" // (case 2)
"    .byte((loc_fc142c92 - branchtable_fc142bfa) / 2)\n" // (case 3)
"    .byte((loc_fc142c98 - branchtable_fc142bfa) / 2)\n" // (case 4)
"    .byte((loc_fc142cf2 - branchtable_fc142bfa) / 2)\n" // (case 5)
"    .byte((loc_fc142d36 - branchtable_fc142bfa) / 2)\n" // (case 6)
"    .byte((loc_fc142d9c - branchtable_fc142bfa) / 2)\n" // (case 7)
"    .byte((loc_fc142d94 - branchtable_fc142bfa) / 2)\n" // (case 8)
"    .byte((loc_fc142d14 - branchtable_fc142bfa) / 2)\n" // (case 9)
"    .byte((loc_fc142d76 - branchtable_fc142bfa) / 2)\n" // (case 10)
".align 1\n"
"loc_fc142c06:\n"
"    ldr     r0, [r5, #0x60]\n"
"    bl      sub_fc37a5b6\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142c16\n"
"loc_fc142c10:\n"
"    bl      sub_fc13fc3c\n"
"loc_fc142c14:\n"
"    b       loc_fc142d9c\n"
"loc_fc142c16:\n"
"    ldr.w   r0, [r8, #0x3c]\n"
"    cbnz    r0, loc_fc142c20\n"
"    bl      sub_fc13fbb8\n"
"loc_fc142c20:\n"
"    bl      sub_fc14293c_my\n" // <---------------- 
"loc_fc142c24:\n"
"    cmp     r0, #0\n"
"    str     r0, [r5, #0x5c]\n"
"    bne     loc_fc142c10\n"
"    b       loc_fc142d9c\n"
"loc_fc142c2c:\n"
"    bl      sub_fc142644\n"
"    str     r0, [r5, #0x5c]\n"
"    ldr.w   r0, [r8, #0x3c]\n"
"    cbnz    r0, loc_fc142c84\n"
"    ldr     r1, [r6, #0x68]\n"
"    add.w   r0, sb, r1, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    bl      sub_fc260d00\n"
"    ldr     r0, [r5, #0x5c]\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142c52\n"
"    bl      sub_fc14241c\n"
"    str     r0, [r5, #0x5c]\n"
"loc_fc142c52:\n"
"    movw    r0, #0x314e\n"
"    bl      sub_fc13fcd4\n"
"    b       loc_fc142c86\n"
//*** constants skiped FC142C5C - FC142C83 ***
"loc_fc142c84:\n"
"    b       loc_fc142c8a\n"
"loc_fc142c86:\n"
"    bl      sub_fc13fbf8\n"
"loc_fc142c8a:\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cmp     r0, #0\n"
"    bne     loc_fc142c10\n"
"    b       loc_fc142cec\n"
"loc_fc142c92:\n"
"    bl      sub_fc142368\n"
"    b       loc_fc142c24\n"
"loc_fc142c98:\n"
"    ldr     r0, [r6, #0x4c]\n"
"    cmp     r0, #6\n"
"    beq     loc_fc142cec\n"
"    ldr.w   r0, [r8, #0x14]\n"
"    cbnz    r0, loc_fc142cb0\n"
"    movs    r1, #4\n"
"    movs    r0, #0\n"
"    bl      sub_fc13b9d0\n"
"    str.w   sl, [r8, #0x14]\n"
"loc_fc142cb0:\n"
"    bl      sub_fc13fbb8\n"
"    bl      sub_fc14220c\n"
"    str     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142cc2\n"
"loc_fc142cbc:\n"
"    bl      sub_fc13fc3c\n"
"    b       loc_fc142cec\n"
"loc_fc142cc2:\n"
"    ldr.w   r0, [r8, #0x54]\n"
"    mov     r1, r8\n"
"    cbnz    r0, loc_fc142cde\n"
"    ldr     r0, [r1, #0x64]\n"
"    cbz     r0, loc_fc142cde\n"
"    bl      sub_fc141bae\n"
"    str     r0, [r5, #0x5c]\n"
"    bl      sub_fc14385a\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cmp     r0, #0\n"
"    bne     loc_fc142cbc\n"
"loc_fc142cde:\n"
"    ldr     r1, [r6, #0x68]\n"
"    add.w   r0, sb, r1, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    bl      sub_fc260d00\n"
"loc_fc142cec:\n"
"    ldr     r0, [r4, #0x1c]\n"
"    ldr     r1, [r5, #0x78]\n"
"    b       loc_fc142d90\n"
"loc_fc142cf2:\n"
"    ldr     r0, [r6, #0x4c]\n"
"    cmp     r0, #6\n"
"    beq     loc_fc142d0e\n"
"    bl      sub_fc141bae\n"
"    str     r0, [r5, #0x5c]\n"
"    bl      sub_fc14385a\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142d0c\n"
"    bl      sub_fc13fc3c\n"
"    b       loc_fc142d0e\n"
"loc_fc142d0c:\n"
"    str     r7, [r6, #0x4c]\n"
"loc_fc142d0e:\n"
"    ldr     r1, [r4, #4]\n"
"    ldr     r0, [r4, #0x24]\n"
"    b       loc_fc142d90\n"
"loc_fc142d14:\n"
"    bl      sub_fc142ef0\n"
"    lsls    r0, r0, #0x1f\n"
"    beq     loc_fc142d20\n"
"    mov     r0, sl\n"
"    b       loc_fc142d22\n"
"loc_fc142d20:\n"
"    mov     r0, r7\n"
"loc_fc142d22:\n"
"    str     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142d2e\n"
"    mov.w   r0, #0xa0000\n"
"    bl      sub_fc36dfe6\n" // HardwareDefect_FW
"loc_fc142d2e:\n"
"    ldr     r0, [r6, #0x30]\n"
"    blx     sub_fc302334\n" // -> GiveSemaphore
"    b       loc_fc142d9c\n"
"loc_fc142d36:\n"
"    ldr     r0, [r6, #0x4c]\n"
"    cmp     r0, #6\n"
"    bne     loc_fc142d46\n"
"    ldr     r1, [r4, #0xc]\n"
"    cbz     r1, loc_fc142d92\n"
"    ldr     r0, [r4, #0x2c]\n"
"    blx     r1\n"
"    b       loc_fc142d70\n"
"loc_fc142d46:\n"
"    bl      sub_fc141ffe\n"
"    str     r0, [r5, #0x5c]\n"
"    cbnz    r0, loc_fc142d64\n"
"    ldr.w   r0, [r8, #0x64]\n"
"    cbz     r0, loc_fc142d5e\n"
"    bl      sub_fc141bae\n"
"    str     r0, [r5, #0x5c]\n"
"    bl      sub_fc14385a\n"
"loc_fc142d5e:\n"
"    str     r7, [r6, #0x4c]\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142d70\n"
"loc_fc142d64:\n"
"    ldr     r1, [r4, #0xc]\n"
"    cbz     r1, loc_fc142d6c\n"
"    ldr     r0, [r4, #0x2c]\n"
"    blx     r1\n"
"loc_fc142d6c:\n"
"    bl      sub_fc13fc3c\n"
"loc_fc142d70:\n"
"    ldr     r1, [r4, #8]\n"
"    ldr     r0, [r4, #0x28]\n"
"    b       loc_fc142d90\n"
"loc_fc142d76:\n"
"    bl      sub_fc1418d8\n"
"    b       loc_fc142c24\n"
"loc_fc142d7c:\n"
"    movw    r3, #0x1959\n"
"    ldr     r2, =0xfc13ffcc\n" //  **"MovieRecorder.c"
"    ldr     r0, [r6, #0x74]\n"
"    mov     r1, fp\n"
"    blx     sub_fc3022bc\n" // j_TakeSemaphoreStrictly
"    str     r7, [r5, #0x5c]\n"
"    ldr     r1, [r4]\n"
"    ldr     r0, [r4, #0x34]\n"
"loc_fc142d90:\n"
"    blx     r1\n"
"loc_fc142d92:\n"
"    b       loc_fc142d9c\n"
"loc_fc142d94:\n"
"    bl      sub_fc1439ec\n"
"    str     r0, [r5, #0x5c]\n"
"    b       loc_fc142d2e\n"
"loc_fc142d9c:\n"
"    ldr     r1, [sp, #4]\n"
"    movw    r3, #0x13be\n"
"    mov     r2, fp\n"
"    str     r7, [r1]\n"
"    str     r3, [sp]\n"
"    ldr     r3, =0xfc13ffcc\n" //  **"MovieRecorder.c"
"    ldr     r0, [r6, #0x20]\n"
"    blx     sub_fc302134\n" // j_PostMessageQueueStrictly
"    b       loc_fc142be4\n"
);
}

/*************************************************************/
void __attribute__((naked,noinline)) sub_fc14293c_my() {
asm volatile (
"loc_fc14293c:\n"
"    push.w  {r4, r5, r6, r7, r8, lr}\n"
"    sub     sp, #0x128\n"
"    ldr     r5, =0x0000b128\n"
"    movs    r0, #0x1a\n"
"    add     r1, sp, #0x48\n"
"    str     r0, [sp, #4]\n"
"    add     r0, sp, #0xbc\n"
"    ldrd    r2, r3, [r5, #0x3c]\n"
"    mov     r4, r1\n"
"    bl      sub_fc13ff30\n"
"    add     r0, sp, #0xbc\n"
"    bl      sub_fc2fc8a8\n"
"    add     r0, sp, #0x34\n"
"    mov     r1, r4\n"
"    bl      sub_fc140118_my\n" // <----------------------
"    add     r0, sp, #0x34\n"
"    bl      sub_fc2fc8e8\n"
"    bl      sub_fc2faefc\n"
"    sub.w   r4, r5, #0x80\n"
"    movw    r6, #0x2710\n"
"    add     r1, sp, #0x124\n"
"    mov     r2, r6\n"
"    ldr     r0, [r4, #0x14]\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"loc_fc142982:\n"
"    bne     loc_fc142a68\n"
"    ldr     r0, [sp, #0x124]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #4\n"
"    bne     loc_fc142982\n"
"    bl      sub_fc2fb426\n"
"    ldr     r0, [r4, #0x14]\n"
"    add     r1, sp, #0x124\n"
"    mov     r8, r6\n"
"    mov     r2, r6\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142982\n"
"    ldr     r0, [sp, #0x124]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x10\n"
"    bne     loc_fc142982\n"
"    ldr     r6, =0x00058ef0\n"
"    add.w   r7, r4, #0x100\n"
"    ldr     r0, [r5, #0x40]\n"
"    cbz     r0, loc_fc142a18\n"
"    ldr     r0, [r4, #0x68]\n"
"    add.w   r0, r6, r0, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    bl      _strlen\n"
"    ldr     r1, [r4, #0x68]\n"
"    adds    r2, r0, #1\n"
"    add     r0, sp, #8\n"
"    add.w   r1, r6, r1, lsl #2\n"
"    ldr     r1, [r1, #-0x4]\n"
"    blx     sub_fc30242c\n"
"    movs    r1, #0x2e\n"
"    add     r0, sp, #8\n"
"    bl      _strrchr\n"
"    cbz     r0, loc_fc1429ee\n"
"    movs    r1, #0x44\n"
"    strb    r1, [r0, #1]\n"
"    movs    r1, #0x41\n"
"    strb    r1, [r0, #2]\n"
"    movs    r1, #0x54\n"
"    strb    r1, [r0, #3]\n"
"    add     r0, sp, #8\n"
"    bl      sub_fc37a932\n"
"loc_fc1429ee:\n"
"    ldr     r0, [r4, #0x68]\n"
"    add.w   r0, r6, r0, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    bl      sub_fc37a932\n"
"    ldr     r0, [r5, #0x40]\n"
"    cbz     r0, loc_fc142a18\n"
"    ldr     r1, =0x000590e0\n"
"    movs    r0, #0\n"
"    str     r0, [r7, #0x10]\n"
"    subs    r1, #0x20\n"
"    str     r0, [r7, #0xc]\n"
"    str     r0, [r1]\n"
"    ldr     r0, =0xfc141161\n"
"    bl      sub_fc2fbc6e\n"
"    movs    r0, #3\n"
"    bl      sub_fc06bf20\n"
"loc_fc142a18:\n"
"    ldr     r0, [r5, #0x3c]\n"
"    cbz     r0, loc_fc142a72\n"
"    ldr     r0, [r4, #0x68]\n"
"    add.w   r0, r6, r0, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    cbz     r0, loc_fc142a3a\n"
"    bl      sub_fc13fbb8\n"
"    ldr     r0, =0x0000b128\n"
"    add     r1, sp, #0x30\n"
"    adds    r0, #0x64\n"
"    bl      sub_fc142758\n"
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142982\n"
"loc_fc142a3a:\n"
"    bl      sub_fc13fbf8\n"
"    movw    r6, #0x27f8\n"
"    ldr     r0, [r5, #0x78]\n"
"    mov     r1, r6\n"
"    blx     sub_fc3023f4\n"
"    ldr     r0, [r5, #0x64]\n"
"    cbz     r0, loc_fc142a58\n"
"    ldr     r1, [sp, #0x30]\n"
"    mov     r2, r6\n"
"    ldr     r0, [r5, #0x78]\n"
"    blx     sub_fc30242c\n"
"loc_fc142a58:\n"
"    ldr     r1, [r5, #0x78]\n"
"    adds    r0, r1, #2\n"
"    bl      sub_fc2fd36e\n"
"    ldr     r0, [r5, #0x64]\n"
"    cbz     r0, loc_fc142a6a\n"
"    movs    r0, #3\n"
"    b       loc_fc142a6c\n"
"loc_fc142a68:\n"
"    b       loc_fc142b84\n"
"loc_fc142a6a:\n"
"    movs    r0, #1\n"
"loc_fc142a6c:\n"
"    bl      sub_fc2fc928\n"
"    b       loc_fc142af2\n"
"loc_fc142a72:\n"
"    ldr     r6, =0x00058ef0\n"
"    ldr     r0, [r4, #0x68]\n"
"    adds    r6, #0x98\n"
"    add.w   r0, r6, r0, lsl #2\n"
"    ldr     r0, [r0, #-0x4]\n"
"    str     r0, [sp, #0x114]\n"
"    str     r0, [sp, #0x118]\n"
"    str     r0, [sp, #0x11c]\n"
"    movs    r0, #1\n"
"    bl      sub_fc1ff96e\n"
"    rsb     r0, r0, r0, lsl #4\n"
"    lsls    r0, r0, #2\n"
"    str     r0, [sp, #0x120]\n"
"    ldr     r0, [r5, #0x4c]\n"
"    cbz     r0, loc_fc142ae6\n"
"    ldr     r0, [r5, #0x5c]\n"
"    cbz     r0, loc_fc142aae\n"
"    ldr     r0, [r5, #0x50]\n"
"    movw    r1, #0x2800\n"
"    blx     sub_fc3023f4\n"
"    ldr     r1, =0x0000b128\n"
"    ldr     r0, [r5, #0x50]\n"
"    subs    r1, #0x7c\n"
"    b       loc_fc142ab2\n"
"loc_fc142aae:\n"
"    movs    r1, #0\n"
"    mov     r0, r1\n"
"loc_fc142ab2:\n"
"    bl      sub_fc2fd352\n"
"    movs    r0, #0\n"
"    bl      sub_fc2fd33c\n"
"    movs    r0, #1\n"
"    bl      sub_fc2fc928\n"
"    add     r0, sp, #0x114\n"
"    bl      sub_fc2fcb94\n"
"    ldr     r0, [r4, #0x68]\n"
"    add     r2, sp, #4\n"
"    ldr     r1, =0x000590e0\n"
"    add.w   r0, r6, r0, lsl #2\n"
"    subs    r0, r0, #4\n"
"    adds    r1, #0x14\n"
"    blx     sub_fc30215c\n"
"    ldr     r1, =0x000590e0\n"
"    movs    r0, #8\n"
"    adds    r1, #0x1f\n"
"    bl      sub_fc2fc97a\n"
"    b       loc_fc142af2\n"
"loc_fc142ae6:\n"
"    movs    r0, #0\n"
"    bl      sub_fc2fc928\n"
"    add     r0, sp, #0x114\n"
"    bl      sub_fc2fcb94\n"
"loc_fc142af2:\n"
"    ldr     r6, =0x0000b228\n"
"    ldr     r0, [r6, #0x44]\n"
"    cmp     r0, #7\n"
"    beq     loc_fc142afe\n"
"    cmp     r0, #8\n"
"    bne     loc_fc142b02\n"
"loc_fc142afe:\n"
"    movs    r0, #2\n"
"    b       loc_fc142b04\n"
"loc_fc142b02:\n"
"    movs    r0, #1\n"
"loc_fc142b04:\n"
"    bl      sub_fc2fc964\n"
"    ldr     r0, [r5, #0x4c]\n"
"    cbz     r0, loc_fc142b2c\n"
"    ldr     r0, [r6, #0x44]\n"
"    cmp     r0, #6\n"
"    beq     loc_fc142b18\n"
"    cmp     r0, #7\n"
"    beq     loc_fc142b18\n"
"    cbnz    r0, loc_fc142b20\n"
"loc_fc142b18:\n"
"    movs    r0, #0xf\n"
"    bl      sub_fc2fc964\n"
"    b       loc_fc142b2c\n"
"loc_fc142b20:\n"
"    ldr     r1, =0xfc13ffcc\n" //  **"MovieRecorder.c"
"    movs    r0, #0\n"
"    movw    r2, #0xe9d\n"
"    blx     sub_fc302434\n" // j_DebugAssert
"loc_fc142b2c:\n"
"    ldr     r1, [r5, #0x44]\n"
"    ldr     r0, [r5, #0x18]\n"
"    orrs    r0, r1\n"
"    beq     loc_fc142b38\n"
"    movs    r0, #0\n"
"    b       loc_fc142b3a\n"
"loc_fc142b38:\n"
"    movs    r0, #1\n"
"loc_fc142b3a:\n"
"    bl      sub_fc209e7a\n"
"    bl      sub_fc2fb21e\n"
"    ldr     r0, [r4, #0x14]\n"
"    add     r1, sp, #0x124\n"
"    mov     r2, r8\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142ba0\n"
"    ldr     r0, [sp, #0x124]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x11\n"
"    bne     loc_fc142ba0\n"
"    movs    r0, #0\n"
"    bl      sub_fc1449fc\n"
"    ldr     r0, [r5, #0x3c]\n"
"    cbz     r0, loc_fc142b86\n"
"    ldr     r0, [r7, #4]\n"
"    uxth    r0, r0\n"
"    bl      sub_fc2fcb7e\n"
"    bl      sub_fc2fb43c\n"
"    ldr     r0, [r4, #0x14]\n"
"    add     r1, sp, #0x124\n"
"    mov     r2, r8\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142ba0\n"
"    ldr     r0, [sp, #0x124]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x12\n"
"    beq     loc_fc142ba8\n"
"loc_fc142b84:\n"
"    b       loc_fc142ba0\n"
"loc_fc142b86:\n"
"    bl      sub_fc2fb234\n"
"    ldr     r0, [r4, #0x14]\n"
"    add     r1, sp, #0x124\n"
"    mov     r2, r8\n"
"    blx     sub_fc3022d4\n" // j_ReceiveMessageQueue
"    lsls    r0, r0, #0x1f\n"
"    bne     loc_fc142ba0\n"
"    ldr     r0, [sp, #0x124]\n"
"    ldr     r0, [r0]\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc142ba8\n"
"loc_fc142ba0:\n"
"    movs    r0, #1\n"
"loc_fc142ba2:\n"
"    add     sp, #0x128\n"
"    pop.w   {r4, r5, r6, r7, r8, pc}\n"
"loc_fc142ba8:\n"
"    ldr     r0, [r5, #0x40]\n"
"    cbnz    r0, loc_fc142bc0\n"
"    movs    r5, #0\n"
"loc_fc142bae:\n"
"    ldr     r0, [r4, #0x1c]\n"
"    add     r1, sp, #0x2c\n"
"    blx     sub_fc30214c\n" // j_TryReceiveMessageQueue
"    adds    r5, r5, #1\n"
"    cmp     r5, #2\n"
"    blt     loc_fc142bae\n"
"    ldr     r0, =0xfc13fd35\n"
"    str     r0, [r6, #0x14]\n"
"loc_fc142bc0:\n"
"    movs    r0, #0\n"
"    b       loc_fc142ba2\n"
);
}

/*************************************************************/
void __attribute__((naked,noinline)) sub_fc140118_my() {
asm volatile (
"loc_fc140118:\n"
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    sub     sp, #0x1c\n"
"    mov.w   sb, #0\n"
"    ldr.w   fp, =0x0000b0a8\n"
"    mov.w   r8, #1\n"
"    mov     r5, r0\n"
"    mov     r4, r1\n"
"    strd    r8, sb, [sp, #0xc]\n"
"    add.w   fp, fp, #0x80\n"
"    str.w   sb, [sp, #8]\n"
"    str.w   sb, [sp, #4]\n"
"    add.w   r6, fp, #0x80\n"
"    mov     sl, sb\n"
"    str.w   sb, [fp, #0x34]\n"
"    strb.w  r8, [r0]\n"
"    strb.w  sb, [r0, #1]\n"
"    ldr     r0, [r6, #0x60]\n"
"    bl      _GetDrive_ClusterSize\n"
"    ldr     r7, =0x0000b0a8\n"
"    add.w   r4, r4, #0x1c\n"
"    mov.w   r2, #0xc\n"
"    movw    ip, #0x9c4\n"
"    movw    lr, #0x61a8\n"
"    movw    r1, #0x7530\n"
"    str     r0, [r7, #0x54]\n"
"    str     r0, [r5, #8]\n"
"    movs    r0, #0x64\n"
"    strb.w  sl, [r5, #4]\n"
"    strb    r0, [r4, #3]\n"
"    movw    r0, #0xbb80\n"
"    strb.w  sl, [r4, #8]\n"
"    strb.w  sl, [r4, #6]\n"
"    strb.w  r8, [r4, #9]\n"
"    strb.w  r8, [r4, #0xb]\n"
"    str     sl, [r4, #-0x10]\n"
"    strb.w  r8, [r4, #5]\n"
"    strb.w  r8, [r4, #0x26]\n"
"    strb.w  r8, [r4, #7]\n"
"    strb.w  r8, [r4, #0x1c]\n"
"    str     r0, [r4, #0x38]\n"
"    mov.w   r0, #0x10\n"
"    strh    r0, [r4, #0x3c]\n"
"    mov.w   r0, #0x1f400\n"
"    str     r0, [r4, #0x44]\n"
"    add.w   r0, r6, #0x80\n"
"    strb.w  sl, [r4, #0x40]\n"
"    sub.w   r4, r4, #0x1c\n"
"    movw    sl, #0xbb5\n"
"    ldr     r3, [r0, #0x44]\n"
"    mov.w   r0, #0xf\n"
"    cmp     r3, #0x16\n"
"    bhs     loc_fc1402c6\n"
"    tbh     [pc, r3]\n" // (jumptable r3 22 elements)
"branchtable_fc1401cc:\n"
"    .short((loc_fc140370 - branchtable_fc1401cc) / 2)\n" // (case 0)
"    .short((loc_fc140202 - branchtable_fc1401cc) / 2)\n" // (case 1)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 2)
"    .short((loc_fc1401e2 - branchtable_fc1401cc) / 2)\n" // (case 3)
"    .short((loc_fc14035e - branchtable_fc1401cc) / 2)\n" // (case 4)
"    .short((loc_fc14034c - branchtable_fc1401cc) / 2)\n" // (case 5)
"    .short((loc_fc1402de - branchtable_fc1401cc) / 2)\n" // (case 6)
"    .short((loc_fc14029e - branchtable_fc1401cc) / 2)\n" // (case 7)
"    .short((loc_fc14027c - branchtable_fc1401cc) / 2)\n" // (case 8)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 9)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 10)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 11)
"    .short((loc_fc14038c - branchtable_fc1401cc) / 2)\n" // (case 12)
"    .short((loc_fc1403a0 - branchtable_fc1401cc) / 2)\n" // (case 13)
"    .short((loc_fc1403c4 - branchtable_fc1401cc) / 2)\n" // (case 14)
"    .short((loc_fc14021a - branchtable_fc1401cc) / 2)\n" // (case 15)
"    .short((loc_fc140238 - branchtable_fc1401cc) / 2)\n" // (case 16)
"    .short((loc_fc140254 - branchtable_fc1401cc) / 2)\n" // (case 17)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 18)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 19)
"    .short((loc_fc1402c6 - branchtable_fc1401cc) / 2)\n" // (case 20)
"    .short((loc_fc14030e - branchtable_fc1401cc) / 2)\n" // (case 21)
".align 1\n"
"loc_fc1401e2:\n"
"    movw    r0, #0x95d\n"
"    strh    r0, [r4, #0x1c]\n"
"    ldr     r0, =0x0001005a\n"
"    movw    r1, #0x5dc0\n"
"    strb    r2, [r4, #1]\n"
"    subs    r0, #0x42\n"
"    str     r0, [r4, #0x34]\n"
"    movw    r0, #0x3e9\n"
"    strb    r2, [r5, #5]\n"
"    strd    r1, r0, [r6, #0x1c]\n"
"    str     r1, [sp, #0x10]\n"
"    b       loc_fc140214\n"
"loc_fc140202:\n"
"    strh.w  ip, [r4, #0x1c]\n"
"    movs    r0, #0x19\n"
"    strb    r2, [r4, #1]\n"
"    str     r0, [r4, #0x34]\n"
"    strb    r2, [r5, #5]\n"
"    str.w   lr, [r6, #0x1c]\n"
"    b       loc_fc14022c\n"
"loc_fc140214:\n"
"    str     r0, [sp, #0xc]\n"
"loc_fc140216:\n"
"    strh    r2, [r7, #0xe]\n"
"    b       loc_fc14030e\n"
"loc_fc14021a:\n"
"    strh.w  ip, [r4, #0x1c]\n"
"    movs    r0, #5\n"
"    strb    r2, [r4, #1]\n"
"    str     r0, [r4, #0x34]\n"
"    movw    r0, #0x1388\n"
"    strb    r2, [r5, #5]\n"
"    str     r0, [r6, #0x1c]\n"
"loc_fc14022c:\n"
"    movw    r0, #0x3e8\n"
"loc_fc140230:\n"
"    str     r0, [r6, #0x20]\n"
"    str.w   lr, [sp, #0x10]\n"
"    b       loc_fc140214\n"
"loc_fc140238:\n"
"    strh.w  ip, [r4, #0x1c]\n"
"    movs    r0, #5\n"
"    strb    r2, [r4, #1]\n"
"    str     r0, [r4, #0x34]\n"
"    movw    r0, #0x3e8\n"
"    strb    r2, [r5, #5]\n"
"    strd    ip, r0, [r6, #0x1c]\n"
"    strd    r0, lr, [sp, #0xc]\n"
"    mov     r0, r8\n"
"    b       loc_fc140272\n"
"loc_fc140254:\n"
"    strh.w  ip, [r4, #0x1c]\n"
"    movs    r0, #5\n"
"    strb    r2, [r4, #1]\n"
"    str     r0, [r4, #0x34]\n"
"    movw    r0, #0x4e2\n"
"    strb    r2, [r5, #5]\n"
"    str     r0, [r6, #0x1c]\n"
"    movw    r0, #0x3e8\n"
"    str     r0, [r6, #0x20]\n"
"    strd    r0, lr, [sp, #0xc]\n"
"    movs    r0, #3\n"
"loc_fc140272:\n"
"    str.w   r0, [fp, #0x70]\n"
"    str.w   r0, [fp, #0x74]\n"
"    b       loc_fc140216\n"
"loc_fc14027c:\n"
"    movw    r0, #0x1388\n"
"    strh    r0, [r4, #0x1c]\n"
"    movs    r0, #0x18\n"
"    strb    r0, [r4, #1]\n"
"    movs    r1, #0x32\n"
"    str     r1, [r4, #0x34]\n"
"    movw    r1, #0x3e8\n"
"    movw    r2, #0xc350\n"
"    strb    r0, [r5, #5]\n"
"    strd    r2, r1, [r6, #0x1c]\n"
"    strd    r1, r2, [sp, #0xc]\n"
"    b       loc_fc1402fc\n"
"loc_fc14029e:\n"
"    ldr     r3, =0x0001005a\n"
"    movw    r2, #0x176a\n"
"    strh    r2, [r4, #0x1c]\n"
"    movs    r2, #0x1e\n"
"    strb    r2, [r4, #1]\n"
"    subs    r3, #0x1e\n"
"    movw    ip, #0x3e9\n"
"    str     r3, [r4, #0x34]\n"
"    movw    r3, #0xea60\n"
"    strb.w  r8, [r4, #0x22]\n"
"    strb    r2, [r5, #5]\n"
"    strd    r3, ip, [r6, #0x1c]\n"
"    strd    ip, r3, [sp, #0xc]\n"
"    b       loc_fc1402c8\n"
"loc_fc1402c6:\n"
"    b       loc_fc140458\n"
"loc_fc1402c8:\n"
"    strh    r2, [r7, #0xe]\n"
"    ldr.w   r2, [fp, #0x48]\n"
"    cbz     r2, loc_fc14030e\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    strb    r0, [r5, #5]\n"
"    strd    ip, r1, [sp, #0xc]\n"
"    b       loc_fc1402fc\n"
"loc_fc1402de:\n"
"    ldr.w   r2, [fp, #0x48]\n"
"    cbz     r2, loc_fc140300\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    ldr     r2, =0x0001005a\n"
"    strb    r0, [r4, #1]\n"
"    str     r2, [r4, #0x34]\n"
"    ldr     r2, =0x00015f90\n"
"    strb    r0, [r5, #5]\n"
"loc_fc1402f2:\n"
"    str     r2, [r6, #0x1c]\n"
"    movw    r2, #0x3e9\n"
"    str     r2, [r6, #0x20]\n"
"    b       loc_fc140386\n"
"loc_fc1402fc:\n"
"    strh    r0, [r7, #0xe]\n"
"    b       loc_fc14030e\n"
"loc_fc140300:\n"
"    movw    r2, #0x57c\n"
"loc_fc140304:\n"
"    ldr     r1, =0xfc13ffcc\n" //  *"MovieRecorder.c"
"    movs    r0, #0\n"
"    blx     sub_fc302434\n" // j_DebugAssert
"loc_fc14030e:\n"
"    movs    r0, #2\n"
"    strb    r0, [r4]\n"
"    ldr     r0, =0x0000b0a8\n"
"    mov.w   sl, #0\n"
"    strb.w  sl, [r4, #0x26]\n"
"    adds    r0, #0x80\n"
"    strb.w  sl, [r4, #2]\n"
"    ldr     r3, [r0, #0x30]\n"
"    cmp     r3, #0\n"
"    beq     loc_fc1403ee\n"
"    add.w   r0, r0, #0x100\n"
"    ldr     r0, [r0, #0x3c]\n"
"    cmp.w   r0, #0x780\n"
"    bne     loc_fc1403f0\n"
"    ldr     r1, =0x0000b0a8\n"
"    adds    r1, #0x80\n"
"    str.w   r8, [r1, #0x34]\n"
"    movs    r1, #3\n"
"    strb.w  r8, [r4]\n"
"    strb    r1, [r4, #1]\n"
"    strb.w  r8, [r4, #2]\n"
"    strh    r1, [r7, #0xe]\n"
"    b       loc_fc14046a\n"
"loc_fc14034c:\n"
"    ldr     r2, =0x0001005a\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    adds    r2, #0x1e\n"
"    str     r2, [r4, #0x34]\n"
"    ldr     r2, =0x0001d4c0\n"
"    strb    r0, [r5, #5]\n"
"    b       loc_fc1402f2\n"
"loc_fc14035e:\n"
"    ldr     r2, =0x0001005a\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    adds    r2, #0x96\n"
"    str     r2, [r4, #0x34]\n"
"    ldr     r2, =0x0003a980\n"
"    strb    r0, [r5, #5]\n"
"    b       loc_fc1402f2\n"
"loc_fc140370:\n"
"    movw    r2, #0x3e9\n"
"    ldr     r3, =0x0001005a\n"
"    subs    r3, #0x3c\n"
"    strd    r1, r2, [r6, #0x1c]\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    str     r3, [r4, #0x34]\n"
"    strb    r0, [r5, #5]\n"
"loc_fc140386:\n"
"    strd    r2, r1, [sp, #0xc]\n"
"    b       loc_fc1402fc\n"
"loc_fc14038c:\n"
"    ldr     r2, =0x0001005a\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    subs    r2, #0x54\n"
"    str     r2, [r4, #0x34]\n"
"    movw    r2, #0x1770\n"
"    strb    r0, [r5, #5]\n"
"    b       loc_fc1402f2\n"
"loc_fc1403a0:\n"
"    ldr     r2, =0x0001005a\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    subs    r2, #0x54\n"
"    str     r2, [r4, #0x34]\n"
"    movw    r2, #0xbb8\n"
"    strb    r0, [r5, #5]\n"
"    str     r2, [r6, #0x1c]\n"
"    movw    r2, #0x3e9\n"
"    str     r2, [r6, #0x20]\n"
"    strd    r2, r1, [sp, #0xc]\n"
"    mov     r1, r8\n"
"    b       loc_fc1403e4\n"
"    b       loc_fc1403c4\n"
"loc_fc1403c4:\n"
"    ldr     r2, =0x0001005a\n"
"    strh.w  sl, [r4, #0x1c]\n"
"    strb    r0, [r4, #1]\n"
"    subs    r2, #0x54\n"
"    str     r2, [r4, #0x34]\n"
"    movw    r2, #0x5dc\n"
"loc_fc1403d4:\n"
"    strb    r0, [r5, #5]\n"
"    str     r2, [r6, #0x1c]\n"
"    movw    r2, #0x3e9\n"
"    str     r2, [r6, #0x20]\n"
"    strd    r2, r1, [sp, #0xc]\n"
"    movs    r1, #3\n"
"loc_fc1403e4:\n"
"    str.w   r1, [fp, #0x70]\n"
"    str.w   r1, [fp, #0x74]\n"
"    b       loc_fc1402fc\n"
"loc_fc1403ee:\n"
"    b       loc_fc140502\n"
"loc_fc1403f0:\n"
"    b       loc_fc14045e\n"
// constants skiped FC1403F2 - FC140457
"loc_fc140458:\n"
"    movw    r2, #0x5ef\n"
"    b       loc_fc140304\n"
"loc_fc14045e:\n"
"    strb.w  sl, [r4]\n"
"    strb.w  r8, [r4, #1]\n"
"    strh.w  r8, [r7, #0xe]\n"
"loc_fc14046a:\n"
"    strb.w  r8, [r4, #0x26]\n"
"    strb.w  r8, [r4, #0x22]\n"
"    ldr     r0, =0x0000b2c8\n"
"loc_fc140474:\n"
"    movw    lr, #0x800\n"
"    str     r0, [r6, #0x44]\n"
"    movs    r2, #6\n"
"    ldr     r0, =0x1f0e1e4c\n"
"    movw    r1, #0x140\n"
"    mov.w   fp, #0x8000000\n"
"    strd    lr, r0, [r4, #0x44]\n"
"    ldr     r0, =0x082600eb\n"
"    str     r0, [r4, #0x4c]\n"
"    ldr     r0, =0x009a0834\n"
"    str     r0, [r4, #0x50]\n"
"    ldr     r0, =0x0000b2c8\n"
"    subs    r0, #0xa0\n"
"    ldr     r0, [r0, #0x3c]\n"
"    cmp     r0, r1\n"
"    beq     loc_fc140598\n"
"    cmp.w   r0, #0x280\n"
"    beq     loc_fc14059a\n"
"    movw    ip, #0x500\n"
"    movw    r1, #0x9c40\n"
"    cmp     r0, ip\n"
"    movw    r2, #0x9bdc\n"
"    movw    lr, #0x9b78\n"
"    mov.w   fp, #0x29\n"
"    beq     loc_fc14054c\n"
"    movw    ip, #0x780\n"
"    cmp     r0, ip\n"
"    bne     loc_fc14059c\n"
"    mov     sb, ip\n"
"    mov     r0, ip\n"
"    strh.w  ip, [r4, #6]\n"
"    movw    ip, #0x438\n"
"    strh.w  ip, [r4, #4]\n"
"    strh    r0, [r4, #0xa]\n"
"    strh.w  ip, [r4, #8]\n"
"    strb.w  r8, [r4, #0x20]\n"
"    strb.w  r8, [r4, #0x39]\n"
"    strb.w  r8, [r4, #0x3a]\n"
"    strb.w  r8, [r4, #0x3b]\n"
"    strh.w  r8, [r4, #0x3c]\n"
"    strh.w  r8, [r4, #0x3e]\n"
"    strh.w  r8, [r4, #0x40]\n"
"    strh.w  r8, [r7, #0x12]\n"
"    cbz     r3, loc_fc140506\n"
"    strd    lr, r2, [r4, #0x2c]\n"
"    str     r1, [r4, #0x28]\n"
"    b       loc_fc140548\n"
"loc_fc140502:\n"
"    mov     r0, sl\n"
"    b       loc_fc140474\n"
"loc_fc140506:\n"
"    ldr     r0, =0x0000b2c8\n"
"    movw    r1, #0x5d5c\n"
"    movw    r2, #0x5cf8\n"
"    subs    r0, #0xa0\n"
"    ldr     r0, [r0, #0x44]\n"
"    cmp     r0, #1\n"
"    beq     loc_fc14053e\n"
"    cmp     r0, #3\n"
"    beq     loc_fc14053e\n"
"    cmp     r0, #7\n"
"    bne     loc_fc14053e\n"
"    movw    r0, #0x88b8\n"
"    str     r0, [r4, #0x28]\n"
"    movw    r0, #0x8854\n"
"    str     r0, [r4, #0x30]\n"
"    movw    r0, #0x87f0\n"
"    str     r0, [r4, #0x2c]\n"
"    movs    r0, #0x2a\n"
"loc_fc140534:\n"
"    strb    r0, [r4, #0x1e]\n"
"    mov     r0, ip\n"
"    str.w   sb, [r6, #0x24]\n"
"    b       loc_fc140758\n"
"loc_fc14053e:\n"
"    strd    r2, r1, [r4, #0x2c]\n"
"    movw    r0, #0x5dc0\n"
"    str     r0, [r4, #0x28]\n"
"loc_fc140548:\n"
"    mov     r0, fp\n"
"    b       loc_fc140534\n"
"loc_fc14054c:\n"
"    mov     sb, ip\n"
"    mov     r0, ip\n"
"    strh.w  ip, [r4, #6]\n"
"    movw    ip, #0x2d0\n"
"    strh.w  ip, [r4, #4]\n"
"    strh    r0, [r4, #0xa]\n"
"    strh.w  ip, [r4, #8]\n"
"    strb.w  r8, [r4, #0x20]\n"
"    strb.w  r8, [r4, #0x39]\n"
"    strb.w  r8, [r4, #0x3a]\n"
"    ldr     r0, =0x0000b2c8\n"
"    strb.w  r8, [r4, #0x3b]\n"
"    strh.w  r8, [r4, #0x3c]\n"
"    subs    r0, #0xa0\n"
"    strh.w  r8, [r4, #0x3e]\n"
"    strh.w  r8, [r4, #0x40]\n"
"    strh.w  r8, [r7, #0x12]\n"
"    ldr     r0, [r0, #0x44]\n"
"    cbz     r3, loc_fc1405b4\n"
"    cbz     r0, loc_fc140590\n"
"    cmp     r0, #1\n"
"    bne     loc_fc1405a4\n"
"loc_fc140590:\n"
"    strd    lr, r2, [r4, #0x2c]\n"
"    str     r1, [r4, #0x28]\n"
"    b       loc_fc14059e\n"
"loc_fc140598:\n"
"    b       loc_fc14075c\n"
"loc_fc14059a:\n"
"    b       loc_fc1406fc\n"
"loc_fc14059c:\n"
"    b       loc_fc1407ba\n"
"loc_fc14059e:\n"
"    strb.w  fp, [r4, #0x1e]\n"
"    b       loc_fc1405e8\n"
"loc_fc1405a4:\n"
"    movw    r2, #0x679\n"
"    ldr     r1, =0xfc13ffcc\n" //  *"MovieRecorder.c"
"    movs    r0, #0\n"
"    blx     sub_fc302434\n" // j_DebugAssert
"    b       loc_fc1405e8\n"
"loc_fc1405b4:\n"
"    movs    r1, #0x1f\n"
"    movw    r2, #0x1f40\n"
"    cmp     r0, #0xf\n"
"    movw    ip, #0x1edc\n"
"    movw    fp, #0x1e78\n"
"    bge     loc_fc140636\n"
"    cmp     r0, #1\n"
"    beq     loc_fc140636\n"
"    cmp     r0, #7\n"
"    movw    lr, #0x3e80\n"
"    movw    r3, #0x3e1c\n"
"    beq     loc_fc1405da\n"
"    cmp     r0, #8\n"
"    bne     loc_fc140636\n"
"loc_fc1405da:\n"
"    str.w   lr, [r4, #0x28]\n"
"    movw    r0, #0x3db8\n"
"    str     r3, [r4, #0x30]\n"
"loc_fc1405e4:\n"
"    str     r0, [r4, #0x2c]\n"
"    strb    r1, [r4, #0x1e]\n"
"loc_fc1405e8:\n"
"    movw    r0, #0x2d0\n"
"    strd    sb, r0, [r6, #0x24]\n"
"    ldr.w   sb, =0x0000b128\n"
"    ldr.w   r0, [sb, #0x18]\n"
"    cmp     r0, #1\n"
"    bne     loc_fc1406f6\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r3, #2\n"
"    sub.w   r2, sb, #0x7a\n"
"    movw    r1, #0x1d2\n"
"    bl      sub_fc373bb0\n"
"    str.w   sl, [r6, #0x3c]\n"
"    str.w   sl, [r6, #0x40]\n"
"    ldr.w   r0, [sb, #0x1c]\n"
"    cmp     r0, #0\n"
"    ldrh    r0, [r7, #6]\n"
"    beq     loc_fc140640\n"
"    cbz     r0, loc_fc140642\n"
"    bl      sub_fc17b3dc\n" // GetLatestHVPosition_FW
"    cmp     r0, #1\n"
"    beq     loc_fc14062c\n"
"    cmp     r0, #2\n"
"    bne     loc_fc140646\n"
"loc_fc14062c:\n"
"    str.w   r8, [r6, #0x3c]\n"
"    str.w   r8, [r6, #0x40]\n"
"    b       loc_fc140646\n"
"loc_fc140636:\n"
"    str.w   ip, [r4, #0x30]\n"
"    mov     r0, fp\n"
"    str     r2, [r4, #0x28]\n"
"    b       loc_fc1405e4\n"
"loc_fc140640:\n"
"    cbnz    r0, loc_fc140646\n"
"loc_fc140642:\n"
"    str.w   r8, [r6, #0x3c]\n"
"loc_fc140646:\n"
"    movs    r3, #1\n"
"    ldr     r0, [r6, #0x64]\n"
"    add     r2, sp, #8\n"
"    movw    r1, #0x1d5\n"
"    bl      sub_fc373bb0\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r3, #1\n"
"    add     r2, sp, #4\n"
"    movw    r1, #0x1d6\n"
"    bl      sub_fc373bb0\n"
"    ldr     r0, [r6, #0x4c]\n"
"    ldr     r1, =0xfc5fd3d0\n"
"    cmp     r0, #0x5a\n"
"    beq     loc_fc1406aa\n"
"    cmp.w   r0, #0x10e\n"
"    beq     loc_fc1406ce\n"
"    ldrb.w  r2, [sp, #4]\n"
"    movs    r0, #0\n"
"    ldrb.w  r1, [sp, #8]\n"
"    bl      sub_fc25cc3c\n"
"    strh    r0, [r7, #8]\n"
"    asrs    r0, r0, #0x10\n"
"    subs    r0, #0x3c\n"
"    movw    r2, #0x280\n"
"    uxth    r1, r0\n"
"    ldrh    r0, [r7, #8]\n"
"    add.w   r0, r0, r0, lsl #2\n"
"    lsls    r0, r0, #8\n"
"    udiv    r0, r0, r2\n"
"    strh    r0, [r7, #8]\n"
"    movw    r0, #0x2d0\n"
"    muls    r1, r0, r1\n"
"    asrs    r0, r0, #1\n"
"    udiv    r0, r1, r0\n"
"    strh    r0, [r7, #0xa]\n"
"    movs    r0, #4\n"
"    b       loc_fc1406f4\n"
"loc_fc1406aa:\n"
"    ldrb.w  r0, [sp, #8]\n"
"    add.w   r0, r0, r0, lsl #1\n"
"    add.w   r0, r1, r0, lsl #2\n"
"    ldrb.w  r1, [sp, #4]\n"
"    add.w   r1, r0, r1, lsl #2\n"
"    ldr     r0, [sp]\n"
"    ldrh    r2, [r1]\n"
"    ldrh    r1, [r1, #2]\n"
"    bfi     r0, r2, #0, #0x10\n"
"    bfi     r0, r1, #0x10, #0x10\n"
"    b       loc_fc1406e4\n"
"loc_fc1406ce:\n"
"    ldrb.w  r0, [sp, #8]\n"
"    add.w   r0, r0, r0, lsl #1\n"
"    add.w   r0, r1, r0, lsl #2\n"
"    ldrb.w  r1, [sp, #4]\n"
"    add.w   r0, r0, r1, lsl #2\n"
"    ldr     r0, [r0, #0x30]\n"
"loc_fc1406e4:\n"
"    movw    r2, #0xfffe\n"
"    adds    r1, r0, #1\n"
"    ands    r1, r2\n"
"    strh    r1, [r7, #8]\n"
"    lsrs    r0, r0, #0x10\n"
"    strh    r0, [r7, #0xa]\n"
"    movs    r0, #2\n"
"loc_fc1406f4:\n"
"    strh    r0, [r7, #0xc]\n"
"loc_fc1406f6:\n"
"    movw    sb, #0x707\n"
"    b       loc_fc1407c8\n"
"loc_fc1406fc:\n"
"    movw    ip, #0x280\n"
"    strh.w  ip, [r4, #6]\n"
"    movw    r0, #0x1e0\n"
"    strh    r0, [r4, #4]\n"
"    strh.w  ip, [r4, #0xa]\n"
"    movs    r3, #3\n"
"    strh    r0, [r4, #8]\n"
"    strb.w  r2, [r4, #0x20]\n"
"    strb.w  r8, [r4, #0x39]\n"
"    strb.w  r8, [r4, #0x3a]\n"
"    strb.w  r3, [r4, #0x3b]\n"
"    movw    r3, #0xaf0\n"
"    strh.w  r8, [r4, #0x3c]\n"
"    ldr     r1, =0x0000b2c8\n"
"    strh.w  r8, [r4, #0x3e]\n"
"    strh.w  r2, [r4, #0x40]\n"
"    subs    r1, #0xa0\n"
"    strh    r2, [r7, #0x12]\n"
"    movw    r2, #0xb54\n"
"    strd    fp, lr, [r4, #0x4c]\n"
"    str.w   sl, [r4, #0x48]\n"
"    ldr     r1, [r1, #0x44]\n"
"    movw    r1, #0xbb8\n"
"    strd    r3, r2, [r4, #0x2c]\n"
"    str     r1, [r4, #0x28]\n"
"    movs    r1, #0x1e\n"
"    strb    r1, [r4, #0x1e]\n"
"    str.w   ip, [r6, #0x24]\n"
"loc_fc140758:\n"
"    str     r0, [r6, #0x28]\n"
"    b       loc_fc1406f6\n"
"loc_fc14075c:\n"
"    add.w   r4, r4, #0x1c\n"
"    mov.w   ip, #0xf0\n"
"    mov.w   r3, #3\n"
"    movw    r0, #0x3e8\n"
"    strh    r1, [r4, #-0x16]\n"
"    strh    ip, [r4, #-0x18]\n"
"    strh    r1, [r4, #-0x12]\n"
"    strh    ip, [r4, #-0x14]\n"
"    strb    r2, [r4, #4]\n"
"    strb.w  r8, [r4, #0x1d]\n"
"    strb.w  r8, [r4, #0x1e]\n"
"    strb    r3, [r4, #0x1f]\n"
"    strh.w  r8, [r4, #0x20]\n"
"    strh.w  r8, [r4, #0x22]\n"
"    strh    r2, [r4, #0x24]\n"
"    strh    r2, [r7, #0x12]\n"
"    strd    fp, lr, [r4, #0x30]\n"
"    str.w   sl, [r4, #0x2c]\n"
"    str     r0, [r4, #0xc]\n"
"    movw    r0, #0x384\n"
"    str     r0, [r4, #0x14]\n"
"    movw    r0, #0x320\n"
"    str     r0, [r4, #0x10]\n"
"    mov.w   r0, #0x14\n"
"    strb    r0, [r4, #2]\n"
"    sub.w   r4, r4, #0x1c\n"
"    strd    r1, ip, [r6, #0x24]\n"
"    b       loc_fc1406f6\n"
"loc_fc1407ba:\n"
"    movw    r2, #0x746\n"
"    ldr     r1, =0xfc13ffcc\n" //  *"MovieRecorder.c"
"    movs    r0, #0\n"
"    blx     sub_fc302434\n" // j_DebugAssert
"loc_fc1407c8:\n"
"    ldr     r0, [r6, #0x60]\n"
"    bl      sub_fc261b9a\n"
"    strb    r0, [r7]\n"
"    uxtb    r0, r0\n"
"    cmp     r0, #2\n"
"    beq     loc_fc1407da\n"
"    mov     r0, r8\n"
"    b       loc_fc1407dc\n"
"loc_fc1407da:\n"
"    mov     r0, sl\n"
"loc_fc1407dc:\n"
"    strb    r0, [r5, #7]\n"
"    ldr     r0, [r7, #0x54]\n"
"    mov.w   r1, #0x300000\n"
"    cmp     r0, r1\n"
"    bls     loc_fc1407ee\n"
"    strb.w  sl, [r5, #7]\n"
"    b       loc_fc1407f2\n"
"loc_fc1407ee:\n"
"    ldrb    r2, [r5, #7]\n"
"    cbnz    r2, loc_fc1407f6\n"
"loc_fc1407f2:\n"
"    strb.w  sl, [r7]\n"
"loc_fc1407f6:\n"
"    mov.w   r1, #0x300000\n"
"    ldr     r2, =0x0000b128\n"
"    subs    r2, #0x80\n"
"    ldrb    r2, [r2]\n"
"    strb    r2, [r5, #6]\n"
"    str     r1, [r4, #0x14]\n"
"    ldrb    r1, [r5, #7]\n"
"    cmp     r1, #1\n"
"    bne     loc_fc140818\n"
"    add.w   r2, r5, #0x10\n"
"    ldr     r0, [r6, #0x60]\n"
"    subs    r1, r2, #4\n"
"    bl      sub_fc37a458\n"
"    b       loc_fc14081c\n"
"loc_fc140818:\n"
"    str     r0, [r5, #0xc]\n"
"    str     r0, [r5, #0x10]\n"
"loc_fc14081c:\n"

// movie time limit modification, r0...r3 does not seem to carry anything useful here, so they are not backed up
"    mov     r0, sb\n"                  // + original limit is in r9 (aka sb)
"    bl      set_movie_time_limit\n"    // +
"    mov     sb, r0\n"                  // +
// bitrate mod
"    mov     r0, r4\n"                  // + addr of struct with bitrates is in r4
"    bl      set_quality\n"             // +

"    mvn     r2, #9\n"
"    ldr     r0, [r6, #0x1c]\n"
"    mov     r7, sl\n"
"    str     r0, [sp, #0x18]\n"
"    mul     r1, sb, r0\n"
"    ldr     r0, [r6, #0x20]\n"
"    mov     fp, r0\n"
"    udiv    r0, r1, r0\n"
"    ldr     r1, =0x0000b2c8\n"
"    subs    r1, #0xa0\n"
"    str     r0, [r1, #0x58]\n"
"    str     r0, [sp, #0x14]\n"
"    adds.w  r0, sb, r2\n"
"    ldr.w   sb, =0x0000b128\n"
"    adc     r1, sl, #-1\n"
"    ldr     r1, =0x0000b128\n"
"    sub.w   sb, sb, #0x80\n"
"    str.w   r0, [sb, #0x64]\n"
"    ldr     r0, [r1, #0x6c]\n"
"    cbnz    r0, loc_fc140860\n"
"    ldr     r0, [sp, #0x18]\n"
"    add     r0, fp\n"
"    subs    r0, r0, #1\n"
"    udiv    r0, r0, fp\n"
"    str     r0, [r1, #0x6c]\n"
"loc_fc140860:\n"
"    ldr     r2, [r1, #0x4c]\n"
"    ldr     r0, [r1, #0x3c]\n"
"    orrs    r2, r0\n"
"    beq     loc_fc140890\n"
"    strb.w  r8, [r5, #2]\n"
"    b       loc_fc140888\n"
// constants skiped FC14086C - FC140887
"loc_fc140888:\n"
"    movw   r2, #0x780\n"
"    str     r2, [r4, #0x18]\n"
"    b       loc_fc140894\n"
"loc_fc140890:\n"
"    strb    r7, [r5, #2]\n"
"    str     r7, [r4, #0x18]\n"
"loc_fc140894:\n"
"    cmp     r0, #0\n"
"    mov     sl, r1\n"
"    beq     loc_fc14090a\n"
"    strb    r7, [r5, #7]\n"
"    ldr.w   r0, [sb, #0x54]\n"
"    cmp.w   r0, #0x300000\n"
"    bls     loc_fc1408a8\n"
"    str     r0, [r4, #0x14]\n"
"loc_fc1408a8:\n"
"    mov.w   fp, #0x3c\n"
"    ldr     r0, =0x0000b228\n"
"    ldr     r0, [r0, #0x44]\n"
"    cbnz    r0, loc_fc1408bc\n"
"    movs    r0, #0x78\n"
"    strd    fp, r0, [r6]\n"
"    movs    r0, #0x1e\n"
"    b       loc_fc1408ca\n"
"loc_fc1408bc:\n"
"    cmp     r0, #1\n"
"    bne     loc_fc1408ce\n"
"    movs    r0, #0x30\n"
"    str     r0, [r6]\n"
"    movs    r0, #0x60\n"
"    str     r0, [r6, #4]\n"
"    movs    r0, #0x18\n"
"loc_fc1408ca:\n"
"    str     r0, [r6, #8]\n"
"    b       loc_fc1408dc\n"
"loc_fc1408ce:\n"
"    movw    r2, #0x7ee\n"
"    ldr     r1, =0xfc13ffcc\n" //  *"MovieRecorder.c"
"    movs    r0, #0\n"
"    blx     sub_fc302434\n" // j_DebugAssert
"loc_fc1408dc:\n"
"    ldr.w   r1, [sl, #0x18]\n"
"    mov     r0, sl\n"
"    cbz     r1, loc_fc1408e8\n"
"    mov     r0, fp\n"
"    b       loc_fc1408ee\n"
"loc_fc1408e8:\n"
"    ldr     r0, [r0, #0x54]\n"
"    cbz     r0, loc_fc1408f2\n"
"    ldr     r0, [r6, #8]\n"
"loc_fc1408ee:\n"
"    str     r0, [r4, #0x10]\n"
"    b       loc_fc1408f4\n"
"loc_fc1408f2:\n"
"    str     r7, [r4, #0x10]\n"
"loc_fc1408f4:\n"
"    movs    r0, #2\n"
"    strh.w  r0, [r4, #0x5a]\n"
"    strh.w  r0, [sb, #0x10]\n"
"    ldr.w   r0, [sl, #0x5c]\n"
"    cbz     r0, loc_fc14091c\n"
"    strb.w  r8, [r5, #3]\n"
"    b       loc_fc14091e\n"
"loc_fc14090a:\n"
"    ldrh.w  r0, [sb, #0xe]\n"
"    ldr     r1, [sp, #0x14]\n"
"    add     r1, r0\n"
"    subs    r1, r1, #1\n"
"    udiv    r0, r1, r0\n"
"    adds    r0, r0, #1\n"
"    b       loc_fc1408ee\n"
"loc_fc14091c:\n"
"    strb    r7, [r5, #3]\n"
"loc_fc14091e:\n"
"    movs    r3, #2\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r1, #0xaf\n"
"    add     r2, sp, #0x10\n"
"    bl      sub_fc373b32\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r3, #2\n"
"    movs    r1, #0xae\n"
"    add     r2, sp, #0xc\n"
"    bl      sub_fc373b32\n"
"    ldr.w   r0, [sl, #0x48]\n"
"    mov.w   r3, #4\n"
"    cbz     r0, loc_fc140950\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r1, #0xa8\n"
"    add     r2, sp, #0x10\n"
"    bl      sub_fc373b32\n"
"    movs    r3, #4\n"
"    add     r2, sp, #0xc\n"
"    b       loc_fc140962\n"
"loc_fc140950:\n"
"    ldr     r2, =0x0000b228\n"
"    movs    r1, #0xa8\n"
"    ldr     r0, [r6, #0x64]\n"
"    subs    r2, #0x64\n"
"    bl      sub_fc373b32\n"
"    ldr     r2, =0x0000b228\n"
"    movs    r3, #4\n"
"    subs    r2, #0x60\n"
"loc_fc140962:\n"
"    ldr     r0, [r6, #0x64]\n"
"    movs    r1, #0xa9\n"
"    bl      sub_fc373b32\n"
"    ldrh.w  r0, [sp, #0x10]\n"
"    ldr     r5, [r6, #0x1c]\n"
"    mov     r8, r0\n"
"    cmp     r5, r0\n"
"    beq     loc_fc1409ac\n"
"    ldr     r0, =0x0000b228\n"
"    ldr     r0, [r0, #0x44]\n"
"    cmp     r0, #0x15\n"
"    beq     loc_fc1409b4\n"
"    ldr     r0, [r4, #0x28]\n"
"    mov     r3, r7\n"
"    ldrh.w  r1, [sp, #0xc]\n"
"    lsls    r0, r0, #7\n"
"    umull   r0, r2, r1, r0\n"
"    mla     r1, r1, r7, r2\n"
"    umull   r0, r2, r5, r0\n"
"    mla     r1, r5, r1, r2\n"
"    mov     r2, r8\n"
"    blx     sub_fc302354\n"
"    ldr     r2, [r6, #0x20]\n"
"    mov     r3, r7\n"
"    blx     sub_fc302354\n"
"    str.w   r0, [sb, #0x58]\n"
"    b       loc_fc1409b4\n"
"loc_fc1409ac:\n"
"    ldr     r0, [r4, #0x28]\n"
"    lsls    r1, r0, #7\n"
"    str.w   r1, [sb, #0x58]\n"
"loc_fc1409b4:\n"
"    ldr.w   r0, [sb, #0x58]\n"
"    movs    r2, #0xa\n"
"    mov     r1, sb\n"
"    umull   r2, r3, r0, r2\n"
"    str.w   r2, [sb, #0x5c]\n"
"    movs    r2, #3\n"
"    cmp     r5, r8\n"
"    umull   r0, r2, r0, r2\n"
"    str.w   r0, [sb, #0x60]\n"
"    bne     loc_fc1409d6\n"
"    ldr     r0, [r1, #0x58]\n"
"    b       loc_fc1409dc\n"
"loc_fc1409d6:\n"
"    ldr     r0, [r4, #0x28]\n"
"    lsls    r0, r0, #7\n"
"    str     r0, [r1, #0x58]\n"
"loc_fc1409dc:\n"
"    add.w   r2, r0, r0, lsl #1\n"
"    ldr     r0, [r1, #0x54]\n"
"    add     r2, r0\n"
"    subs    r2, r2, #1\n"
"    udiv    r2, r2, r0\n"
"    muls    r2, r0, r2\n"
"    ldr     r0, [r1, #0x68]\n"
"    muls    r2, r0, r2\n"
"    ldr     r0, =0x0000b228\n"
"    adds    r0, #0x80\n"
"    stm     r0!, {r2, r7}\n"
"    ldr     r0, [r4, #0x28]\n"
"    add.w   r1, r0, r0, lsl #1\n"
"loc_fc1409fc:\n"
"    rsb     r0, r1, r0, lsl #7\n"
"    ldr     r1, =0x0000b228\n"
"    str     r0, [r1, #0x48]\n"
"    add     sp, #0x1c\n"
"loc_fc140a06:\n"
"    pop.w   {r4, r5, r6, r7, r8, sb, sl, fp, pc}\n"
);
}

// below functions are for getting bitrate information during recording
// filesystem info only updates after recording stops

void getchunkinfo(int *r0) { // for each model, firmware struct needs to be verified
    int m;
    unsigned int lsum = 0;
    m = *r0; // num of chunks
    int *cl = (int*)(*(r0+1));
    while (m>0) {
        // chunk properties, 3 words: addr, size, unknown
        lsum += *(cl+1);
        cl+=3;
        m--;
    }
    bitrate_calc(lsum);
}

void __attribute__((naked,noinline)) apendstrm_my() { // when porting: check disassembly to verify
asm volatile (
"    push    {r0, lr}\n"
"    ldr     r0, [r0, #8]\n"
"    ldr     r0, [r0, #4]\n"
"    bl      getchunkinfo\n"
"    pop     {r0, lr}\n"
"    ldr     pc, orig_apendstrm\n"  // call the original fw function
"orig_apendstrm:\n"
"    .long   0\n"                   // placeholder, populated below
);
}

// cocoa's APENDSTRM func pointer is located in ROM, fw's TskCocoa0 task needs to be modified
// cocoa fw struct is copied to RAM first, so that the APENDSTRM pointer can be replaced
void __attribute__((naked,noinline)) task_cocoa0() {
    asm volatile (
".equ   COCOA_ARR_START,    0xFC635574\n"
".equ   COCOA_APENDSTR_LOC, 0xFC6355C8\n"
".equ   COCOA_ARR_END,      0xFC635A60\n"
".equ   COCOA_ARR_LEN,      (COCOA_ARR_END - COCOA_ARR_START)\n"
".equ   COCOA_APENDSTR_OFS, (COCOA_APENDSTR_LOC - COCOA_ARR_START)\n"
// copy and modify fw struct
"    push    {r0, lr}\n"            // +
"    adr     r0, cocoa_struct\n"    // + destination
"    ldr     r1, =COCOA_ARR_START\n"// + source
"    movw    r2, #COCOA_ARR_LEN\n"  // + struct length in bytes
"    bl      _memcpy\n"             // +
"    movw    r0, #COCOA_APENDSTR_OFS\n" // + offset of APENDSTRM func pointer
"    adr     r1, cocoa_struct\n"    // +
"    ldr     r2, [r1, r0]\n"        // + get original APENDSTRM pointer
"    adr     r3, orig_apendstrm\n"  // +
"    str     r2, [r3]\n"            // + store original APENDSTRM pointer for use in apendstrm_my()
"    adr     r2, apendstrm_my\n"    // + our replacement for APENDSTRM
"    orr     r2, #1\n"              // +
"    str     r2, [r1, r0]\n"        // + replace the original APENDSTRM
// TODO: do we need to care about the data cache?
"    pop     {r0, lr}\n"            // +


// task_TskCocoa0 0xfc2623f1
"    mov     r1, r0\n"
"    movs    r0, #0\n"
// "    b       loc_fc262160\n"
"    push.w  {r4, r5, r6, r7, r8, sb, sl, fp, lr}\n"
"    cmp     r0, #2\n"
"    mov     r4, r1\n"
"    sub     sp, #0x15c\n"
"    mov     r6, r0\n"
"    blt     loc_fc262180\n"
"    ldr     r1, =0xfc2622f0\n" //  *"CocoaTsk.c"
"    movw    r2, #0x1c8\n"
"    ldr     r0, =0xfc2622fc\n" //  *"Cocoa MEDIA OVER"
"    bl      sub_fc261ea8\n"
"loc_fc26217a:\n"
"    add     sp, #0x15c\n"
"    pop.w   {r4, r5, r6, r7, r8, sb, sl, fp, pc}\n"
"loc_fc262180:\n"
"    blx     sub_fc30224c\n"
"    mov     r1, r4\n"
"    mov     r0, r6\n"
"    bl      sub_fc447f28\n"
"    cbnz    r4, loc_fc26219a\n"
"    adds    r6, r6, #2\n"
"    ldr     r1, =0xfc262310\n" //  *"Fatal error!!"
"    uxtb    r0, r6\n"
"    bl      sub_fc37472e\n"
"    b       loc_fc26217a\n"
"loc_fc26219a:\n"
// "    ldr.w   sb, =0xfc635574\n"	// -
"    adr     sb, cocoa_struct\n"    // +
"    ldr     pc, =0xFC26219F\n"     // + back to rom
".ltorg\n"

"    .align 2\n"                        // +
"cocoa_struct:\n"                       // +
"    .space  COCOA_ARR_LEN\n"           // + make space for copied fw struct

    );
}

