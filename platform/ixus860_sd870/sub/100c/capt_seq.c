/*
 * capt_seq.c - auto-generated by CHDK code_gen.
 */
#include "lolevel.h"
#include "platform.h"
#include "core.h"

#define USE_STUBS_NRFLAG 1          // see stubs_entry.S

#include "../../../generic/capt_seq.c"

/*************************************************************/
//** capt_seq_task @ 0xFF85BD10 - 0xFF85BF78, length=155
void __attribute__((naked,noinline)) capt_seq_task() {
asm volatile (
"    STMFD   SP!, {R3-R9,LR} \n"
"    LDR     R6, =0x1A08C \n"
"    LDR     R5, =0x5640 \n"
"    MOV     R9, #1 \n"
"    MOV     R7, #0 \n"

"loc_FF85BD24:\n"
"    LDR     R0, [R5, #0xC] \n"
"    MOV     R2, #0 \n"
"    MOV     R1, SP \n"
"    BL      sub_FF829130 /*_ReceiveMessageQueue*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF85BD50 \n"
"    LDR     R1, =0x43F \n"
"    LDR     R0, =0xFF85BAA8 \n"
"    BL      _DebugAssert \n"
"    BL      _ExitTask \n"
"    LDMFD   SP!, {R3-R9,PC} \n"

"loc_FF85BD50:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x17 \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF85BF40 \n"
"    B       loc_FF85BDC4 \n"
"    B       loc_FF85BE2C \n"
"    B       loc_FF85BE34 \n"
"    B       loc_FF85BE4C \n"
"    B       loc_FF85BE40 \n"
"    B       loc_FF85BE54 \n"
"    B       loc_FF85BE5C \n"
"    B       loc_FF85BE64 \n"
"    B       loc_FF85BEBC \n"
"    B       loc_FF85BEC8 \n"
"    B       loc_FF85BED0 \n"
"    B       loc_FF85BED8 \n"
"    B       loc_FF85BEE0 \n"
"    B       loc_FF85BEE8 \n"
"    B       loc_FF85BEF0 \n"
"    B       loc_FF85BEF8 \n"
"    B       loc_FF85BF00 \n"
"    B       loc_FF85BF0C \n"
"    B       loc_FF85BF14 \n"
"    B       loc_FF85BF1C \n"
"    B       loc_FF85BF24 \n"
"    B       loc_FF85BF30 \n"
"    B       loc_FF85BF38 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BDC4:\n"
"    BL      sub_FF92FEF8 \n"

// only do quick press hack if overrides are active
"    BL      captseq_hack_override_active\n" // returns 1 if tv or sv override in effect
"    STR     R0,[SP,#-4]!\n" // push return value
"    BL      shooting_expo_param_override\n"      // added

"    BL      sub_FF859FE8 \n"

"    LDR     R0, [SP], #4\n" // pop override hack
"    CMP     R0, #1\n"     // +
"    MOVEQ   R0, #0\n"     // +
"    STREQ   R0, [R6, #0x24]\n"  // fixes overrides behavior at short shutter press
"    LDRNE   R0, [R6, #0x24]\n" // modified NE
"    CMPNE   R0, #0\n"         // modified NE

//"  LDR     R0, [R6, #0x24] \n"  // above patch makes these lines redundant
//"  CMP     R0, #0 \n"
"    BEQ     loc_FF85BF4C \n"
"    BL      sub_FF85B774 \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BEQ     loc_FF85BE0C \n"
"    MOV     R0, #0xC \n"
"    BL      sub_FF85EE0C \n"
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x40000000 \n"
"    STRNE   R0, [R4, #8] \n"
"    BNE     loc_FF85BF4C \n"

"loc_FF85BE0C:\n"
"    BL      sub_FF944A40 \n"
"    BL      sub_FF869600 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF931550_my \n"  // --> Patched. Old value = 0xFF931550.
"    TST     R0, #1 \n"
"    STRNE   R9, [R5, #4] \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BE2C:\n"
"    BL      sub_FF85C054_my \n"  // --> Patched. Old value = 0xFF85C054.
"    B       loc_FF85BE44 \n"

"loc_FF85BE34:\n"
"    MOV     R0, #1 \n"
"    BL      sub_FF93009C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BE40:\n"
"    BL      sub_FF92FB94 \n"

"loc_FF85BE44:\n"
"    STR     R7, [R6, #0x24] \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BE4C:\n"
"    BL      sub_FF92FEC4 \n"
"    B       loc_FF85BE44 \n"

"loc_FF85BE54:\n"
"    BL      sub_FF92FECC \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BE5C:\n"
"    BL      sub_FF92FFBC \n"
"    B       loc_FF85BEC0 \n"

"loc_FF85BE64:\n"
"    LDR     R4, [R0, #0xC] \n"
"    BL      sub_FF92FED4 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF9306E8 \n"
"    TST     R0, #1 \n"
"    MOV     R8, R0 \n"
"    BNE     loc_FF85BEA4 \n"
"    BL      sub_FF869600 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF931468 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF93197C \n"
"    MOV     R8, R0 \n"
"    LDR     R0, [R4, #0x14] \n"
"    BL      sub_FF869814 \n"

"loc_FF85BEA4:\n"
"    BL      sub_FF92FEC4 \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #8 \n"
"    MOV     R0, R8 \n"
"    BL      sub_FF85A544 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEBC:\n"
"    BL      sub_FF930018 \n"

"loc_FF85BEC0:\n"
"    BL      sub_FF859FE8 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEC8:\n"
"    BL      sub_FF92FEC4 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BED0:\n"
"    BL      sub_FF930954 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BED8:\n"
"    BL      sub_FF930B0C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEE0:\n"
"    BL      sub_FF930B9C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEE8:\n"
"    BL      sub_FF930C50 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEF0:\n"
"    BL      sub_FF930E38 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BEF8:\n"
"    BL      sub_FF930E88 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF00:\n"
"    MOV     R0, #0 \n"
"    BL      sub_FF930F0C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF0C:\n"
"    BL      sub_FF93104C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF14:\n"
"    BL      sub_FF9310E0 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF1C:\n"
"    BL      sub_FF9311A0 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF24:\n"
"    BL      sub_FF9301C0 \n"
"    BL      sub_FF825BA8 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF30:\n"
"    BL      sub_FF930D0C \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF38:\n"
"    BL      sub_FF930D78 \n"
"    B       loc_FF85BF4C \n"

"loc_FF85BF40:\n"
"    LDR     R1, =0x523 \n"
"    LDR     R0, =0xFF85BAA8 \n"
"    BL      _DebugAssert \n"

"loc_FF85BF4C:\n"
"    LDR     R0, [SP] \n"
"    LDR     R1, [R0, #4] \n"
"    LDR     R0, [R5, #8] \n"
"    BL      sub_FF828EAC /*_SetEventFlag*/ \n"
"    LDR     R4, [SP] \n"
"    LDR     R0, [R4, #8] \n"
"    CMP     R0, #0 \n"
"    LDREQ   R0, =0xFF85BAA8 \n"
"    MOVEQ   R1, #0xFC \n"
"    BLEQ    _DebugAssert \n"
"    STR     R7, [R4, #8] \n"
"    B       loc_FF85BD24 \n"
);
}

/*************************************************************/
//** sub_FF931550_my @ 0xFF931550 - 0xFF9315C0, length=29
void __attribute__((naked,noinline)) sub_FF931550_my() {
asm volatile (
"    STMFD   SP!, {R0-R10,LR} \n"
"    MOV     R6, #0 \n"
"    MOV     R4, R0 \n"
"    BL      sub_FF932038 \n"
"    MVN     R1, #0 \n"
"    BL      sub_FF828EE0 /*_ClearEventFlag*/ \n"
"    MOV     R2, #4 \n"
"    ADD     R1, SP, #8 \n"
"    MOV     R0, #0x8A \n"
"    BL      _PT_GetPropertyCaseString \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x20A \n"
"    LDRNE   R0, =0xFF931724 \n"
"    BLNE    _DebugAssert \n"
"    LDR     R8, =0x1A140 \n"
"    LDR     R5, =0x1A08C \n"
"    LDRSH   R1, [R8, #0xE] \n"
"    LDR     R0, [R5, #0x7C] \n"
"    BL      sub_FF9DDE88 \n"
"    BL      _GetCCDTemperature \n"
"    LDR     R2, =0xAB00 \n"
"    ADD     R3, R4, #0x8C \n"
"    STRH    R0, [R4, #0x88] \n"
"    STRD    R2, [SP] \n"
"    MOV     R1, R0 \n"
"    LDRH    R0, [R5, #0x54] \n"
"    LDRSH   R2, [R8, #0xC] \n"
"    LDR     R3, =0xAAFC \n"
"    BL      sub_FF932524 \n"
"    BL      wait_until_remote_button_is_released\n" // added
"    BL      capt_seq_hook_set_nr\n"                 // added
"    LDR     PC, =0xFF9315C4 \n"  // Continue in firmware
);
}

/*************************************************************/
//** sub_FF85C054_my @ 0xFF85C054 - 0xFF85C108, length=46
void __attribute__((naked,noinline)) sub_FF85C054_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R4, [R0, #0xC] \n"
"    LDR     R6, =0x1A08C \n"
"    LDR     R0, [R4, #8] \n"
"    MOV     R5, #0 \n"
"    ORR     R0, R0, #1 \n"
"    STR     R0, [R4, #8] \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    MOVEQ   R0, #2 \n"
"    BLEQ    sub_FF856814 \n"
"    BL      sub_FF92FED4 \n"
"    LDR     R0, [R6, #0x24] \n"
"    CMP     R0, #0 \n"
"    BNE     loc_FF85C0D4 \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF930368 \n"
"    TST     R0, #1 \n"
"    MOVNE   R2, R4 \n"
"    LDMNEFD SP!, {R4-R6,LR} \n"
"    MOVNE   R1, #1 \n"
"    BNE     sub_FF85A544 \n"
"    BL      sub_FF944A40 \n"
"    BL      sub_FF869600 \n"
"    STR     R0, [R4, #0x14] \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF931468 \n"
"    BL      sub_FF931ECC \n"
"    MOV     R0, R4 \n"
"    BL      sub_FF931550_my \n"  // --> Patched. Old value = 0xFF931550.
"    MOV     R5, R0 \n"
"    B       loc_FF85C0E4 \n"

"loc_FF85C0D4:\n"
"    LDR     R0, =0x5640 \n"
"    LDR     R0, [R0, #4] \n"
"    CMP     R0, #0 \n"
"    MOVNE   R5, #0x1D \n"

"loc_FF85C0E4:\n"
"    BL      capt_seq_hook_raw_here \n"         // added
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, R5 \n"
"    BL      sub_FF85A544 \n"
"    BL      sub_FF93191C \n"
"    CMP     R0, #0 \n"
"    LDRNE   R0, [R4, #8] \n"
"    ORRNE   R0, R0, #0x2000 \n"
"    STRNE   R0, [R4, #8] \n"
"    LDMFD   SP!, {R4-R6,PC} \n"
);
}

/*************************************************************/
//** exp_drv_task @ 0xFF8AEBF4 - 0xFF8AF24C, length=407
void __attribute__((naked,noinline)) exp_drv_task() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    SUB     SP, SP, #0x20 \n"
"    LDR     R8, =0xBB8 \n"
"    LDR     R7, =0x6E6C \n"
"    LDR     R5, =0x41D44 \n"
"    MOV     R0, #0 \n"
"    ADD     R6, SP, #0x10 \n"
"    STR     R0, [SP, #0xC] \n"

"loc_FF8AEC14:\n"
"    LDR     R0, [R7, #0x20] \n"
"    MOV     R2, #0 \n"
"    ADD     R1, SP, #0x1C \n"
"    BL      sub_FF829130 /*_ReceiveMessageQueue*/ \n"
"    LDR     R0, [SP, #0xC] \n"
"    CMP     R0, #1 \n"
"    BNE     loc_FF8AEC5C \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #0x13 \n"
"    CMPNE   R0, #0x14 \n"
"    CMPNE   R0, #0x15 \n"
"    BEQ     loc_FF8AEDDC \n"
"    CMP     R0, #0x26 \n"
"    BEQ     loc_FF8AED48 \n"
"    ADD     R1, SP, #0xC \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF8AEBA4 \n"

"loc_FF8AEC5C:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x2B \n"
"    BNE     loc_FF8AEC8C \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8AFEDC \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #1 \n"
"    BL      sub_FF828EAC /*_SetEventFlag*/ \n"
"    BL      _ExitTask \n"
"    ADD     SP, SP, #0x20 \n"
"    LDMFD   SP!, {R4-R8,PC} \n"

"loc_FF8AEC8C:\n"
"    CMP     R1, #0x2A \n"
"    BNE     loc_FF8AECA8 \n"
"    LDR     R2, [R0, #0x88]! \n"
"    LDR     R1, [R0, #4] \n"
"    MOV     R0, R1 \n"
"    BLX     R2 \n"
"    B       loc_FF8AF244 \n"

"loc_FF8AECA8:\n"
"    CMP     R1, #0x24 \n"
"    BNE     loc_FF8AECF8 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF828EE0 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8AB658 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF924C78 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x80 \n"
"    BL      sub_FF828DE4 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0xD07 \n"
"    BNE     loc_FF8AEDB8 \n"

"loc_FF8AECE4:\n"
"    LDR     R1, [SP, #0x1C] \n"
"    LDR     R0, [R1, #0x8C] \n"
"    LDR     R1, [R1, #0x88] \n"
"    BLX     R1 \n"
"    B       loc_FF8AF244 \n"

"loc_FF8AECF8:\n"
"    CMP     R1, #0x25 \n"
"    BNE     loc_FF8AED40 \n"
"    ADD     R1, SP, #0xC \n"
"    BL      sub_FF8AEBA4 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF828EE0 /*_ClearEventFlag*/ \n"
"    LDR     R0, =0xFF8AB668 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF924F00 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x100 \n"
"    BL      sub_FF828DE4 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8AECE4 \n"
"    LDR     R1, =0xD11 \n"
"    B       loc_FF8AEDB8 \n"

"loc_FF8AED40:\n"
"    CMP     R1, #0x26 \n"
"    BNE     loc_FF8AED58 \n"

"loc_FF8AED48:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    ADD     R1, SP, #0xC \n"
"    BL      sub_FF8AEBA4 \n"
"    B       loc_FF8AECE4 \n"

"loc_FF8AED58:\n"
"    CMP     R1, #0x27 \n"
"    CMPNE   R1, #0x28 \n"
"    BNE     loc_FF8AEDC4 \n"
"    ADD     R1, SP, #0xC \n"
"    BL      sub_FF8AEBA4 \n"
"    LDR     R4, [SP, #0x1C] \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF828EE0 /*_ClearEventFlag*/ \n"
"    LDR     R0, [R4] \n"
"    MOV     R1, #0x40 \n"
"    CMP     R0, #0x27 \n"
"    LDR     R0, =0xFF8AB6CC \n"
"    BNE     loc_FF8AED98 \n"
"    BL      sub_FF924CD4 \n"
"    B       loc_FF8AED9C \n"

"loc_FF8AED98:\n"
"    BL      sub_FF924D3C \n"

"loc_FF8AED9C:\n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R2, R8 \n"
"    MOV     R1, #0x40 \n"
"    BL      sub_FF828DE4 /*_WaitForAllEventFlag*/ \n"
"    TST     R0, #1 \n"
"    BEQ     loc_FF8AECE4 \n"
"    LDR     R1, =0xD1F \n"

"loc_FF8AEDB8:\n"
"    LDR     R0, =0xFF8ABD68 \n"
"    BL      _DebugAssert \n"
"    B       loc_FF8AECE4 \n"

"loc_FF8AEDC4:\n"
"    CMP     R1, #0x29 \n"
"    BNE     loc_FF8AEDDC \n"
"    BL      sub_FF891474 \n"
"    BL      sub_FF8921F4 \n"
"    BL      sub_FF891CB4 \n"
"    B       loc_FF8AECE4 \n"

"loc_FF8AEDDC:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R4, #1 \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x11 \n"
"    CMPNE   R1, #0x12 \n"
"    BNE     loc_FF8AEE4C \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2-R4} \n"
"    STMIA   R6, {R2-R4} \n"
"    BL      sub_FF8AD6C0 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8B02B0 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x90] \n"
"    LDR     R2, [R0, #0x94] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    B       loc_FF8AF184 \n"

"loc_FF8AEE4C:\n"
"    CMP     R1, #0x13 \n"
"    CMPNE   R1, #0x14 \n"
"    CMPNE   R1, #0x15 \n"
"    BNE     loc_FF8AEF00 \n"
"    ADD     R3, SP, #0xC \n"
"    MOV     R2, SP \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8AD908 \n"
"    CMP     R0, #1 \n"
"    MOV     R4, R0 \n"
"    CMPNE   R4, #5 \n"
"    BNE     loc_FF8AEE9C \n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, R4 \n"
"    LDR     R1, [R0, #0x7C]! \n"
"    LDR     R12, [R0, #0xC]! \n"
"    LDR     R3, [R0, #4] \n"
"    MOV     R0, SP \n"
"    BLX     R12 \n"
"    B       loc_FF8AEED4 \n"

"loc_FF8AEE9C:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    CMP     R4, #2 \n"
"    LDR     R3, [R0, #0x8C] \n"
"    CMPNE   R4, #6 \n"
"    BNE     loc_FF8AEEE8 \n"
"    LDR     R12, [R0, #0x88] \n"
"    MOV     R0, SP \n"
"    MOV     R2, R4 \n"
"    MOV     R1, #1 \n"
"    BLX     R12 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, SP \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FF8AE8B8 \n"

"loc_FF8AEED4:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R2, [SP, #0xC] \n"
"    MOV     R1, R4 \n"
"    BL      sub_FF8AEB44 \n"
"    B       loc_FF8AF184 \n"

"loc_FF8AEEE8:\n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R12, [R0, #0x88] \n"
"    ADD     R0, R0, #4 \n"
"    MOV     R2, R4 \n"
"    BLX     R12 \n"
"    B       loc_FF8AF184 \n"

"loc_FF8AEF00:\n"
"    CMP     R1, #0x20 \n"
"    CMPNE   R1, #0x21 \n"
"    BNE     loc_FF8AEF4C \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R1, R0, R1, LSL#2 \n"
"    SUB     R1, R1, #8 \n"
"    LDMIA   R1, {R2-R4} \n"
"    STMIA   R6, {R2-R4} \n"
"    BL      sub_FF8ACC50 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8ACF40 \n"
"    B       loc_FF8AF184 \n"

"loc_FF8AEF4C:\n"
"    ADD     R1, R0, #4 \n"
"    LDMIA   R1, {R2,R3,R12} \n"
"    STMIA   R6, {R2,R3,R12} \n"
"    LDR     R1, [R0] \n"
"    CMP     R1, #0x23 \n"
"    ADDLS   PC, PC, R1, LSL#2 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AEFF8 \n"
"    B       loc_FF8AEFF8 \n"
"    B       loc_FF8AF04C \n"
"    B       loc_FF8AF054 \n"
"    B       loc_FF8AF054 \n"
"    B       loc_FF8AF054 \n"
"    B       loc_FF8AEFF8 \n"
"    B       loc_FF8AF04C \n"
"    B       loc_FF8AF054 \n"
"    B       loc_FF8AF054 \n"
"    B       loc_FF8AF06C \n"
"    B       loc_FF8AF06C \n"
"    B       loc_FF8AF158 \n"
"    B       loc_FF8AF160 \n"
"    B       loc_FF8AF160 \n"
"    B       loc_FF8AF160 \n"
"    B       loc_FF8AF160 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF05C \n"
"    B       loc_FF8AF064 \n"
"    B       loc_FF8AF064 \n"
"    B       loc_FF8AF078 \n"
"    B       loc_FF8AF080 \n"
"    B       loc_FF8AF0B0 \n"
"    B       loc_FF8AF0E0 \n"
"    B       loc_FF8AF110 \n"
"    B       loc_FF8AF140 \n"
"    B       loc_FF8AF140 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF164 \n"
"    B       loc_FF8AF148 \n"
"    B       loc_FF8AF150 \n"

"loc_FF8AEFF8:\n"
"    BL      sub_FF8ABB50 \n"
"    B       loc_FF8AF164 \n"
//SKIP DATA

"loc_FF8AF04C:\n"
"    BL      sub_FF8ABDD8 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF054:\n"
"    BL      sub_FF8ABFDC \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF05C:\n"
"    BL      sub_FF8AC244 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF064:\n"
"    BL      sub_FF8AC438 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF06C:\n"
"    BL      sub_FF8AC69C_my \n"  // --> Patched. Old value = 0xFF8AC69C.
"    MOV     R4, #0 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF078:\n"
"    BL      sub_FF8AC7D8 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF080:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R5, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R5, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R5, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8AFF50 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF0B0:\n"
"    LDRH    R1, [R0, #4] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R5, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R5, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R5, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R5, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8B00CC \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF0E0:\n"
"    LDRH    R1, [R5] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R0, #6] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R5, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R5, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R5, #8] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8B0178 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF110:\n"
"    LDRH    R1, [R5] \n"
"    STRH    R1, [SP, #0x10] \n"
"    LDRH    R1, [R5, #2] \n"
"    STRH    R1, [SP, #0x12] \n"
"    LDRH    R1, [R5, #4] \n"
"    STRH    R1, [SP, #0x14] \n"
"    LDRH    R1, [R5, #6] \n"
"    STRH    R1, [SP, #0x16] \n"
"    LDRH    R1, [R0, #0xC] \n"
"    STRH    R1, [SP, #0x18] \n"
"    BL      sub_FF8B0218 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF140:\n"
"    BL      sub_FF8ACA30 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF148:\n"
"    BL      sub_FF8AD044 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF150:\n"
"    BL      sub_FF8AD278 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF158:\n"
"    BL      sub_FF8AD3F0 \n"
"    B       loc_FF8AF164 \n"

"loc_FF8AF160:\n"
"    BL      sub_FF8AD588 \n"

"loc_FF8AF164:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R1, [R0, #0x7C] \n"
"    LDR     R3, [R0, #0x88] \n"
"    LDR     R2, [R0, #0x8C] \n"
"    ADD     R0, R0, #4 \n"
"    BLX     R3 \n"
"    CMP     R4, #1 \n"
"    BNE     loc_FF8AF1CC \n"

"loc_FF8AF184:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    MOV     R2, #0xC \n"
"    LDR     R1, [R0, #0x7C] \n"
"    ADD     R1, R1, R1, LSL#1 \n"
"    ADD     R0, R0, R1, LSL#2 \n"
"    SUB     R4, R0, #8 \n"
"    LDR     R0, =0x41D44 \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA8BE00 \n"
"    LDR     R0, =0x41D50 \n"
"    MOV     R2, #0xC \n"
"    ADD     R1, SP, #0x10 \n"
"    BL      sub_FFA8BE00 \n"
"    LDR     R0, =0x41D5C \n"
"    MOV     R2, #0xC \n"
"    MOV     R1, R4 \n"
"    BL      sub_FFA8BE00 \n"
"    B       loc_FF8AF244 \n"

"loc_FF8AF1CC:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    LDR     R0, [R0] \n"
"    CMP     R0, #0xB \n"
"    BNE     loc_FF8AF214 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    BL      sub_FF8AB958 \n"
"    MOV     R3, #0 \n"
"    STR     R3, [SP] \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #0 \n"
"    B       loc_FF8AF240 \n"

"loc_FF8AF214:\n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"
"    BL      sub_FF8AB958 \n"
"    MOV     R3, #1 \n"
"    MOV     R2, #1 \n"
"    MOV     R1, #1 \n"
"    MOV     R0, #1 \n"
"    STR     R3, [SP] \n"

"loc_FF8AF240:\n"
"    BL      sub_FF8ABA98 \n"

"loc_FF8AF244:\n"
"    LDR     R0, [SP, #0x1C] \n"
"    BL      sub_FF8AFEDC \n"
"    B       loc_FF8AEC14 \n"
);
}

/*************************************************************/
//** sub_FF8AC69C_my @ 0xFF8AC69C - 0xFF8AC758, length=48
void __attribute__((naked,noinline)) sub_FF8AC69C_my() {
asm volatile (
"    STMFD   SP!, {R4-R8,LR} \n"
"    LDR     R7, =0x6E6C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R7, #0x1C] \n"
"    MOV     R1, #0x3E \n"
"    BL      sub_FF828EE0 /*_ClearEventFlag*/ \n"
"    LDRSH   R0, [R4, #4] \n"
"    MOV     R2, #0 \n"
"    MOV     R1, #0 \n"
"    BL      sub_FF8AB6EC \n"
"    MOV     R6, R0 \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF8AB7F8 \n"
"    LDRSH   R0, [R4, #8] \n"
"    BL      sub_FF8AB850 \n"
"    LDRSH   R0, [R4, #0xA] \n"
"    BL      sub_FF8AB8A8 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    BL      sub_FF8AB900 \n"
"    MOV     R5, R0 \n"
"    LDR     R0, [R4] \n"
"    LDR     R8, =0x41D5C \n"
"    CMP     R0, #0xB \n"
"    MOVEQ   R6, #0 \n"
"    MOVEQ   R5, #0 \n"
"    BEQ     loc_FF8AC72C \n"
"    CMP     R6, #1 \n"
"    BNE     loc_FF8AC72C \n"
"    LDRSH   R0, [R4, #4] \n"
"    LDR     R1, =0xFF8AB648 \n"
"    MOV     R2, #2 \n"
"    BL      sub_FF924DCC \n"
"    STRH    R0, [R4, #4] \n"
"    MOV     R0, #0 \n"
"    STR     R0, [R7, #0x28] \n"
"    B       loc_FF8AC734 \n"

"loc_FF8AC72C:\n"
"    LDRH    R0, [R8] \n"
"    STRH    R0, [R4, #4] \n"

"loc_FF8AC734:\n"
"    CMP     R5, #1 \n"
"    LDRNEH  R0, [R8, #8] \n"
"    BNE     loc_FF8AC750 \n"
"    LDRSH   R0, [R4, #0xC] \n"
"    LDR     R1, =0xFF8AB6DC \n"
"    MOV     R2, #0x20 \n"
"    BL      sub_FF8AFF0C \n"

"loc_FF8AC750:\n"
"    STRH    R0, [R4, #0xC] \n"
"    LDRSH   R0, [R4, #6] \n"
"    BL      sub_FF891218_my \n"  // --> Patched. Old value = 0xFF891218.
"    LDR     PC, =0xFF8AC75C \n"  // Continue in firmware
);
}

/*************************************************************/
//** sub_FF891218_my @ 0xFF891218 - 0xFF891280, length=27
void __attribute__((naked,noinline)) sub_FF891218_my() {
asm volatile (
"    STMFD   SP!, {R4-R6,LR} \n"
"    LDR     R5, =0x695C \n"
"    MOV     R4, R0 \n"
"    LDR     R0, [R5, #4] \n"
"    CMP     R0, #1 \n"
"    MOVNE   R1, #0x16C \n"
"    LDRNE   R0, =0xFF890FB0 \n"
"    BLNE    _DebugAssert \n"
"    CMN     R4, #0xC00 \n"
"    LDREQSH R4, [R5, #2] \n"
"    CMN     R4, #0xC00 \n"
"    LDREQ   R1, =0x172 \n"
"    LDREQ   R0, =0xFF890FB0 \n"
"    STRH    R4, [R5, #2] \n"
"    BLEQ    _DebugAssert \n"
"    MOV     R0, R4 \n"
"    BL      apex2us \n"  // --> Patched. Old value = _apex2us.
"    MOV     R4, R0 \n"
//"  BL      _sub_FF8BE39C \n"  // --> Nullsub call removed.
"    MOV     R0, R4 \n"
"    BL      sub_FF8C1B88 \n"
"    TST     R0, #1 \n"
"    LDRNE   R1, =0x177 \n"
"    LDMNEFD SP!, {R4-R6,LR} \n"
"    LDRNE   R0, =0xFF890FB0 \n"
"    BNE     _DebugAssert \n"
"    LDMFD   SP!, {R4-R6,PC} \n"
);
}
